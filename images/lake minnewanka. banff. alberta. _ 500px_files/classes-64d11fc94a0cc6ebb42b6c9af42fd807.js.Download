!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):"undefined"!=typeof exports?module.exports=t(require("jquery")):t(jQuery)}(function(t){"use strict";var e=window.Slick||{};e=function(){function e(e,i){var r,n=this;n.defaults={accessibility:!0,adaptiveHeight:!1,appendArrows:t(e),appendDots:t(e),arrows:!0,asNavFor:null,prevArrow:'<button class="slick-prev" aria-label="Previous" type="button">Previous</button>',nextArrow:'<button class="slick-next" aria-label="Next" type="button">Next</button>',autoplay:!1,autoplaySpeed:3e3,centerMode:!1,centerPadding:"50px",cssEase:"ease",customPaging:function(e,o){return t('<button type="button" />').text(o+1)},dots:!1,dotsClass:"slick-dots",draggable:!0,easing:"linear",edgeFriction:.35,fade:!1,focusOnSelect:!1,focusOnChange:!1,infinite:!0,initialSlide:0,lazyLoad:"ondemand",mobileFirst:!1,pauseOnHover:!0,pauseOnFocus:!0,pauseOnDotsHover:!1,respondTo:"window",responsive:null,rows:1,rtl:!1,slide:"",slidesPerRow:1,slidesToShow:1,slidesToScroll:1,speed:500,swipe:!0,swipeToSlide:!1,touchMove:!0,touchThreshold:5,useCSS:!0,useTransform:!0,variableWidth:!1,vertical:!1,verticalSwiping:!1,waitForAnimate:!0,zIndex:1e3},n.initials={animating:!1,dragging:!1,autoPlayTimer:null,currentDirection:0,currentLeft:null,currentSlide:0,direction:1,$dots:null,listWidth:null,listHeight:null,loadIndex:0,$nextArrow:null,$prevArrow:null,scrolling:!1,slideCount:null,slideWidth:null,$slideTrack:null,$slides:null,sliding:!1,slideOffset:0,swipeLeft:null,swiping:!1,$list:null,touchObject:{},transformsEnabled:!1,unslicked:!1},t.extend(n,n.initials),n.activeBreakpoint=null,n.animType=null,n.animProp=null,n.breakpoints=[],n.breakpointSettings=[],n.cssTransitions=!1,n.focussed=!1,n.interrupted=!1,n.hidden="hidden",n.paused=!0,n.positionProp=null,n.respondTo=null,n.rowCount=1,n.shouldClick=!0,n.$slider=t(e),n.$slidesCache=null,n.transformType=null,n.transitionType=null,n.visibilityChange="visibilitychange",n.windowWidth=0,n.windowTimer=null,r=t(e).data("slick")||{},n.options=t.extend({},n.defaults,i,r),n.currentSlide=n.options.initialSlide,n.originalSettings=n.options,"undefined"!=typeof document.mozHidden?(n.hidden="mozHidden",n.visibilityChange="mozvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(n.hidden="webkitHidden",n.visibilityChange="webkitvisibilitychange"),n.autoPlay=t.proxy(n.autoPlay,n),n.autoPlayClear=t.proxy(n.autoPlayClear,n),n.autoPlayIterator=t.proxy(n.autoPlayIterator,n),n.changeSlide=t.proxy(n.changeSlide,n),n.clickHandler=t.proxy(n.clickHandler,n),n.selectHandler=t.proxy(n.selectHandler,n),n.setPosition=t.proxy(n.setPosition,n),n.swipeHandler=t.proxy(n.swipeHandler,n),n.dragHandler=t.proxy(n.dragHandler,n),n.keyHandler=t.proxy(n.keyHandler,n),n.instanceUid=o++,n.htmlExpr=/^(?:\s*(<[\w\W]+>)[^>]*)$/,n.registerBreakpoints(),n.init(!0)}var o=0;return e}(),e.prototype.activateADA=function(){var t=this;t.$slideTrack.find(".slick-active").attr({"aria-hidden":"false"}).find("a, input, button, select").attr({tabindex:"0"})},e.prototype.addSlide=e.prototype.slickAdd=function(e,o,i){var r=this;if("boolean"==typeof o)i=o,o=null;else if(0>o||o>=r.slideCount)return!1;r.unload(),"number"==typeof o?0===o&&0===r.$slides.length?t(e).appendTo(r.$slideTrack):i?t(e).insertBefore(r.$slides.eq(o)):t(e).insertAfter(r.$slides.eq(o)):i===!0?t(e).prependTo(r.$slideTrack):t(e).appendTo(r.$slideTrack),r.$slides=r.$slideTrack.children(this.options.slide),r.$slideTrack.children(this.options.slide).detach(),r.$slideTrack.append(r.$slides),r.$slides.each(function(e,o){t(o).attr("data-slick-index",e)}),r.$slidesCache=r.$slides,r.reinit()},e.prototype.animateHeight=function(){var t=this;if(1===t.options.slidesToShow&&t.options.adaptiveHeight===!0&&t.options.vertical===!1){var e=t.$slides.eq(t.currentSlide).outerHeight(!0);t.$list.animate({height:e},t.options.speed)}},e.prototype.animateSlide=function(e,o){var i={},r=this;r.animateHeight(),r.options.rtl===!0&&r.options.vertical===!1&&(e=-e),r.transformsEnabled===!1?r.options.vertical===!1?r.$slideTrack.animate({left:e},r.options.speed,r.options.easing,o):r.$slideTrack.animate({top:e},r.options.speed,r.options.easing,o):r.cssTransitions===!1?(r.options.rtl===!0&&(r.currentLeft=-r.currentLeft),t({animStart:r.currentLeft}).animate({animStart:e},{duration:r.options.speed,easing:r.options.easing,step:function(t){t=Math.ceil(t),r.options.vertical===!1?(i[r.animType]="translate("+t+"px, 0px)",r.$slideTrack.css(i)):(i[r.animType]="translate(0px,"+t+"px)",r.$slideTrack.css(i))},complete:function(){o&&o.call()}})):(r.applyTransition(),e=Math.ceil(e),r.options.vertical===!1?i[r.animType]="translate3d("+e+"px, 0px, 0px)":i[r.animType]="translate3d(0px,"+e+"px, 0px)",r.$slideTrack.css(i),o&&setTimeout(function(){r.disableTransition(),o.call()},r.options.speed))},e.prototype.getNavTarget=function(){var e=this,o=e.options.asNavFor;return o&&null!==o&&(o=t(o).not(e.$slider)),o},e.prototype.asNavFor=function(e){var o=this,i=o.getNavTarget();null!==i&&"object"==typeof i&&i.each(function(){var o=t(this).slick("getSlick");o.unslicked||o.slideHandler(e,!0)})},e.prototype.applyTransition=function(t){var e=this,o={};e.options.fade===!1?o[e.transitionType]=e.transformType+" "+e.options.speed+"ms "+e.options.cssEase:o[e.transitionType]="opacity "+e.options.speed+"ms "+e.options.cssEase,e.options.fade===!1?e.$slideTrack.css(o):e.$slides.eq(t).css(o)},e.prototype.autoPlay=function(){var t=this;t.autoPlayClear(),t.slideCount>t.options.slidesToShow&&(t.autoPlayTimer=setInterval(t.autoPlayIterator,t.options.autoplaySpeed))},e.prototype.autoPlayClear=function(){var t=this;t.autoPlayTimer&&clearInterval(t.autoPlayTimer)},e.prototype.autoPlayIterator=function(){var t=this,e=t.currentSlide+t.options.slidesToScroll;t.paused||t.interrupted||t.focussed||(t.options.infinite===!1&&(1===t.direction&&t.currentSlide+1===t.slideCount-1?t.direction=0:0===t.direction&&(e=t.currentSlide-t.options.slidesToScroll,t.currentSlide-1===0&&(t.direction=1))),t.slideHandler(e))},e.prototype.buildArrows=function(){var e=this;e.options.arrows===!0&&(e.$prevArrow=t(e.options.prevArrow).addClass("slick-arrow"),e.$nextArrow=t(e.options.nextArrow).addClass("slick-arrow"),e.slideCount>e.options.slidesToShow?(e.$prevArrow.removeClass("slick-hidden").removeAttr("aria-hidden tabindex"),e.$nextArrow.removeClass("slick-hidden").removeAttr("aria-hidden tabindex"),e.htmlExpr.test(e.options.prevArrow)&&e.$prevArrow.prependTo(e.options.appendArrows),e.htmlExpr.test(e.options.nextArrow)&&e.$nextArrow.appendTo(e.options.appendArrows),e.options.infinite!==!0&&e.$prevArrow.addClass("slick-disabled").attr("aria-disabled","true")):e.$prevArrow.add(e.$nextArrow).addClass("slick-hidden").attr({"aria-disabled":"true",tabindex:"-1"}))},e.prototype.buildDots=function(){var e,o,i=this;if(i.options.dots===!0){for(i.$slider.addClass("slick-dotted"),o=t("<ul />").addClass(i.options.dotsClass),e=0;e<=i.getDotCount();e+=1)o.append(t("<li />").append(i.options.customPaging.call(this,i,e)));i.$dots=o.appendTo(i.options.appendDots),i.$dots.find("li").first().addClass("slick-active")}},e.prototype.buildOut=function(){var e=this;e.$slides=e.$slider.children(e.options.slide+":not(.slick-cloned)").addClass("slick-slide"),e.slideCount=e.$slides.length,e.$slides.each(function(e,o){t(o).attr("data-slick-index",e).data("originalStyling",t(o).attr("style")||"")}),e.$slider.addClass("slick-slider"),e.$slideTrack=0===e.slideCount?t('<div class="slick-track"/>').appendTo(e.$slider):e.$slides.wrapAll('<div class="slick-track"/>').parent(),e.$list=e.$slideTrack.wrap('<div class="slick-list"/>').parent(),e.$slideTrack.css("opacity",0),(e.options.centerMode===!0||e.options.swipeToSlide===!0)&&(e.options.slidesToScroll=1),t("img[data-lazy]",e.$slider).not("[src]").addClass("slick-loading"),e.setupInfinite(),e.buildArrows(),e.buildDots(),e.updateDots(),e.setSlideClasses("number"==typeof e.currentSlide?e.currentSlide:0),e.options.draggable===!0&&e.$list.addClass("draggable")},e.prototype.buildRows=function(){var t,e,o,i,r,n,s,a=this;if(i=document.createDocumentFragment(),n=a.$slider.children(),a.options.rows>1){for(s=a.options.slidesPerRow*a.options.rows,r=Math.ceil(n.length/s),t=0;r>t;t++){var l=document.createElement("div");for(e=0;e<a.options.rows;e++){var u=document.createElement("div");for(o=0;o<a.options.slidesPerRow;o++){var p=t*s+(e*a.options.slidesPerRow+o);n.get(p)&&u.appendChild(n.get(p))}l.appendChild(u)}i.appendChild(l)}a.$slider.empty().append(i),a.$slider.children().children().children().css({width:100/a.options.slidesPerRow+"%",display:"inline-block"})}},e.prototype.checkResponsive=function(e,o){var i,r,n,s=this,a=!1,l=s.$slider.width(),u=window.innerWidth||t(window).width();if("window"===s.respondTo?n=u:"slider"===s.respondTo?n=l:"min"===s.respondTo&&(n=Math.min(u,l)),s.options.responsive&&s.options.responsive.length&&null!==s.options.responsive){r=null;for(i in s.breakpoints)s.breakpoints.hasOwnProperty(i)&&(s.originalSettings.mobileFirst===!1?n<s.breakpoints[i]&&(r=s.breakpoints[i]):n>s.breakpoints[i]&&(r=s.breakpoints[i]));null!==r?null!==s.activeBreakpoint?(r!==s.activeBreakpoint||o)&&(s.activeBreakpoint=r,"unslick"===s.breakpointSettings[r]?s.unslick(r):(s.options=t.extend({},s.originalSettings,s.breakpointSettings[r]),e===!0&&(s.currentSlide=s.options.initialSlide),s.refresh(e)),a=r):(s.activeBreakpoint=r,"unslick"===s.breakpointSettings[r]?s.unslick(r):(s.options=t.extend({},s.originalSettings,s.breakpointSettings[r]),e===!0&&(s.currentSlide=s.options.initialSlide),s.refresh(e)),a=r):null!==s.activeBreakpoint&&(s.activeBreakpoint=null,s.options=s.originalSettings,e===!0&&(s.currentSlide=s.options.initialSlide),s.refresh(e),a=r),e||a===!1||s.$slider.trigger("breakpoint",[s,a])}},e.prototype.changeSlide=function(e,o){var i,r,n,s=this,a=t(e.currentTarget);switch(a.is("a")&&e.preventDefault(),a.is("li")||(a=a.closest("li")),n=s.slideCount%s.options.slidesToScroll!==0,i=n?0:(s.slideCount-s.currentSlide)%s.options.slidesToScroll,e.data.message){case"previous":r=0===i?s.options.slidesToScroll:s.options.slidesToShow-i,s.slideCount>s.options.slidesToShow&&s.slideHandler(s.currentSlide-r,!1,o);break;case"next":r=0===i?s.options.slidesToScroll:i,s.slideCount>s.options.slidesToShow&&s.slideHandler(s.currentSlide+r,!1,o);break;case"index":var l=0===e.data.index?0:e.data.index||a.index()*s.options.slidesToScroll;s.slideHandler(s.checkNavigable(l),!1,o),a.children().trigger("focus");break;default:return}},e.prototype.checkNavigable=function(t){var e,o,i=this;if(e=i.getNavigableIndexes(),o=0,t>e[e.length-1])t=e[e.length-1];else for(var r in e){if(t<e[r]){t=o;break}o=e[r]}return t},e.prototype.cleanUpEvents=function(){var e=this;e.options.dots&&null!==e.$dots&&(t("li",e.$dots).off("click.slick",e.changeSlide).off("mouseenter.slick",t.proxy(e.interrupt,e,!0)).off("mouseleave.slick",t.proxy(e.interrupt,e,!1)),e.options.accessibility===!0&&e.$dots.off("keydown.slick",e.keyHandler)),e.$slider.off("focus.slick blur.slick"),e.options.arrows===!0&&e.slideCount>e.options.slidesToShow&&(e.$prevArrow&&e.$prevArrow.off("click.slick",e.changeSlide),e.$nextArrow&&e.$nextArrow.off("click.slick",e.changeSlide),e.options.accessibility===!0&&(e.$prevArrow&&e.$prevArrow.off("keydown.slick",e.keyHandler),e.$nextArrow&&e.$nextArrow.off("keydown.slick",e.keyHandler))),e.$list.off("touchstart.slick mousedown.slick",e.swipeHandler),e.$list.off("touchmove.slick mousemove.slick",e.swipeHandler),e.$list.off("touchend.slick mouseup.slick",e.swipeHandler),e.$list.off("touchcancel.slick mouseleave.slick",e.swipeHandler),e.$list.off("click.slick",e.clickHandler),t(document).off(e.visibilityChange,e.visibility),e.cleanUpSlideEvents(),e.options.accessibility===!0&&e.$list.off("keydown.slick",e.keyHandler),e.options.focusOnSelect===!0&&t(e.$slideTrack).children().off("click.slick",e.selectHandler),t(window).off("orientationchange.slick.slick-"+e.instanceUid,e.orientationChange),t(window).off("resize.slick.slick-"+e.instanceUid,e.resize),t("[draggable!=true]",e.$slideTrack).off("dragstart",e.preventDefault),t(window).off("load.slick.slick-"+e.instanceUid,e.setPosition)},e.prototype.cleanUpSlideEvents=function(){var e=this;e.$list.off("mouseenter.slick",t.proxy(e.interrupt,e,!0)),e.$list.off("mouseleave.slick",t.proxy(e.interrupt,e,!1))},e.prototype.cleanUpRows=function(){var t,e=this;e.options.rows>1&&(t=e.$slides.children().children(),t.removeAttr("style"),e.$slider.empty().append(t))},e.prototype.clickHandler=function(t){var e=this;e.shouldClick===!1&&(t.stopImmediatePropagation(),t.stopPropagation(),t.preventDefault())},e.prototype.destroy=function(e){var o=this;o.autoPlayClear(),o.touchObject={},o.cleanUpEvents(),t(".slick-cloned",o.$slider).detach(),o.$dots&&o.$dots.remove(),o.$prevArrow&&o.$prevArrow.length&&(o.$prevArrow.removeClass("slick-disabled slick-arrow slick-hidden").removeAttr("aria-hidden aria-disabled tabindex").css("display",""),o.htmlExpr.test(o.options.prevArrow)&&o.$prevArrow.remove()),o.$nextArrow&&o.$nextArrow.length&&(o.$nextArrow.removeClass("slick-disabled slick-arrow slick-hidden").removeAttr("aria-hidden aria-disabled tabindex").css("display",""),o.htmlExpr.test(o.options.nextArrow)&&o.$nextArrow.remove()),o.$slides&&(o.$slides.removeClass("slick-slide slick-active slick-center slick-visible slick-current").removeAttr("aria-hidden").removeAttr("data-slick-index").each(function(){t(this).attr("style",t(this).data("originalStyling"))}),o.$slideTrack.children(this.options.slide).detach(),o.$slideTrack.detach(),o.$list.detach(),o.$slider.append(o.$slides)),o.cleanUpRows(),o.$slider.removeClass("slick-slider"),o.$slider.removeClass("slick-initialized"),o.$slider.removeClass("slick-dotted"),o.unslicked=!0,e||o.$slider.trigger("destroy",[o])},e.prototype.disableTransition=function(t){var e=this,o={};o[e.transitionType]="",e.options.fade===!1?e.$slideTrack.css(o):e.$slides.eq(t).css(o)},e.prototype.fadeSlide=function(t,e){var o=this;o.cssTransitions===!1?(o.$slides.eq(t).css({zIndex:o.options.zIndex}),o.$slides.eq(t).animate({opacity:1},o.options.speed,o.options.easing,e)):(o.applyTransition(t),o.$slides.eq(t).css({opacity:1,zIndex:o.options.zIndex}),e&&setTimeout(function(){o.disableTransition(t),e.call()},o.options.speed))},e.prototype.fadeSlideOut=function(t){var e=this;e.cssTransitions===!1?e.$slides.eq(t).animate({opacity:0,zIndex:e.options.zIndex-2},e.options.speed,e.options.easing):(e.applyTransition(t),e.$slides.eq(t).css({opacity:0,zIndex:e.options.zIndex-2}))},e.prototype.filterSlides=e.prototype.slickFilter=function(t){var e=this;null!==t&&(e.$slidesCache=e.$slides,e.unload(),e.$slideTrack.children(this.options.slide).detach(),e.$slidesCache.filter(t).appendTo(e.$slideTrack),e.reinit())},e.prototype.focusHandler=function(){var e=this;e.$slider.off("focus.slick blur.slick").on("focus.slick blur.slick","*",function(o){o.stopImmediatePropagation();var i=t(this);setTimeout(function(){e.options.pauseOnFocus&&(e.focussed=i.is(":focus"),e.autoPlay())},0)})},e.prototype.getCurrent=e.prototype.slickCurrentSlide=function(){var t=this;return t.currentSlide},e.prototype.getDotCount=function(){var t=this,e=0,o=0,i=0;if(t.options.infinite===!0)if(t.slideCount<=t.options.slidesToShow)++i;else for(;e<t.slideCount;)++i,e=o+t.options.slidesToScroll,o+=t.options.slidesToScroll<=t.options.slidesToShow?t.options.slidesToScroll:t.options.slidesToShow;else if(t.options.centerMode===!0)i=t.slideCount;else if(t.options.asNavFor)for(;e<t.slideCount;)++i,e=o+t.options.slidesToScroll,o+=t.options.slidesToScroll<=t.options.slidesToShow?t.options.slidesToScroll:t.options.slidesToShow;else i=1+Math.ceil((t.slideCount-t.options.slidesToShow)/t.options.slidesToScroll);return i-1},e.prototype.getLeft=function(t){var e,o,i,r,n=this,s=0;return n.slideOffset=0,o=n.$slides.first().outerHeight(!0),n.options.infinite===!0?(n.slideCount>n.options.slidesToShow&&(n.slideOffset=n.slideWidth*n.options.slidesToShow*-1,r=-1,n.options.vertical===!0&&n.options.centerMode===!0&&(2===n.options.slidesToShow?r=-1.5:1===n.options.slidesToShow&&(r=-2)),s=o*n.options.slidesToShow*r),n.slideCount%n.options.slidesToScroll!==0&&t+n.options.slidesToScroll>n.slideCount&&n.slideCount>n.options.slidesToShow&&(t>n.slideCount?(n.slideOffset=(n.options.slidesToShow-(t-n.slideCount))*n.slideWidth*-1,s=(n.options.slidesToShow-(t-n.slideCount))*o*-1):(n.slideOffset=n.slideCount%n.options.slidesToScroll*n.slideWidth*-1,s=n.slideCount%n.options.slidesToScroll*o*-1))):t+n.options.slidesToShow>n.slideCount&&(n.slideOffset=(t+n.options.slidesToShow-n.slideCount)*n.slideWidth,s=(t+n.options.slidesToShow-n.slideCount)*o),n.slideCount<=n.options.slidesToShow&&(n.slideOffset=0,s=0),n.options.centerMode===!0&&n.slideCount<=n.options.slidesToShow?n.slideOffset=n.slideWidth*Math.floor(n.options.slidesToShow)/2-n.slideWidth*n.slideCount/2:n.options.centerMode===!0&&n.options.infinite===!0?n.slideOffset+=n.slideWidth*Math.floor(n.options.slidesToShow/2)-n.slideWidth:n.options.centerMode===!0&&(n.slideOffset=0,n.slideOffset+=n.slideWidth*Math.floor(n.options.slidesToShow/2)),e=n.options.vertical===!1?t*n.slideWidth*-1+n.slideOffset:t*o*-1+s,n.options.variableWidth===!0&&(i=n.slideCount<=n.options.slidesToShow||n.options.infinite===!1?n.$slideTrack.children(".slick-slide").eq(t):n.$slideTrack.children(".slick-slide").eq(t+n.options.slidesToShow),e=n.options.rtl===!0?i[0]?-1*(n.$slideTrack.width()-i[0].offsetLeft-i.width()):0:i[0]?-1*i[0].offsetLeft:0,n.options.centerMode===!0&&(i=n.slideCount<=n.options.slidesToShow||n.options.infinite===!1?n.$slideTrack.children(".slick-slide").eq(t):n.$slideTrack.children(".slick-slide").eq(t+n.options.slidesToShow+1),e=n.options.rtl===!0?i[0]?-1*(n.$slideTrack.width()-i[0].offsetLeft-i.width()):0:i[0]?-1*i[0].offsetLeft:0,e+=(n.$list.width()-i.outerWidth())/2)),e},e.prototype.getOption=e.prototype.slickGetOption=function(t){var e=this;return e.options[t]},e.prototype.getNavigableIndexes=function(){var t,e=this,o=0,i=0,r=[];for(e.options.infinite===!1?t=e.slideCount:(o=-1*e.options.slidesToScroll,i=-1*e.options.slidesToScroll,t=2*e.slideCount);t>o;)r.push(o),o=i+e.options.slidesToScroll,i+=e.options.slidesToScroll<=e.options.slidesToShow?e.options.slidesToScroll:e.options.slidesToShow;return r},e.prototype.getSlick=function(){return this},e.prototype.getSlideCount=function(){var e,o,i,r=this;return i=r.options.centerMode===!0?r.slideWidth*Math.floor(r.options.slidesToShow/2):0,r.options.swipeToSlide===!0?(r.$slideTrack.find(".slick-slide").each(function(e,n){return n.offsetLeft-i+t(n).outerWidth()/2>-1*r.swipeLeft?(o=n,!1):void 0}),e=Math.abs(t(o).attr("data-slick-index")-r.currentSlide)||1):r.options.slidesToScroll},e.prototype.goTo=e.prototype.slickGoTo=function(t,e){var o=this;o.changeSlide({data:{message:"index",index:parseInt(t)}},e)},e.prototype.init=function(e){var o=this;t(o.$slider).hasClass("slick-initialized")||(t(o.$slider).addClass("slick-initialized"),o.buildRows(),o.buildOut(),o.setProps(),o.startLoad(),o.loadSlider(),o.initializeEvents(),o.updateArrows(),o.updateDots(),o.checkResponsive(!0),o.focusHandler()),e&&o.$slider.trigger("init",[o]),o.options.accessibility===!0&&o.initADA(),o.options.autoplay&&(o.paused=!1,o.autoPlay())},e.prototype.initADA=function(){var e=this,o=Math.ceil(e.slideCount/e.options.slidesToShow),i=e.getNavigableIndexes().filter(function(t){return t>=0&&t<e.slideCount});e.$slides.add(e.$slideTrack.find(".slick-cloned")).attr({"aria-hidden":"true",tabindex:"-1"}).find("a, input, button, select").attr({tabindex:"-1"}),null!==e.$dots&&(e.$slides.not(e.$slideTrack.find(".slick-cloned")).each(function(o){var r=i.indexOf(o);t(this).attr({role:"tabpanel",id:"slick-slide"+e.instanceUid+o,tabindex:-1}),-1!==r&&t(this).attr({"aria-describedby":"slick-slide-control"+e.instanceUid+r})}),e.$dots.attr("role","tablist").find("li").each(function(r){var n=i[r];t(this).attr({role:"presentation"}),t(this).find("button").first().attr({role:"tab",id:"slick-slide-control"+e.instanceUid+r,"aria-controls":"slick-slide"+e.instanceUid+n,"aria-label":r+1+" of "+o,"aria-selected":null,tabindex:"-1"})}).eq(e.currentSlide).find("button").attr({"aria-selected":"true",tabindex:"0"}).end());for(var r=e.currentSlide,n=r+e.options.slidesToShow;n>r;r++)e.$slides.eq(r).attr("tabindex",0);e.activateADA()},e.prototype.initArrowEvents=function(){var t=this;t.options.arrows===!0&&t.slideCount>t.options.slidesToShow&&(t.$prevArrow.off("click.slick").on("click.slick",{message:"previous"},t.changeSlide),t.$nextArrow.off("click.slick").on("click.slick",{message:"next"},t.changeSlide),t.options.accessibility===!0&&(t.$prevArrow.on("keydown.slick",t.keyHandler),t.$nextArrow.on("keydown.slick",t.keyHandler)))},e.prototype.initDotEvents=function(){var e=this;e.options.dots===!0&&(t("li",e.$dots).on("click.slick",{message:"index"},e.changeSlide),e.options.accessibility===!0&&e.$dots.on("keydown.slick",e.keyHandler)),e.options.dots===!0&&e.options.pauseOnDotsHover===!0&&t("li",e.$dots).on("mouseenter.slick",t.proxy(e.interrupt,e,!0)).on("mouseleave.slick",t.proxy(e.interrupt,e,!1))},e.prototype.initSlideEvents=function(){var e=this;e.options.pauseOnHover&&(e.$list.on("mouseenter.slick",t.proxy(e.interrupt,e,!0)),e.$list.on("mouseleave.slick",t.proxy(e.interrupt,e,!1)))},e.prototype.initializeEvents=function(){var e=this;e.initArrowEvents(),e.initDotEvents(),e.initSlideEvents(),e.$list.on("touchstart.slick mousedown.slick",{action:"start"},e.swipeHandler),e.$list.on("touchmove.slick mousemove.slick",{action:"move"},e.swipeHandler),e.$list.on("touchend.slick mouseup.slick",{action:"end"},e.swipeHandler),e.$list.on("touchcancel.slick mouseleave.slick",{action:"end"},e.swipeHandler),e.$list.on("click.slick",e.clickHandler),t(document).on(e.visibilityChange,t.proxy(e.visibility,e)),e.options.accessibility===!0&&e.$list.on("keydown.slick",e.keyHandler),e.options.focusOnSelect===!0&&t(e.$slideTrack).children().on("click.slick",e.selectHandler),t(window).on("orientationchange.slick.slick-"+e.instanceUid,t.proxy(e.orientationChange,e)),t(window).on("resize.slick.slick-"+e.instanceUid,t.proxy(e.resize,e)),t("[draggable!=true]",e.$slideTrack).on("dragstart",e.preventDefault),t(window).on("load.slick.slick-"+e.instanceUid,e.setPosition),t(e.setPosition)},e.prototype.initUI=function(){var t=this;t.options.arrows===!0&&t.slideCount>t.options.slidesToShow&&(t.$prevArrow.show(),t.$nextArrow.show()),t.options.dots===!0&&t.slideCount>t.options.slidesToShow&&t.$dots.show()},e.prototype.keyHandler=function(t){var e=this;t.target.tagName.match("TEXTAREA|INPUT|SELECT")||(37===t.keyCode&&e.options.accessibility===!0?e.changeSlide({data:{message:e.options.rtl===!0?"next":"previous"}}):39===t.keyCode&&e.options.accessibility===!0&&e.changeSlide({data:{message:e.options.rtl===!0?"previous":"next"}}))},e.prototype.lazyLoad=function(){function e(e){t("img[data-lazy]",e).each(function(){var e=t(this),o=t(this).attr("data-lazy"),i=t(this).attr("data-srcset"),r=t(this).attr("data-sizes")||s.$slider.attr("data-sizes"),n=document.createElement("img");n.onload=function(){e.animate({opacity:0},100,function(){i&&(e.attr("srcset",i),r&&e.attr("sizes",r)),e.attr("src",o).animate({opacity:1},200,function(){e.removeAttr("data-lazy data-srcset data-sizes").removeClass("slick-loading")}),s.$slider.trigger("lazyLoaded",[s,e,o])})},n.onerror=function(){e.removeAttr("data-lazy").removeClass("slick-loading").addClass("slick-lazyload-error"),s.$slider.trigger("lazyLoadError",[s,e,o])},n.src=o})}var o,i,r,n,s=this;if(s.options.centerMode===!0?s.options.infinite===!0?(r=s.currentSlide+(s.options.slidesToShow/2+1),n=r+s.options.slidesToShow+2):(r=Math.max(0,s.currentSlide-(s.options.slidesToShow/2+1)),n=2+(s.options.slidesToShow/2+1)+s.currentSlide):(r=s.options.infinite?s.options.slidesToShow+s.currentSlide:s.currentSlide,n=Math.ceil(r+s.options.slidesToShow),s.options.fade===!0&&(r>0&&r--,n<=s.slideCount&&n++)),o=s.$slider.find(".slick-slide").slice(r,n),"anticipated"===s.options.lazyLoad)for(var a=r-1,l=n,u=s.$slider.find(".slick-slide"),p=0;p<s.options.slidesToScroll;p++)0>a&&(a=s.slideCount-1),o=o.add(u.eq(a)),o=o.add(u.eq(l)),a--,l++;e(o),s.slideCount<=s.options.slidesToShow?(i=s.$slider.find(".slick-slide"),e(i)):s.currentSlide>=s.slideCount-s.options.slidesToShow?(i=s.$slider.find(".slick-cloned").slice(0,s.options.slidesToShow),e(i)):0===s.currentSlide&&(i=s.$slider.find(".slick-cloned").slice(-1*s.options.slidesToShow),e(i))},e.prototype.loadSlider=function(){var t=this;t.setPosition(),t.$slideTrack.css({opacity:1}),t.$slider.removeClass("slick-loading"),t.initUI(),"progressive"===t.options.lazyLoad&&t.progressiveLazyLoad()},e.prototype.next=e.prototype.slickNext=function(){var t=this;t.changeSlide({data:{message:"next"}})},e.prototype.orientationChange=function(){var t=this;t.checkResponsive(),t.setPosition()},e.prototype.pause=e.prototype.slickPause=function(){var t=this;t.autoPlayClear(),t.paused=!0},e.prototype.play=e.prototype.slickPlay=function(){var t=this;t.autoPlay(),t.options.autoplay=!0,t.paused=!1,t.focussed=!1,t.interrupted=!1},e.prototype.postSlide=function(e){var o=this;if(!o.unslicked&&(o.$slider.trigger("afterChange",[o,e]),o.animating=!1,o.slideCount>o.options.slidesToShow&&o.setPosition(),o.swipeLeft=null,o.options.autoplay&&o.autoPlay(),o.options.accessibility===!0&&(o.initADA(),o.options.focusOnChange))){var i=t(o.$slides.get(o.currentSlide));i.attr("tabindex",0).focus()}},e.prototype.prev=e.prototype.slickPrev=function(){var t=this;t.changeSlide({data:{message:"previous"}})},e.prototype.preventDefault=function(t){t.preventDefault()},e.prototype.progressiveLazyLoad=function(e){e=e||1;var o,i,r,n,s,a=this,l=t("img[data-lazy]",a.$slider);l.length?(o=l.first(),i=o.attr("data-lazy"),r=o.attr("data-srcset"),n=o.attr("data-sizes")||a.$slider.attr("data-sizes"),s=document.createElement("img"),s.onload=function(){r&&(o.attr("srcset",r),n&&o.attr("sizes",n)),o.attr("src",i).removeAttr("data-lazy data-srcset data-sizes").removeClass("slick-loading"),a.options.adaptiveHeight===!0&&a.setPosition(),a.$slider.trigger("lazyLoaded",[a,o,i]),a.progressiveLazyLoad()},s.onerror=function(){3>e?setTimeout(function(){a.progressiveLazyLoad(e+1)},500):(o.removeAttr("data-lazy").removeClass("slick-loading").addClass("slick-lazyload-error"),a.$slider.trigger("lazyLoadError",[a,o,i]),a.progressiveLazyLoad())},s.src=i):a.$slider.trigger("allImagesLoaded",[a])},e.prototype.refresh=function(e){var o,i,r=this;i=r.slideCount-r.options.slidesToShow,!r.options.infinite&&r.currentSlide>i&&(r.currentSlide=i),r.slideCount<=r.options.slidesToShow&&(r.currentSlide=0),o=r.currentSlide,r.destroy(!0),t.extend(r,r.initials,{currentSlide:o}),r.init(),e||r.changeSlide({data:{message:"index",index:o}},!1)},e.prototype.registerBreakpoints=function(){var e,o,i,r=this,n=r.options.responsive||null;if("array"===t.type(n)&&n.length){r.respondTo=r.options.respondTo||"window";for(e in n)if(i=r.breakpoints.length-1,n.hasOwnProperty(e)){for(o=n[e].breakpoint;i>=0;)r.breakpoints[i]&&r.breakpoints[i]===o&&r.breakpoints.splice(i,1),i--;r.breakpoints.push(o),r.breakpointSettings[o]=n[e].settings}r.breakpoints.sort(function(t,e){return r.options.mobileFirst?t-e:e-t})}},e.prototype.reinit=function(){var e=this;e.$slides=e.$slideTrack.children(e.options.slide).addClass("slick-slide"),e.slideCount=e.$slides.length,e.currentSlide>=e.slideCount&&0!==e.currentSlide&&(e.currentSlide=e.currentSlide-e.options.slidesToScroll),e.slideCount<=e.options.slidesToShow&&(e.currentSlide=0),e.registerBreakpoints(),e.setProps(),e.setupInfinite(),e.buildArrows(),e.updateArrows(),e.initArrowEvents(),e.buildDots(),e.updateDots(),e.initDotEvents(),e.cleanUpSlideEvents(),e.initSlideEvents(),e.checkResponsive(!1,!0),e.options.focusOnSelect===!0&&t(e.$slideTrack).children().on("click.slick",e.selectHandler),e.setSlideClasses("number"==typeof e.currentSlide?e.currentSlide:0),e.setPosition(),e.focusHandler(),e.paused=!e.options.autoplay,e.autoPlay(),e.$slider.trigger("reInit",[e])},e.prototype.resize=function(){var e=this;t(window).width()!==e.windowWidth&&(clearTimeout(e.windowDelay),e.windowDelay=window.setTimeout(function(){e.windowWidth=t(window).width(),e.checkResponsive(),e.unslicked||e.setPosition()},50))},e.prototype.removeSlide=e.prototype.slickRemove=function(t,e,o){var i=this;return"boolean"==typeof t?(e=t,t=e===!0?0:i.slideCount-1):t=e===!0?--t:t,i.slideCount<1||0>t||t>i.slideCount-1?!1:(i.unload(),o===!0?i.$slideTrack.children().remove():i.$slideTrack.children(this.options.slide).eq(t).remove(),i.$slides=i.$slideTrack.children(this.options.slide),i.$slideTrack.children(this.options.slide).detach(),i.$slideTrack.append(i.$slides),i.$slidesCache=i.$slides,void i.reinit())},e.prototype.setCSS=function(t){var e,o,i=this,r={};i.options.rtl===!0&&(t=-t),e="left"==i.positionProp?Math.ceil(t)+"px":"0px",o="top"==i.positionProp?Math.ceil(t)+"px":"0px",r[i.positionProp]=t,i.transformsEnabled===!1?i.$slideTrack.css(r):(r={},i.cssTransitions===!1?(r[i.animType]="translate("+e+", "+o+")",i.$slideTrack.css(r)):(r[i.animType]="translate3d("+e+", "+o+", 0px)",i.$slideTrack.css(r)))},e.prototype.setDimensions=function(){var t=this;t.options.vertical===!1?t.options.centerMode===!0&&t.$list.css({padding:"0px "+t.options.centerPadding}):(t.$list.height(t.$slides.first().outerHeight(!0)*t.options.slidesToShow),t.options.centerMode===!0&&t.$list.css({padding:t.options.centerPadding+" 0px"})),t.listWidth=t.$list.width(),t.listHeight=t.$list.height(),t.options.vertical===!1&&t.options.variableWidth===!1?(t.slideWidth=Math.ceil(t.listWidth/t.options.slidesToShow),t.$slideTrack.width(Math.ceil(t.slideWidth*t.$slideTrack.children(".slick-slide").length))):t.options.variableWidth===!0?t.$slideTrack.width(5e3*t.slideCount):(t.slideWidth=Math.ceil(t.listWidth),t.$slideTrack.height(Math.ceil(t.$slides.first().outerHeight(!0)*t.$slideTrack.children(".slick-slide").length)));var e=t.$slides.first().outerWidth(!0)-t.$slides.first().width();t.options.variableWidth===!1&&t.$slideTrack.children(".slick-slide").width(t.slideWidth-e)},e.prototype.setFade=function(){var e,o=this;o.$slides.each(function(i,r){e=o.slideWidth*i*-1,o.options.rtl===!0?t(r).css({position:"relative",right:e,top:0,zIndex:o.options.zIndex-2,opacity:0}):t(r).css({position:"relative",left:e,top:0,zIndex:o.options.zIndex-2,opacity:0})}),o.$slides.eq(o.currentSlide).css({zIndex:o.options.zIndex-1,opacity:1})},e.prototype.setHeight=function(){var t=this;if(1===t.options.slidesToShow&&t.options.adaptiveHeight===!0&&t.options.vertical===!1){var e=t.$slides.eq(t.currentSlide).outerHeight(!0);t.$list.css("height",e)}},e.prototype.setOption=e.prototype.slickSetOption=function(){var e,o,i,r,n,s=this,a=!1;if("object"===t.type(arguments[0])?(i=arguments[0],a=arguments[1],n="multiple"):"string"===t.type(arguments[0])&&(i=arguments[0],r=arguments[1],a=arguments[2],"responsive"===arguments[0]&&"array"===t.type(arguments[1])?n="responsive":"undefined"!=typeof arguments[1]&&(n="single")),"single"===n)s.options[i]=r;else if("multiple"===n)t.each(i,function(t,e){s.options[t]=e});else if("responsive"===n)for(o in r)if("array"!==t.type(s.options.responsive))s.options.responsive=[r[o]];else{for(e=s.options.responsive.length-1;e>=0;)s.options.responsive[e].breakpoint===r[o].breakpoint&&s.options.responsive.splice(e,1),e--;s.options.responsive.push(r[o])}a&&(s.unload(),s.reinit())},e.prototype.setPosition=function(){var t=this;t.setDimensions(),t.setHeight(),t.options.fade===!1?t.setCSS(t.getLeft(t.currentSlide)):t.setFade(),t.$slider.trigger("setPosition",[t])},e.prototype.setProps=function(){var t=this,e=document.body.style;t.positionProp=t.options.vertical===!0?"top":"left","top"===t.positionProp?t.$slider.addClass("slick-vertical"):t.$slider.removeClass("slick-vertical"),(void 0!==e.WebkitTransition||void 0!==e.MozTransition||void 0!==e.msTransition)&&t.options.useCSS===!0&&(t.cssTransitions=!0),t.options.fade&&("number"==typeof t.options.zIndex?t.options.zIndex<3&&(t.options.zIndex=3):t.options.zIndex=t.defaults.zIndex),void 0!==e.OTransform&&(t.animType="OTransform",t.transformType="-o-transform",t.transitionType="OTransition",void 0===e.perspectiveProperty&&void 0===e.webkitPerspective&&(t.animType=!1)),void 0!==e.MozTransform&&(t.animType="MozTransform",t.transformType="-moz-transform",t.transitionType="MozTransition",void 0===e.perspectiveProperty&&void 0===e.MozPerspective&&(t.animType=!1)),void 0!==e.webkitTransform&&(t.animType="webkitTransform",t.transformType="-webkit-transform",t.transitionType="webkitTransition",void 0===e.perspectiveProperty&&void 0===e.webkitPerspective&&(t.animType=!1)),void 0!==e.msTransform&&(t.animType="msTransform",t.transformType="-ms-transform",t.transitionType="msTransition",
void 0===e.msTransform&&(t.animType=!1)),void 0!==e.transform&&t.animType!==!1&&(t.animType="transform",t.transformType="transform",t.transitionType="transition"),t.transformsEnabled=t.options.useTransform&&null!==t.animType&&t.animType!==!1},e.prototype.setSlideClasses=function(t){var e,o,i,r,n=this;if(o=n.$slider.find(".slick-slide").removeClass("slick-active slick-center slick-current").attr("aria-hidden","true"),n.$slides.eq(t).addClass("slick-current"),n.options.centerMode===!0){var s=n.options.slidesToShow%2===0?1:0;e=Math.floor(n.options.slidesToShow/2),n.options.infinite===!0&&(t>=e&&t<=n.slideCount-1-e?n.$slides.slice(t-e+s,t+e+1).addClass("slick-active").attr("aria-hidden","false"):(i=n.options.slidesToShow+t,o.slice(i-e+1+s,i+e+2).addClass("slick-active").attr("aria-hidden","false")),0===t?o.eq(o.length-1-n.options.slidesToShow).addClass("slick-center"):t===n.slideCount-1&&o.eq(n.options.slidesToShow).addClass("slick-center")),n.$slides.eq(t).addClass("slick-center")}else t>=0&&t<=n.slideCount-n.options.slidesToShow?n.$slides.slice(t,t+n.options.slidesToShow).addClass("slick-active").attr("aria-hidden","false"):o.length<=n.options.slidesToShow?o.addClass("slick-active").attr("aria-hidden","false"):(r=n.slideCount%n.options.slidesToShow,i=n.options.infinite===!0?n.options.slidesToShow+t:t,n.options.slidesToShow==n.options.slidesToScroll&&n.slideCount-t<n.options.slidesToShow?o.slice(i-(n.options.slidesToShow-r),i+r).addClass("slick-active").attr("aria-hidden","false"):o.slice(i,i+n.options.slidesToShow).addClass("slick-active").attr("aria-hidden","false"));("ondemand"===n.options.lazyLoad||"anticipated"===n.options.lazyLoad)&&n.lazyLoad()},e.prototype.setupInfinite=function(){var e,o,i,r=this;if(r.options.fade===!0&&(r.options.centerMode=!1),r.options.infinite===!0&&r.options.fade===!1&&(o=null,r.slideCount>r.options.slidesToShow)){for(i=r.options.centerMode===!0?r.options.slidesToShow+1:r.options.slidesToShow,e=r.slideCount;e>r.slideCount-i;e-=1)o=e-1,t(r.$slides[o]).clone(!0).attr("id","").attr("data-slick-index",o-r.slideCount).prependTo(r.$slideTrack).addClass("slick-cloned");for(e=0;e<i+r.slideCount;e+=1)o=e,t(r.$slides[o]).clone(!0).attr("id","").attr("data-slick-index",o+r.slideCount).appendTo(r.$slideTrack).addClass("slick-cloned");r.$slideTrack.find(".slick-cloned").find("[id]").each(function(){t(this).attr("id","")})}},e.prototype.interrupt=function(t){var e=this;t||e.autoPlay(),e.interrupted=t},e.prototype.selectHandler=function(e){var o=this,i=t(e.target).is(".slick-slide")?t(e.target):t(e.target).parents(".slick-slide"),r=parseInt(i.attr("data-slick-index"));return r||(r=0),o.slideCount<=o.options.slidesToShow?void o.slideHandler(r,!1,!0):void o.slideHandler(r)},e.prototype.slideHandler=function(t,e,o){var i,r,n,s,a,l=null,u=this;return e=e||!1,u.animating===!0&&u.options.waitForAnimate===!0||u.options.fade===!0&&u.currentSlide===t?void 0:(e===!1&&u.asNavFor(t),i=t,l=u.getLeft(i),s=u.getLeft(u.currentSlide),u.currentLeft=null===u.swipeLeft?s:u.swipeLeft,u.options.infinite===!1&&u.options.centerMode===!1&&(0>t||t>u.getDotCount()*u.options.slidesToScroll)?void(u.options.fade===!1&&(i=u.currentSlide,o!==!0?u.animateSlide(s,function(){u.postSlide(i)}):u.postSlide(i))):u.options.infinite===!1&&u.options.centerMode===!0&&(0>t||t>u.slideCount-u.options.slidesToScroll)?void(u.options.fade===!1&&(i=u.currentSlide,o!==!0?u.animateSlide(s,function(){u.postSlide(i)}):u.postSlide(i))):(u.options.autoplay&&clearInterval(u.autoPlayTimer),r=0>i?u.slideCount%u.options.slidesToScroll!==0?u.slideCount-u.slideCount%u.options.slidesToScroll:u.slideCount+i:i>=u.slideCount?u.slideCount%u.options.slidesToScroll!==0?0:i-u.slideCount:i,u.animating=!0,u.$slider.trigger("beforeChange",[u,u.currentSlide,r]),n=u.currentSlide,u.currentSlide=r,u.setSlideClasses(u.currentSlide),u.options.asNavFor&&(a=u.getNavTarget(),a=a.slick("getSlick"),a.slideCount<=a.options.slidesToShow&&a.setSlideClasses(u.currentSlide)),u.updateDots(),u.updateArrows(),u.options.fade===!0?(o!==!0?(u.fadeSlideOut(n),u.fadeSlide(r,function(){u.postSlide(r)})):u.postSlide(r),void u.animateHeight()):void(o!==!0?u.animateSlide(l,function(){u.postSlide(r)}):u.postSlide(r))))},e.prototype.startLoad=function(){var t=this;t.options.arrows===!0&&t.slideCount>t.options.slidesToShow&&(t.$prevArrow.hide(),t.$nextArrow.hide()),t.options.dots===!0&&t.slideCount>t.options.slidesToShow&&t.$dots.hide(),t.$slider.addClass("slick-loading")},e.prototype.swipeDirection=function(){var t,e,o,i,r=this;return t=r.touchObject.startX-r.touchObject.curX,e=r.touchObject.startY-r.touchObject.curY,o=Math.atan2(e,t),i=Math.round(180*o/Math.PI),0>i&&(i=360-Math.abs(i)),45>=i&&i>=0?r.options.rtl===!1?"left":"right":360>=i&&i>=315?r.options.rtl===!1?"left":"right":i>=135&&225>=i?r.options.rtl===!1?"right":"left":r.options.verticalSwiping===!0?i>=35&&135>=i?"down":"up":"vertical"},e.prototype.swipeEnd=function(t){var e,o,i=this;if(i.dragging=!1,i.swiping=!1,i.scrolling)return i.scrolling=!1,!1;if(i.interrupted=!1,i.shouldClick=i.touchObject.swipeLength>10?!1:!0,void 0===i.touchObject.curX)return!1;if(i.touchObject.edgeHit===!0&&i.$slider.trigger("edge",[i,i.swipeDirection()]),i.touchObject.swipeLength>=i.touchObject.minSwipe){switch(o=i.swipeDirection()){case"left":case"down":e=i.options.swipeToSlide?i.checkNavigable(i.currentSlide+i.getSlideCount()):i.currentSlide+i.getSlideCount(),i.currentDirection=0;break;case"right":case"up":e=i.options.swipeToSlide?i.checkNavigable(i.currentSlide-i.getSlideCount()):i.currentSlide-i.getSlideCount(),i.currentDirection=1}"vertical"!=o&&(i.slideHandler(e),i.touchObject={},i.$slider.trigger("swipe",[i,o]))}else i.touchObject.startX!==i.touchObject.curX&&(i.slideHandler(i.currentSlide),i.touchObject={})},e.prototype.swipeHandler=function(t){var e=this;if(!(e.options.swipe===!1||"ontouchend"in document&&e.options.swipe===!1||e.options.draggable===!1&&-1!==t.type.indexOf("mouse")))switch(e.touchObject.fingerCount=t.originalEvent&&void 0!==t.originalEvent.touches?t.originalEvent.touches.length:1,e.touchObject.minSwipe=e.listWidth/e.options.touchThreshold,e.options.verticalSwiping===!0&&(e.touchObject.minSwipe=e.listHeight/e.options.touchThreshold),t.data.action){case"start":e.swipeStart(t);break;case"move":e.swipeMove(t);break;case"end":e.swipeEnd(t)}},e.prototype.swipeMove=function(t){var e,o,i,r,n,s,a=this;return n=void 0!==t.originalEvent?t.originalEvent.touches:null,!a.dragging||a.scrolling||n&&1!==n.length?!1:(e=a.getLeft(a.currentSlide),a.touchObject.curX=void 0!==n?n[0].pageX:t.clientX,a.touchObject.curY=void 0!==n?n[0].pageY:t.clientY,a.touchObject.swipeLength=Math.round(Math.sqrt(Math.pow(a.touchObject.curX-a.touchObject.startX,2))),s=Math.round(Math.sqrt(Math.pow(a.touchObject.curY-a.touchObject.startY,2))),!a.options.verticalSwiping&&!a.swiping&&s>4?(a.scrolling=!0,!1):(a.options.verticalSwiping===!0&&(a.touchObject.swipeLength=s),o=a.swipeDirection(),void 0!==t.originalEvent&&a.touchObject.swipeLength>4&&(a.swiping=!0,t.preventDefault()),r=(a.options.rtl===!1?1:-1)*(a.touchObject.curX>a.touchObject.startX?1:-1),a.options.verticalSwiping===!0&&(r=a.touchObject.curY>a.touchObject.startY?1:-1),i=a.touchObject.swipeLength,a.touchObject.edgeHit=!1,a.options.infinite===!1&&(0===a.currentSlide&&"right"===o||a.currentSlide>=a.getDotCount()&&"left"===o)&&(i=a.touchObject.swipeLength*a.options.edgeFriction,a.touchObject.edgeHit=!0),a.options.vertical===!1?a.swipeLeft=e+i*r:a.swipeLeft=e+i*(a.$list.height()/a.listWidth)*r,a.options.verticalSwiping===!0&&(a.swipeLeft=e+i*r),a.options.fade===!0||a.options.touchMove===!1?!1:a.animating===!0?(a.swipeLeft=null,!1):void a.setCSS(a.swipeLeft)))},e.prototype.swipeStart=function(t){var e,o=this;return o.interrupted=!0,1!==o.touchObject.fingerCount||o.slideCount<=o.options.slidesToShow?(o.touchObject={},!1):(void 0!==t.originalEvent&&void 0!==t.originalEvent.touches&&(e=t.originalEvent.touches[0]),o.touchObject.startX=o.touchObject.curX=void 0!==e?e.pageX:t.clientX,o.touchObject.startY=o.touchObject.curY=void 0!==e?e.pageY:t.clientY,void(o.dragging=!0))},e.prototype.unfilterSlides=e.prototype.slickUnfilter=function(){var t=this;null!==t.$slidesCache&&(t.unload(),t.$slideTrack.children(this.options.slide).detach(),t.$slidesCache.appendTo(t.$slideTrack),t.reinit())},e.prototype.unload=function(){var e=this;t(".slick-cloned",e.$slider).remove(),e.$dots&&e.$dots.remove(),e.$prevArrow&&e.htmlExpr.test(e.options.prevArrow)&&e.$prevArrow.remove(),e.$nextArrow&&e.htmlExpr.test(e.options.nextArrow)&&e.$nextArrow.remove(),e.$slides.removeClass("slick-slide slick-active slick-visible slick-current").attr("aria-hidden","true").css("width","")},e.prototype.unslick=function(t){var e=this;e.$slider.trigger("unslick",[e,t]),e.destroy()},e.prototype.updateArrows=function(){var t,e=this;t=Math.floor(e.options.slidesToShow/2),e.options.arrows===!0&&e.slideCount>e.options.slidesToShow&&!e.options.infinite&&(e.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false"),e.$nextArrow.removeClass("slick-disabled").attr("aria-disabled","false"),0===e.currentSlide?(e.$prevArrow.addClass("slick-disabled").attr("aria-disabled","true"),e.$nextArrow.removeClass("slick-disabled").attr("aria-disabled","false")):e.currentSlide>=e.slideCount-e.options.slidesToShow&&e.options.centerMode===!1?(e.$nextArrow.addClass("slick-disabled").attr("aria-disabled","true"),e.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false")):e.currentSlide>=e.slideCount-1&&e.options.centerMode===!0&&(e.$nextArrow.addClass("slick-disabled").attr("aria-disabled","true"),e.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false")))},e.prototype.updateDots=function(){var t=this;null!==t.$dots&&(t.$dots.find("li").removeClass("slick-active").end(),t.$dots.find("li").eq(Math.floor(t.currentSlide/t.options.slidesToScroll)).addClass("slick-active"))},e.prototype.visibility=function(){var t=this;t.options.autoplay&&(document[t.hidden]?t.interrupted=!0:t.interrupted=!1)},t.fn.slick=function(){var t,o,i=this,r=arguments[0],n=Array.prototype.slice.call(arguments,1),s=i.length;for(t=0;s>t;t++)if("object"==typeof r||"undefined"==typeof r?i[t].slick=new e(i[t],r):o=i[t].slick[r].apply(i[t].slick,n),"undefined"!=typeof o)return o;return i}}),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Classes"),t.Router=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.initialize=function(t){return this.route("classes(/:category)(/)","index",t.controller.index),this.route("classes/myclasses(/)","myClasses",t.controller.myClasses),this.route(/classes\/(\d+)\/?(.+)?\/?/,"show",t.controller.show),this.route(/classes\/(\d+)\/?(.+)?\/lessons\/?/,"show",t.controller.lessons),this.route(/classes\/(\d+)\/?(.+)?\/video\/?/,"video",t.controller.video),this.route(/classes\/(\d+)\/?(.+)?\/exercise\/?/,"exercise",t.controller.exercise),this.route("photo/:photo_id/:photo_slug(/)","showPhoto",t.controller.showPhoto),this.scrollPositions={},this.pageHistory=[],this.bind("route",this._trackPageview)},o.prototype.navigate=function(t,e){var i;return null==e&&(e={}),i=App.currentPath(),t.replace(/(\?|&)page=\d+\b/,"")===i.replace(/(\?|&)page=\d+\b/,"")&&null==e.replace&&(e.replace=!0),o.__super__.navigate.call(this,t,e),this._trackPageview()},o.prototype.execute=function(t,e,o){return this._storeScrollPosition(),t&&t.apply(this,e),this._restoreScrollPosition(e,o)},o.prototype._trackPageview=function(){var t;return t=Backbone.history.getFragment(),PxApp.GA.pageview(t)},o.prototype._restoreScrollPosition=function(t,e){var o;return o="index"===e?"index":o="show"===e?"show_"+t[0]:Backbone.history.getFragment(),$(document).scrollTop(this.scrollPositions[o]||0),this.pageHistory.push(o)},o.prototype._storeScrollPosition=function(){var t;return t=_.last(this.pageHistory),t?this.scrollPositions[t]=$(document).scrollTop():void 0},o}(Backbone.Marionette.AppRouter)}.call(this),function(){var t=function(t,o){function i(){this.constructor=t}for(var r in o)e.call(o,r)&&(t[r]=o[r]);return i.prototype=o.prototype,t.prototype=new i,t.__super__=o.prototype,t},e={}.hasOwnProperty;null==window.PxApp&&(window.PxApp={}),null==PxApp.Models&&(PxApp.Models={}),PxApp.Model=function(e){function o(){o.__super__.constructor.apply(this,arguments),this.original_attributes=_.extend({},this.attributes)}return t(o,e),o.prototype.fetch=function(t){var e,i,r;return null==t&&(t={}),e=$.Deferred(),r=t.success,i=t.error,t.success=function(t){return function(t,o,i){return e.resolve(t,o,i),"function"==typeof r?r(t,o,i):void 0}}(this),t.error=function(t){return function(t,o,r){return e.reject(t,o,r),"function"==typeof i?i(t,o,r):void 0}}(this),o.__super__.fetch.call(this,t),e.promise()},o.prototype.save=function(t,e){var i,r,n,s;return null==e&&(e={}),i=$.Deferred(),s=e.success,r=e.error,e.success=function(t){return function(e,o,r){return t.original_attributes=_.extend({},t.attributes),i.resolve(e,o,r),"function"==typeof s?s(e,o,r):void 0}}(this),e.error=function(t){return function(t,e,o){return i.reject(t,e,o),"function"==typeof r?r(t,e,o):void 0}}(this),n=o.__super__.save.call(this,t,e),!1===n&&i.reject(this.validationError),i.promise()},o.prototype.reload=function(){return this.set(this.original_attributes),this.validationError=null},o.prototype.destroy=function(t){var e,i,r,n;return null==t&&(t={}),e=$.Deferred(),n=t.success,i=t.error,t.success=function(t){return function(t,o,i){return e.resolve(t,o,i),"function"==typeof n?n(t,o,i):void 0}}(this),t.error=function(t){return function(t,o,r){return e.reject(t,o,r),"function"==typeof i?i(t,o,r):void 0}}(this),r=o.__super__.destroy.call(this,t),!1===r&&e.reject(),e.promise()},o.prototype.errors=function(){var t;return null!=(t=this.validationError)?t:{}},o.prototype.validate=function(t,e){var o,i,r,n,s,a;if(null==this.get("id")&&t.id)return!1;r={},i=0;for(o in t)a=t[o],s="function"==typeof this[n="validate_"+o]?this[n](a,t):void 0,s&&(r[o]=s,i++);return i>0?r:void 0},o}(Backbone.Model)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;PxApp.Models.User=function(o){function i(){return this.is_active=t(this.is_active,this),this.get_comments=t(this.get_comments,this),this.user_link=t(this.user_link,this),this.is_free=t(this.is_free,this),this.avatar_url=t(this.avatar_url,this),this.membership_name=t(this.membership_name,this),this.url=t(this.url,this),i.__super__.constructor.apply(this,arguments)}return e(i,o),i.MEMBER={FREE:0,PLUS:1,AWESOME:2,PARTNER:3,EDITOR:8},i.prototype.AVATAR_NUMBERS={"default":1,large:2,medium:2,small:3,tiny:4},i.prototype.AVATAR_NUMBERS_RETINA={"default":1,large:1,medium:1,small:2,tiny:3},i.prototype.AVATAR_SIZES={tiny:30,small:50,medium:64,large:100,"default":300},i.USER_AVATAR_DIRECTIVES={"class":function(){var t;return t=["user_avatar"],this.user_avatar.user&&t.push("user_"+this.user_avatar.user.membership_name()),t.push("size_"+this.user_avatar.size),this.user_avatar.user&&!this.user_avatar.user.is_active()&&t.push("deactivated"),t.join(" ")},"data-user-id":function(){return this.user_avatar.user?this.user_avatar.user.id:void 0},tooltip:{"class":function(){var t;return t=["tooltip"],this.user&&this.tooltip&&this.user.is_active()&&this.user.id&&t.push("display"),t.join(" ")},text:function(){return this.user&&this.user.id?this.user.get("fullname"):void 0}},link:{href:function(){return this.user&&this.user.id&&this.user.is_active()?PxAppUrl+"/"+this.user.get("username"):null}},image:{src:function(){return this.user?this.user.avatar_url(this.size):PxAppUrl+"/graphics/userpic.png"}},membership_icon:{"class":function(){var t;return t=["membership_tag"],this.user?t.push(""+this.user.membership_name()):t.push("free"),t.join(" ")},href:function(){var t;return this.user&&(t=function(){switch(this.user.membership_name()){case"staff":return"/team";case"editor":return"/editors";case"plus":return"/upgrade";case"awesome":return"/upgrade"}}.call(this))?""+PxAppUrl+t:void 0},text:function(){var t;return this.user?t=function(){switch(this.user.membership_name()){case"staff":return"500px";case"editor":return"Editor";case"plus":return"Plus";case"awesome":return"Awesome";case"partner":return"Partner"}}.call(this):void 0}}},i.prototype.url=function(){return PxApp.Constants.API_URL+"/users/"+this.id},i.prototype.membership_name=function(){if(this.get("admin"))return"staff";if(this.get("usertype")===this.constructor.MEMBER.PARTNER)return"partner";if(this.get("usertype")===this.constructor.MEMBER.EDITOR)return"editor";switch(this.get("upgrade_status")){case 0:return"free";case 1:return"plus";case 2:return"awesome"}},i.prototype.membership_text=function(){var t;return t=function(){switch(this.membership_name()){case"staff":return"500px";case"editor":return"Editor";case"plus":return"Plus";case"awesome":return"Awesome";case"partner":return"Partner"}}.call(this)},i.prototype.avatar_url=function(t){var e,o;return o=this.get("userpic_url"),e=PxInitialData.avatar_cdn_url.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1"),o.match(new RegExp("^"+e))&&(o=window.devicePixelRatio>1?o.replace(/\d+(?=\.jpg(?:\?\d+)?$)/,this.AVATAR_NUMBERS_RETINA[t]):o.replace(/\d+(?=\.jpg(?:\?\d+)?$)/,this.AVATAR_NUMBERS[t])),o},i.prototype.is_free=function(){return this.get("upgrade_status")===this.constructor.MEMBER.FREE},i.prototype.is_plus=function(){return this.get("upgrade_status")===this.constructor.MEMBER.PLUS},i.prototype.hasGATrackingEnabled=function(){return PxCurrentUser.isAuthorized("ga_tracking")},i.prototype.user_link=function(){return this.is_active()?$(_.template('<a href="%{url}" class="user_profile_link">%{fullname}</a>',{url:PxAppUrl+"/"+this.get("username"),fullname:this.get("fullname")})):$(_.template('<a class="user_profile_link inactive">%{fullname}</a>',{fullname:this.get("fullname")}))},i.prototype.get_comments=function(t){var e;return e=PxApp.api.get("/users/"+this.id+"/comments?sort=created_at&nested=1&include_flagged=1"),e.success(function(e){return function(o){return e.comments=new PxApp.Collections.User.Comments(o.comments,{target:e}),null!=t(e)}}(this))},i.prototype.parse=function(t){var e;return null!=(e=t.user)?e:t},i.prototype.is_active=function(){return!this.get("banned")&&!this.get("deactivated")&&!this.get("not_active")},i.prototype.getUpcomingWorkshop=function(){var t;return t=$.Deferred(),null!=this._upcomingWorkshop?t.resolve(this._upcomingWorkshop):$.get(PxApp.Constants.API_URL+"/workshops/upcoming_workshop/"+this.id).done(function(e){return function(o){return(null!=o?o.upcoming_workshop:void 0)?e._upcomingWorkshop=new Backbone.Model(o.upcoming_workshop):e._upcomingWorkshop=!1,t.resolve(e._upcomingWorkshop)}}(this)).fail(function(e){return function(){return t.resolve(!1)}}(this)),t},i}(PxApp.Model)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Models"),t.Quest=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.url=function(){var t;return t={cover_size:PxApp.Constants.PHOTO_GRID_IMAGE_SIZES,image_size:PxApp.Constants.PHOTO_GRID_IMAGE_SIZES},this.getAccessToken()&&(t.token=this.getAccessToken()),PxApp.Constants.API_URL+"/quests/"+this.id+"?"+$.param(t)},o.prototype.getCanonicalPath=function(){return"/quests/"+this.get("id")+"/"+this.get("slug")},o.prototype.getCanonicalUrl=function(){return""+PxApp.Constants.MAIN_500PX_URL+this.getCanonicalPath()},o.prototype.parse=function(t){var e;return null!=(e=t.quest)?e:t},o.prototype.getCoverPhoto=function(){return null==this.get("cover_photo")||$.isFunction(this.get("cover_photo").get)||this.set("cover_photo",App.Photos.Models.PhotoManager.createOrUpdateModel(this.get("cover_photo"))),this.get("cover_photo")},o.prototype.sponsorCTAPath=function(){return this.isPubliclyVisible()?"/quests/sponsor/"+this.get("id"):"/quests/sponsor/"+this.get("id")+"?token="+this.getAccessToken()},o.prototype.hasWinners=function(){var t;return(null!=(t=this.get("winners"))?t.length:void 0)>0},o.prototype.hasSampleGallery=function(){return!!this.get("sample_gallery")},o.prototype.isSponsored=function(){return null!=this.get("sponsor_name")&&""!==this.get("sponsor_name")&&!this.isBranded()},o.prototype.isBranded=function(){return null!=this.get("sponsor_cta_label")&&""!==this.get("sponsor_cta_label")},o.prototype.isCompleted=function(){return"completed"===this.get("status")},o.prototype.isDraft=function(){return"draft"===this.get("status")},o.prototype.isPublished=function(){return"published"===this.get("status")},o.prototype.isStarted=function(){return new Date(this.get("starts_at"))<=Date.now()},o.prototype.isEnded=function(){return new Date(this.get("ends_at"))<=Date.now()},o.prototype.isGeofenced=function(){return this.get("geofenced")},o.prototype.isWithinGeofence=function(){return this.get("user_within_geofence")},o.prototype.isVisible=function(){return!this.isGeofenced()||this.isWithinGeofence()},o.prototype.isPubliclyVisible=function(){var t;return("published"===(t=this.get("status"))||"completed"===t)&&this.isStarted()},o.prototype.share=function(t,e){return null==this.popup&&(this.popup=new App.Lib.Sharelizer({url:this.getCanonicalUrl(),category:"Quest Page"})),this[t](e)},o.prototype.google=function(t){return this.popup.google()},o.prototype.facebook=function(t){return this.popup.facebook()},o.prototype.vk=function(t){return this.popup.vk()},o.prototype._pinterestShareData=function(){var t;return{media:null!=(t=this.getCoverPhoto())?t.url():void 0,description:this.get("extract")}},o.prototype.pinterest=function(t){var e;return e=this._pinterestShareData(),this.popup.pinterest(e.media,e.description)},o.prototype._twitterShareData=function(){return{text:"Check out "+this.get("title")+" - a photo quest on #500px"}},o.prototype.twitter=function(t){var e;return e=this._twitterShareData(),this.popup.twitter(e.text)},o.prototype._stumbleuponShareData=function(){return{title:"Check out "+this.get("title")+" - a photo quest on #500px"}},o.prototype.stumbleupon=function(t){var e;return e=this._stumbleuponShareData(),this.popup.stumbleupon(e)},o.prototype.getAccessToken=function(){return App.Helpers.getQueryParam("token")},o.prototype.removePhoto=function(t){return $.ajax({type:"DELETE",url:PxApp.Constants.API_URL+"/quests/"+this.get("id")+"/entries/"+t.id})},o}(Backbone.Model)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},o=function(t,e){function o(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},i={}.hasOwnProperty;t=App.module("Classes.Models"),t.Course=function(t){function i(){return this._updateEnrollmentStatus=e(this._updateEnrollmentStatus,this),i.__super__.constructor.apply(this,arguments)}return o(i,t),i.prototype.modelName="App.Classes.Models.Course",i.prototype.urlRoot=function(){return PxApp.Constants.API_URL+"/classes"},i.prototype.coverPhotoUrl=function(t){return this.get("cover_photo")?_.find(this.get("cover_photo").images,function(e){return e.size===t}).https_url:void 0},i.prototype.getPath=function(){return"/classes/"+this.get("id")+"/"+this.get("slug")},i.prototype.getLessonsPath=function(){return this.getPath()+"/lessons"},i.prototype.getVideoPath=function(){return this.getPath()+"/video"},i.prototype.getExercisePath=function(){return this.getPath()+"/exercise"},i.prototype.getWatchPath=function(){return this.getPath()+"/watch"},i.prototype.getPhotos=function(){return null!=this.photos?this.photos:this.photos=new App.Quests.Collections.QuestEntries(!1,{questId:this.get("quest_id"),rpp:20})},i.prototype.getQuest=function(){return null!=this.quest?this.quest:this.quest=new App.Models.Quest({id:this.get("quest_id")})},i.prototype.fetchQuest=function(){return null!=this.fetchQuestDfd?this.fetchQuestDfd:this.fetchQuestDfd=this.getQuest().fetch()},i.prototype.fetchQuestAndPhotos=function(){return null!=this.questAndPhotosDfd?this.questAndPhotosDfd:this.questAndPhotosDfd=$.when(this.getPhotos().fetch(),this.getQuest().fetch())},i.prototype.getExerciseSubmissions=function(){return null!=this.exerciseSubmissions?this.exerciseSubmissions:this.exerciseSubmissions=new App.Quests.Collections.QuestEntries(!1,{questId:this.get("quest_id"),marketplaceOnly:!1})},i.prototype.fetchExerciseSubmissions=function(){return null!=this.fetchSubmissionsDfd?this.fetchSubmissionsDfd:this.fetchSubmissionsDfd=this.getExerciseSubmissions().fetch()},i.prototype.getGroup=function(){return null!=this.group?this.group:this.group=new App.Groups.Models.Group({id:this.get("group_id")})},i.prototype.getPosts=function(){return null!=this.posts?this.posts:this.posts=new App.Groups.Collections.Posts(!1,{groupId:this.get("group_id")})},i.prototype.fetchGroupAndPosts=function(){return null!=this.groupAndPostsDfd?this.groupAndPostsDfd:this.groupAndPostsDfd=$.when(this.getGroup().fetch(),this.getPosts().fetch())},i.prototype.hasSampleGallery=function(){return!!this.get("sample_gallery")},i.prototype.getSampleGalleryPhotos=function(){return null==this.sampleGalleryPhotos&&(this.sampleGalleryPhotos=new App.Galleries.Collections.GalleryPhotos(!1,{galleryPath:this.get("sample_gallery").token,userId:this.get("sample_gallery").user_id})),this.sampleGalleryPhotos},i.prototype.fetchSampleGalleryPhotos=function(){return null!=this.fetchSampleGalleryPhotosDfd?this.fetchSampleGalleryPhotosDfd:this.fetchSampleGalleryPhotosDfd=this.getSampleGalleryPhotos().fetch()},i.prototype.parse=function(t){var e;return null!=(e=t.course)?e:t},i.prototype.isEnrolled=function(){return"enrolled"===this.get("enrollment")},i.prototype.enroll=function(){var t;return t=$.post(PxApp.Constants.API_URL+"/classes/"+this.id+"/enroll"),t.done(this._updateEnrollmentStatus),t},i.prototype.drop=function(){var t;return t=$.post(PxApp.Constants.API_URL+"/classes/"+this.id+"/drop"),t.done(this._updateEnrollmentStatus),t},i.prototype.isUpcoming=function(){return moment(this.get("webinar_start")).isAfter(moment())},i.prototype.isLive=function(){return moment(this.get("webinar_start")).isBefore(moment())&&moment(this.get("webinar_end")).isAfter(moment())},i.prototype.isPast=function(){return moment(this.get("webinar_end")).isBefore(moment())},i.prototype.hoursTillWebinar=function(){return-moment.duration(moment().diff(this.get("webinar_start"))).asHours()},i.prototype._updateEnrollmentStatus=function(t){return this.set("enrollment",t.course.enrollment)},i.prototype.videoStateName=function(){var t;return this.get("webinar_start")&&this.get("webinar_start")?(t=this.get("webinar_download_available"),this.isLive()?"live":this.isUpcoming()?"upcoming":this.isPast()&&this.get("webinar_download_available")?"previous - video available":this.isPast()&&!this.get("webinar_download_available")?"previous - video unavailable":"unknown"):"unscheduled"},i.prototype.setupAutoJoinOnConfirm=function(){return $.cookie("join_class_unactivated",this.get("id"),{expires:1,path:"/"})},i}(Backbone.Model)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Models"),t.User=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.STATUS_ACTIVE=1,o.prototype.MARKETPLACE_PHOTO_FILTER=PxApp.Constants.PhotoFilters.MARKETPLACE_PHOTO_FILTER,o.prototype.IMMEDIATELY_LICENSABLE_PHOTO_FILTER=PxApp.Constants.PhotoFilters.IMMEDIATELY_LICENSABLE_PHOTO_FILTER,o.prototype.COMMUNITY_PHOTO_FILTER=PxApp.Constants.PhotoFilters.COMMUNITY_PHOTO_FILTER,o.prototype.initialize=function(){return App.vent.on("photo_deleted",function(t){return function(e){var o,i,r;return e.get("status")===t.STATUS_ACTIVE&&null!=t.get("upload_limit")&&t.get("upload_limit")<PxApp.Constants.User.UPLOAD_LIMIT_IN_WEEK&&(i=new Date,i.setDate(i.getDate()+1),o=new Date,o.setDate(i.getDate()-7),r=new Date(e.get("created_at")),r>o)?t.set("upload_limit",t.get("upload_limit")+1):void 0}}(this))},o.prototype.isRegisteredAfter=function(t){if(null==t)throw new Error("must provide cutOffDate");return moment(this.get("registration_date")).isAfter(t)},o.prototype.hasLocation=function(){return""!==this.get("city")||""!==this.get("state")||""!==this.get("country")},o.prototype.retinaAwareAvatarSmall=function(){var t,e,o,i;return window.devicePixelRatio>1?null!=(t=this.get("avatars"))&&null!=(e=t.small)?e.https:void 0:null!=(o=this.get("avatars"))&&null!=(i=o.tiny)?i.https:void 0},o.prototype.retinaAwareAvatarLarge=function(){var t,e,o,i;return window.devicePixelRatio>1?null!=(t=this.get("avatars"))&&null!=(e=t.large)?e.https:void 0:null!=(o=this.get("avatars"))&&null!=(i=o.small)?i.https:void 0},o.prototype.isActive=function(){return 1===this.get("active")},o.prototype.isBuyer=function(){return this.get("buyer")},o.prototype.isViewingLicensablePhotos=function(){return this.isViewingMarketplacePhotos()||this.isViewingImmediatelyLicensablePhotos()},o.prototype.isViewingMarketplacePhotos=function(){return this.get("photo_availability_filter")===this.MARKETPLACE_PHOTO_FILTER},o.prototype.isViewingImmediatelyLicensablePhotos=function(){return this.get("photo_availability_filter")===this.IMMEDIATELY_LICENSABLE_PHOTO_FILTER},o.prototype.isAdmin=function(){return this.get("usertype")===PxApp.Constants.User.USERTYPE_ADMIN},o.prototype.isAlumnus=function(){return this.get("usertype")===PxApp.Constants.User.USERTYPE_ALUMNUS},o.prototype.isEditor=function(){return this.get("usertype")===PxApp.Constants.User.USERTYPE_EDITOR},o.prototype.isPatronMember=function(){return this.get("upgrade_status")===PxApp.Constants.User.MEMBER_STATUS_PATRON},o.prototype.isAwesomeMember=function(){return this.get("upgrade_status")===PxApp.Constants.User.MEMBER_STATUS_AWESOME},o.prototype.isProMember=function(){return this.get("upgrade_status")===PxApp.Constants.User.MEMBER_STATUS_PRO},o.prototype.isProPlusMember=function(){return this.get("upgrade_status")===PxApp.Constants.User.MEMBER_STATUS_PRO_PLUS},o.prototype.isTrialMember=function(){return this.get("trial")},o.prototype.isFree=function(){return this.get("free")},o.prototype.timeRemaining=function(){return moment(this.get("upgrade_expiry_date")).fromNow(!0)},o.prototype.isSelf=function(){var t;return(null!=(t=App.currentUser)?t.id:void 0)===this.id},o.prototype.isContactable=function(){return this.get("contactable")&&!this.isSelf()},o.prototype.getFollowState=function(){return!!this.get("following")},o.prototype.getAvatarUrl=function(){return this.get("avatars").large.https},o.prototype.setAvatarUrl=function(t){return this.get("avatars").large.https=t,this.trigger("change:avatar_url")},o.prototype.getAvatarVersion=function(){return this.get("avatar_version")},o.prototype.setAvatarVersion=function(t){return this.set("avatar_version",t)},o.prototype.follow=function(t,e){return null==e&&(e={}),$.ajax({type:"POST",url:"/"+this.get("username")+"/follow",dataType:"json",contentType:"application/json",data:JSON.stringify(e)}).done(function(e){return function(){return e.set({followers_count:e.get("followers_count")+1,following:!0}),"function"==typeof t?t(null,!0):void 0}}(this)).fail(function(e){return function(o,i,r){var n,s;return n=(s=App.Helpers.API).parseError.apply(s,arguments),"function"==typeof t?t(n,e.getFollowState()):void 0}}(this))},o.prototype.unfollow=function(t,e){return null==e&&(e={}),$.ajax({type:"POST",url:"/"+this.get("username")+"/unfollow",dataType:"json",contentType:"application/json",data:JSON.stringify(e)}).done(function(e){return function(){return e.set({followers_count:e.get("followers_count")-1,following:!1}),"function"==typeof t?t(null,!1):void 0}}(this)).fail(function(e){return function(o,i,r){var n,s;return n=(s=App.Helpers.API).parseError.apply(s,arguments),"function"==typeof t?t(n,e.getFollowState()):void 0}}(this))},o.prototype.getHighlightClass=function(){var t;return t=$.Deferred(),null!=this._highlightClass?t.resolve(this._highlightClass):$.get(PxApp.Constants.API_URL+"/classes/highlight_class/"+this.id).done(function(e){return function(o){return(null!=o?o.course:void 0)?e._highlightClass=new App.Classes.Models.Course(o.course):e._highlightClass=!1,t.resolve(e._highlightClass);
}}(this)).fail(function(e){return function(){return t.resolve(!1)}}(this)),t},o}(PxApp.Models.User)}.call(this),function(){App.module("Classes",function(t){return t.addInitializer(function(){return null!=("undefined"!=typeof PxCurrentUser&&null!==PxCurrentUser?PxCurrentUser.user:void 0)&&null==App.currentUser&&(App.currentUser=new App.Models.User(JSON.parse(PxCurrentUser.user))),$(function(){return $("body").toggleClass("logged_in",null!=App.currentUser),PxApp.GA.set_member_type_and_user_id(PxCurrentUser.type,PxCurrentUser.id)}),App.controller=new t.Controller,App.router=App.controller.router=new t.Router({controller:App.controller})})})}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Classes.Collections"),t.Courses=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.model=App.Classes.Models.Course,o}(Backbone.Collection)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Classes.Collections"),t.MyCourses=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.rpp=6,o.prototype.model=App.Classes.Models.Course,o.prototype.initialize=function(t){return null==t&&(t={}),null!=t.rpp?this.rpp=t.rpp:void 0},o.prototype.url=function(){return PxApp.Constants.API_URL+"/classes/my_courses"},o}(App.Collections.InfiniteCollection)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Classes"),t.Controller=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.initialize=function(){return this.dataStore=new App.Classes.DataStore},o.prototype.index=function(t){return App.Photos.executeActionWithPhotoModal(function(e){return function(){var o;return null!=(o=window.AmplitudeLogger)&&o.classesEvent("Page View","Classes Library Page"),"all"===t&&Backbone.history.navigate("/classes",{replace:!0}),e.dataStore.setIndexRoute("index"),e.render(App.Classes.Views.ClassesIndexLayout,{dataStore:e.dataStore,category:t})}}(this))},o.prototype.myClasses=function(){return App.Photos.executeActionWithPhotoModal(function(t){return function(){var e;return t.dataStore.getEnrollmentCount()>0?(null!=(e=window.AmplitudeLogger)&&e.classesEvent("Page View","My Classes Page"),t.dataStore.setIndexRoute("myclasses"),t.render(App.Classes.Views.MyClassesLayout,{dataStore:t.dataStore})):Backbone.history.navigate("/classes",{trigger:!0,replace:!0})}}(this))},o.prototype.video=function(t,e){return App.Photos.executeActionWithPhotoModal(function(o){return function(){var i;return t=parseInt(t),PxCurrentUser.isAuthorized("classes_v1_1")?(null!=(i=window.AmplitudeLogger)&&i.classesEvent("Page View","Class Video Page"),o.render(App.Classes.Views.ClassVideo,{courseId:t,dataStore:o.dataStore})):Backbone.history.navigate("/classes/"+t+"/"+e,{trigger:!0,replace:!0})}}(this))},o.prototype.exercise=function(t,e){return App.Photos.executeActionWithPhotoModal(function(o){return function(){var i;return t=parseInt(t),PxCurrentUser.isAuthorized("classes_v1_1")?(null!=(i=window.AmplitudeLogger)&&i.classesEvent("Page View","Class Exercise Page"),o.render(App.Classes.Views.ClassExercise,{courseId:t,dataStore:o.dataStore})):Backbone.history.navigate("/classes/"+t+"/"+e,{trigger:!0,replace:!0})}}(this))},o.prototype.show=function(t,e){return App.Photos.executeActionWithPhotoModal(function(e){return function(){var o;return t=parseInt(t),PxCurrentUser.isAuthorized("classes_v1_1")?(null!=(o=window.AmplitudeLogger)&&o.classesEvent("Page View","Class Overview Page"),e.render(App.Classes.Views.ClassOverview,{courseId:t,dataStore:e.dataStore})):e.render(App.Classes.Views.ClassesShowLayout,{courseId:t,dataStore:e.dataStore})}}(this))},o.prototype.lessons=function(t,e){return App.Photos.executeActionWithPhotoModal(function(o){return function(){var i;return t=parseInt(t),PxCurrentUser.isAuthorized("classes_v1_1")?(null!=(i=window.AmplitudeLogger)&&i.classesEvent("Page View","Class Lessons Page"),o.render(App.Classes.Views.ClassLessons,{courseId:t,dataStore:o.dataStore})):Backbone.history.navigate("/classes/"+t+"/"+e,{trigger:!0,replace:!0})}}(this))},o.prototype.showPhoto=function(t){return App.Photos.showPhotoControllerAction(t)},o}(Marionette.AppController)}.call(this),function(){var t;t=App.module("Classes"),t.DataStore=function(){function t(){_.extend(this,Backbone.Events)}return t.prototype.initialize=function(){return this.on("change:enrollmentCount",function(t){return function(){return t.myCourses=null}}(this))},t.prototype.setEnrollmentCount=function(t){return this.enrollmentCount=t,this.trigger("change:enrollmentCount"),this.myCourses=null},t.prototype.getEnrollmentCount=function(){var t;return null!=this.enrollmentCount?this.enrollmentCount:this.enrollmentCount=null!=(t=gon.enrollment_count)?t:0},t.prototype.getCourse=function(t){var e,o;return null==this.courses&&(this.courses={}),null==(e=this.courses)[t]&&(e[t]=this.library?(o=$.Deferred(),this.library.done(function(e){return function(e){return o.resolve(e.findCourse(t))}}(this)),o):this._bootstrapOrFetch(App.Classes.Models.Course,gon.course,function(){var e;return(null!=(e=gon.course)?e.id:void 0)===t},{id:t})),this.courses[t]},t.prototype.getMyCourses=function(){return null!=this.myCourses?this.myCourses:this.myCourses=this._fetch(App.Classes.Collections.MyCourses)},t.prototype.getLibrary=function(){return null!=this.library?this.library:this.library=this._bootstrapOrFetch(App.Classes.Models.Library,gon.library)},t.prototype.getAutoEnroll=function(){return null!=this.autoEnroll?this.autoEnroll:this.autoEnroll=App.Helpers.deleteQueryParam("auto_enroll")},t.prototype.setAutoEnroll=function(t){return this.autoEnroll=t},t.prototype.getIndexRoute=function(){return this.indexRoute},t.prototype.setIndexRoute=function(t){return this.indexRoute=t},t.prototype._bootstrapOrFetch=function(t,e,o,i){return null==i&&(i=null),null==e||null!=o&&!o()?this._fetch(t,i):$.Deferred().resolve(new t(e))},t.prototype._fetch=function(t,e){var o,i;return null==e&&(e=null),o=$.Deferred(),i=new t(e),i.fetch().done(function(t){return function(){return o.resolve(i)}}(this)),o},t}()}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Classes.Models"),t.Library=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.url=function(){return PxApp.Constants.API_URL+"/classes/library"},o.prototype.getCoursesByCategory=function(t){var e;return"all"===t?null!=this.allCourses?this.allCourses:this.allCourses=this._allCourses():null!=(e=this.getCategory(t))?e.get("courses"):void 0},o.prototype.hasCategory=function(t){return"all"===t||null!=this.getCategory(t)},o.prototype.getCategory=function(t){return this.categories().find(function(e){return e.get("key")===t})},o.prototype.categories=function(){return null==this._categories&&(this._categories=new Backbone.Collection(_.map(this.get("categories"),function(t){return function(e){return t._buildCategory(e)}}(this)))),this._categories},o.prototype._buildCategory=function(t){return new Backbone.Model({key:t.category,title:t.title,subtitle:t.subtitle,courses:new App.Classes.Collections.Courses(t.courses)})},o.prototype.courses=function(){return null==this._courses&&(this._courses=_.flatten(_.map(this.categories().models,function(t){return t.get("courses").models}))),this._courses},o.prototype.findCourse=function(t){return _.find(this.courses(),function(e){return e.get("id")===t})},o.prototype._allCourses=function(){return new App.Classes.Collections.Courses(_.flatten(this.categories().map(function(t){return t.get("courses").models})),{comparator:function(t){var e;return-moment(null!=(e=t.get("webinar_start"))?e:0).valueOf()}})},o}(Backbone.Model)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Classes.Views"),t.ClassContentLockModal=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.template="class_content_lock_modal",o.prototype.className="class_content_lock_modal",o.prototype.ui={cancelButton:".class_content_lock_modal__cancel",upgradeButton:".class_content_lock_modal__upgrade",joinButton:".class_content_lock_modal__join",resendConfirmationButton:".class_content_lock_modal__resend_confirmation"},o.prototype.behaviors={ModalDialog:{closeOnEsc:!0},HasButtons:{"@ui.cancelButton":"_onClickCancel","@ui.upgradeButton":"_onClickUpgrade","@ui.joinButton":"_onClickJoin","@ui.resendConfirmationButton":"_onClickResendConfirmation"}},o.prototype.templateHelpers=function(){var t;return{hasClasses:PxCurrentUser.isAuthorized("classes"),isUserActivated:null!=(t=App.currentUser)?t.isActive():void 0}},o.prototype.initialize=function(t){return this.dataStore=t.dataStore,null!=this.model?this.model.setupAutoJoinOnConfirm():void 0},o.prototype._onClickCancel=function(){return this.trigger("cancelled"),this.destroyModal()},o.prototype._onClickUpgrade=function(){var t;return null!=(t=window.AmplitudeLogger)&&t.classesEvent("Upgrade Clicked","Class Content Lock Modal",this.model.get("id"),this.model.videoStateName()),window.location.href="/upgrade?r="+this.model.getPath()+"&classes_access=false"},o.prototype._onClickJoin=function(){var t;return null!=(t=window.AmplitudeLogger)&&t.classesEvent("Enroll Clicked - Enrolled","Class Content Lock Modal",this.model.get("id"),this.model.videoStateName()),this.model.enroll().done(function(t){return function(){return t.dataStore.setEnrollmentCount(t.dataStore.getEnrollmentCount()+1),t.trigger("joined"),t.destroyModal()}}(this))},o.prototype._onClickResendConfirmation=function(){var t,e;return null!=(t=window.AmplitudeLogger)&&t.classesEvent("Resend Email Confirmation Clicked","Class Content Lock Modal",this.model.get("id"),this.model.videoStateName()),null!=(e=$("#resend_activation_form"))?e.submit():void 0},o.prototype.onCloseModal=function(){return this.trigger("cancelled")},o.prototype.resize=function(){return this.trigger("resize")},o.handleContentAccess=function(t,e){var o,i,r;return o=$.Deferred(),null==App.currentUser?(r=new App.Views.SignupLoginModal({userAction:"Classes Register"}),r.on("signup:success",function(){return o.reject(),window.location.reload()}),r.on("login:success",function(){return o.reject(),window.location.reload()}),r.showModal()):t.isEnrolled()?o.resolve():(i=new App.Classes.Views.ClassContentLockModal({model:t,dataStore:e}),i.showModal(),i.on("joined",function(){return o.resolve()}),i.on("cancelled",function(){return o.reject()})),o.promise()},o}(Marionette.LayoutView)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Photos"),t.Router=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.appRoutes={"photo/critique/(:photo_id)(/:photo_slug)":"showCritique","photo/(:photo_id)(/:photo_slug)":"show"},o.prototype.navigate=function(t,e){var i;return null==e&&(e={}),i=App.currentPath(),t.replace(/(\?|&)page=\d+\b/,"")===i.replace(/(\?|&)page=\d+\b/,"")&&null==e.replace&&(e.replace=!0),o.__super__.navigate.call(this,t,e),this._trackPageview()},o.prototype.initialize=function(){return this.bind("route",this._trackPageview)},o.prototype._trackPageview=function(){var t;return t=Backbone.history.getFragment(),PxApp.GA.pageview(t)},o}(Backbone.Marionette.AppRouter)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Profiles.Views"),t.Avatar=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.template="user_avatar",o.prototype.className="user_avatar",o.prototype.ui={avatarImage:".user_avatar__avatar_image"},o.prototype.events={"click .user_avatar__badge_wrapper":"_badgeClicked"},o.prototype.initialize=function(t){return null==t&&(t={}),this.membership=null!=t?t.membership:void 0,this.amplitudeReferrer=t.amplitudeReferrer,this.source=t.source,this.clickableLink=t.clickableLink,null!=this.membership?(this.isAdmin=!1,this.isAlumnus=!1,this.isEditor=!1,this.isPatronMember="patron"===this.membership,this.isAwesomeMember="awesome"===this.membership,this.isProMember="pro"===this.membership,this.isProPlusMember="pro_plus"===this.membership,this.noLink=!0):(this.isAdmin=this.model.isAdmin(),this.isAlumnus=this.model.isAlumnus(),this.isEditor=this.model.isEditor(),this.isPatronMember=this.model.isPatronMember(),this.isAwesomeMember=this.model.isAwesomeMember(),this.isProMember=this.model.isProMember(),this.isProPlusMember=this.model.isProPlusMember(),this.noLink=!1)},o.prototype.templateHelpers=function(){return{avatarUrl:this.model.get("avatars").large.https,showBadge:!0,isAdmin:this.isAdmin,isAlumnus:this.isAlumnus,isEditor:this.isEditor,isPatronMember:this.isPatronMember,isAwesomeMember:this.isAwesomeMember,isProMember:this.isProMember,isProPlusMember:this.isProPlusMember,noLink:this.noLink,clickableLink:this.clickableLink}},o.prototype.onShow=function(){return this.listenTo(App.vent,"change:avatar_url",function(t){return function(e){return t.ui.avatarImage.attr("src",e)}}(this))},o.prototype._badgeClicked=function(){var t,e;return this.source?(this.amplitudeLogger=window.AmplitudeLogger.upgrade,t=function(){switch(!1){case!this.isProPlusMember:return this.amplitudeLogger.PRO_PLUS;case!this.isProMember:return this.amplitudeLogger.PRO;case!this.isAwesomeMember:return this.amplitudeLogger.AWESOME;case!this.isPatronMember:return this.amplitudeLogger.PATRON}}.call(this),e=function(){switch(this.source){case"sidebar":return this.amplitudeLogger.SIDEBAR;case"profile":return this.amplitudeLogger.PROFILE;default:return this.source}}.call(this),this.amplitudeLogger.referrer(this.amplitudeLogger.BADGE,t,e)):void 0},o}(Marionette.ItemView)}.call(this),function(){App.module("Photos",function(t){return t.addInitializer(function(){return null!=window.standalonePhotoPage?(null!=("undefined"!=typeof PxCurrentUser&&null!==PxCurrentUser?PxCurrentUser.user:void 0)&&null==App.currentUser&&(App.currentUser=new App.Models.User(JSON.parse(PxCurrentUser.user))),$(function(){return $("body").toggleClass("logged_in",null!=App.currentUser),PxApp.GA.set_member_type_and_user_id(PxCurrentUser.type,PxCurrentUser.id)}),App.controller=new t.Controller,App.router=App.controller.router=new t.Router({controller:App.controller})):void 0})})}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Models"),t.Photo=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.initialize=function(){return o.__super__.initialize.apply(this,arguments),this.imagesDownloadPromises={},this.imagesDownloaded={}},o.prototype.url=function(){return PxApp.Constants.API_URL+"/photos/"+this.id},o.prototype._imageDownloadKey=function(t){return"size:"+t.size+"-https:"+t.https},o.prototype.prefetchImage=function(t){var e;return _.defaults(t,{size:4,https:!0}),e=this._imageDownloadKey(t),this.imagesDownloaded[e]||null!=this.imagesDownloadPromises[e]?void 0:this.downloadImage(t)},o.prototype.isImageDownloaded=function(t){return _.defaults(t,{size:4,https:!0}),this.imagesDownloaded[this._imageDownloadKey(t)]},o.prototype.downloadImage=function(t){var e,o,i,r;return _.defaults(t,{size:4,https:!0}),i=this._imageDownloadKey(t),this.imagesDownloadPromises[i]?this.imagesDownloadPromises[i]:(e=$.Deferred(),r=this.imagesDownloadPromises[i]=e.promise(),o=new Image,o.onload=function(r){return function(){return r.imagesDownloaded[i]=!0,e.resolve(o.src,t),r.imagesDownloadPromises[i]=null}}(this),o.onerror=function(o){return function(){return e.reject(t),o.imagesDownloadPromises[i]=null}}(this),o.src=this.getImagePath(t),r)},o.prototype.addDownloadedImageSize=function(t){var e;return _.defaults(t,{size:4,https:!0}),e=this._imageDownloadKey(t),this.imagesDownloaded[e]=!0},o.prototype.getImagePathAndSize=function(t){var e,o;return _.defaults(t,{size:4,https:!0,ignoresConverting:!0}),e=this.getInternalImagePathAndSize(t),null==e&&(3===(o=t.size)||600===o?3!==t.size&&(t.size=3,e=this.getInternalImagePathAndSize(t)):4!==t.size&&(t.size=4,e=this.getInternalImagePathAndSize(t))),null==e&&(t.size=null,e=this.getInternalImagePathAndSize(t)),e},o.prototype.getInternalImagePathAndSize=function(t){var e,o,i,r,n,s;r=this.get("images");for(e in r)if(o=r[e],t.size===o.size||null==t.size)return i=t.https?null!=(n=o.https_url)?n:o.secure_url:o.url,s=o.size,t.ignoresConverting&&i.match(/\/placeholder\//)?null:{path:i,size:s};return null},o.prototype.getImagePath=function(t){var e;return e=this.getImagePathAndSize(t),null!=e?e.path:void 0},o.prototype.getInternalImagePath=function(t){var e;return e=this.getInternalImagePathAndSize(t),null!=e?e.path:void 0},o.prototype.parse=function(t){var e;return null!=(e=t.photo)?e:t},o.prototype.isPublic=function(){return this.get("privacy")===!1},o.prototype.isPrivate=function(){return this.get("privacy")===!0},o.prototype.isInNudeCategory=function(){return this.get("category")===PxApp.Constants.CATEGORIES.NUDE},o.prototype.isInBoudoirCategory=function(){return this.get("category")===PxApp.Constants.CATEGORIES.BOUDOIR},o.prototype.forCritique=function(){return this.get("for_critique")},o.prototype.getCritiqueUrl=function(){return this.get("critique_gallery_token")?"/photo/critique/"+this.id+"?from=gallery&galleryPath="+this.get("critique_gallery_token")+"&user_id="+this.get("user_id"):void 0},o.prototype.imageUrl=function(){var t,e;return e=this.getInternalImagePath({size:4,https:!0}),null==e&&(e=this.getInternalImagePath({size:PxApp.Constants.PHOTO_SIZES.S3_IMG_WEB_1000,https:!0})),null==e&&(e=this.get("images")[0].secure_url),null!=e?e:null!=(t=this.get("images")[0])?t.url:void 0},o.prototype.isConverting=function(){return null!=this.get("converted")&&0===this.get("converted")||this.imageUrl().indexOf("/placeholder/")>=0},o.prototype.dimensionsForImageSize=function(t){var e,o,i,r,n,s,a;return a=this.get("width"),s=this.get("height"),null!=a&&null!=s?(o={},o[""+PxApp.Constants.PHOTO_SIZES.S3_IMG_STORE_900]=900,o[""+PxApp.Constants.PHOTO_SIZES.S3_IMG_WEB_1000]=1e3,o[""+PxApp.Constants.PHOTO_SIZES.S3_IMG_WEB_1500]=1500,o[""+PxApp.Constants.PHOTO_SIZES.S3_IMG_WEB_2000]=2e3,n=o,e=n[t],null==e&&(e=t),a>s?(r=Math.min(a,e),i=Math.round(s*r/a)):(i=Math.min(s,e),r=Math.round(a*i/s)),{width:r,height:i}):void 0},o.prototype.submitToQuest=function(t){return $.post(PxApp.Constants.API_URL+"/quests/"+t+"/entries",{photo_id:this.get("id")})},o.prototype.submitToGallery=function(t){},o.prototype.showAds=function(){return this.get("nsfw")?!1:this.get("has_nsfw_tags")?!1:this.get("exclude_gads")?!1:!0},o}(Backbone.Model)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Models"),t.PhotoForViewer=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.isOwner=function(){return null!=App.currentUser&&App.currentUser.id===this.get("user_id")},o.prototype.getFavoriteState=function(){return!!this.get("favorited")},o.prototype.getFavoriteCount=function(){var t;return null!=(t=this.get("favorites_count"))?t:0},o.prototype.getFormatFavCount=function(){return this._formatNumber(this.getFavoriteCount())},o.prototype.getAbbreviateFavCount=function(){return this.abbreviateNumber(this.getFavoriteCount())},o.prototype.favorite=function(t){var e;return e=$.post(PxApp.Constants.API_URL+"/photos/"+this.id+"/favorite"),e.done(function(e){return function(o){return e.set({favorites_count:e.get("favorites_count")+1,favorited:!0,rating:o.photo.rating,highest_rating:o.photo.highest_rating,highest_rating_date:o.photo.highest_rating_date}),"function"==typeof t?t(null,e.getFavoriteState()):void 0}}(this)).fail(function(e){return function(o,i,r){var n,s;return n=(s=App.Helpers.API).parseError.apply(s,arguments),"function"==typeof t?t(n,e.getFavoriteState()):void 0}}(this))},o.prototype.unfavorite=function(t){var e;return e=$.ajax({type:"DELETE",url:PxApp.Constants.API_URL+"/photos/"+this.id+"/favorite"}),e.done(function(e){return function(o){return e.set({favorites_count:e.get("favorites_count")-1,favorited:!1,rating:o.photo.rating,highest_rating:o.photo.highest_rating,highest_rating_date:o.photo.highest_rating_date}),"function"==typeof t?t(null,e.getFavoriteState()):void 0}}(this)).fail(function(e){return function(o,i,r){var n,s;return n=(s=App.Helpers.API).parseError.apply(s,arguments),"function"==typeof t?t(n,e.getFavoriteState()):void 0}}(this))},o.prototype.getLikeState=function(){return!!this.get("liked")},o.prototype.getLikeCount=function(){var t;return null!=(t=this.get("votes_count"))?t:0},o.prototype.getFormatLikeCount=function(){return this._formatNumber(this.getLikeCount())},o.prototype.getAbbreviateLikeCount=function(){return this.abbreviateNumber(this.getLikeCount())},o.prototype.like=function(t){var e;return e=$.post(PxApp.Constants.API_URL+"/photos/"+this.id+"/vote?"+$.param({vote:1})),e.done(function(e){return function(o){var i;return e.set({votes_count:(null!=(i=e.get("votes_count"))?i:0)+1,liked:!0,rating:o.photo.rating,highest_rating:o.photo.highest_rating,highest_rating_date:o.photo.highest_rating_date}),"function"==typeof t?t(null,e.getLikeState()):void 0}}(this)).fail(function(e){return function(o,i,r){var n,s;return n=(s=App.Helpers.API).parseError.apply(s,arguments),"function"==typeof t?t(n,e.getLikeState()):void 0}}(this))},o.prototype.unlike=function(t){var e;return e=$.ajax({type:"DELETE",url:PxApp.Constants.API_URL+"/photos/"+this.id+"/vote"}),e.done(function(e){return function(o){var i;return e.set({votes_count:(null!=(i=e.get("votes_count"))?i:0)-1,liked:!1,rating:o.photo.rating,highest_rating:o.photo.highest_rating,highest_rating_date:o.photo.highest_rating_date}),"function"==typeof t?t(null,e.getLikeState()):void 0}}(this)).fail(function(e){return function(o,i,r){var n,s;return n=(s=App.Helpers.API).parseError.apply(s,arguments),"function"==typeof t?t(n,e.getLikeState()):void 0}}(this))},o.prototype.getUrl=function(){return this.getCanonicalUrl()},o.prototype.getCanonicalUrl=function(){return""+PxApp.Constants.MAIN_500PX_URL+this.get("url")},o.prototype._formatNumber=function(t){var e,o;for(e=t.toString(),o=/(\d+)(\d{3})/;o.test(e);)e=e.replace(o,"$1,$2");return e},o.prototype.abbreviateNumber=function(t,e){var o,i,r;if(null==e&&(e=1e3),r=["","k","m","b","t"],i=0>t?"-":"",t=Math.abs(t),e>t)return""+t;for(o=0;t>=1e3&&null!=r[o+1];)t/=1e3,o+=1;return t=parseInt(10*t+.5,10)/10,""+i+t+r[o]},o}(App.Models.Photo)}.call(this);var Geohash={};if(Geohash.base32="0123456789bcdefghjkmnpqrstuvwxyz",Geohash.encode=function(t,e,o){if("undefined"==typeof o){for(var i=1;12>=i;i++){var r=Geohash.encode(t,e,i),n=Geohash.decode(r);if(n.lat==t&&n.lon==e)return r}o=12}if(t=Number(t),e=Number(e),o=Number(o),isNaN(t)||isNaN(e)||isNaN(o))throw new Error("Invalid geohash");for(var s=0,a=0,l=!0,u="",p=-90,c=90,h=-180,d=180;u.length<o;){if(l){var g=(h+d)/2;e>=g?(s=2*s+1,h=g):(s=2*s,d=g)}else{var f=(p+c)/2;t>=f?(s=2*s+1,p=f):(s=2*s,c=f)}l=!l,5==++a&&(u+=Geohash.base32.charAt(s),a=0,s=0)}return u},Geohash.decode=function(t){var e=Geohash.bounds(t),o=e.sw.lat,i=e.sw.lon,r=e.ne.lat,n=e.ne.lon,s=(o+r)/2,a=(i+n)/2;return s=s.toFixed(Math.floor(2-Math.log(r-o)/Math.LN10)),a=a.toFixed(Math.floor(2-Math.log(n-i)/Math.LN10)),{lat:Number(s),lon:Number(a)}},Geohash.bounds=function(t){if(0===t.length)throw new Error("Invalid geohash");t=t.toLowerCase();for(var e=!0,o=-90,i=90,r=-180,n=180,s=0;s<t.length;s++){var a=t.charAt(s),l=Geohash.base32.indexOf(a);if(-1==l)throw new Error("Invalid geohash");for(var u=4;u>=0;u--){var p=l>>u&1;if(e){var c=(r+n)/2;1==p?r=c:n=c}else{var h=(o+i)/2;1==p?o=h:i=h}e=!e}}var d={sw:{lat:o,lon:r},ne:{lat:i,lon:n}};return d},Geohash.adjacent=function(t,e){if(t=t.toLowerCase(),e=e.toLowerCase(),0===t.length)throw new Error("Invalid geohash");if(-1=="nsew".indexOf(e))throw new Error("Invalid direction");var o={n:["p0r21436x8zb9dcf5h7kjnmqesgutwvy","bc01fg45238967deuvhjyznpkmstqrwx"],s:["14365h7k9dcfesgujnmqp0r2twvyx8zb","238967debc01fg45kmstqrwxuvhjyznp"],e:["bc01fg45238967deuvhjyznpkmstqrwx","p0r21436x8zb9dcf5h7kjnmqesgutwvy"],w:["238967debc01fg45kmstqrwxuvhjyznp","14365h7k9dcfesgujnmqp0r2twvyx8zb"]},i={n:["prxz","bcfguvyz"],s:["028b","0145hjnp"],e:["bcfguvyz","prxz"],w:["0145hjnp","028b"]},r=t.slice(-1),n=t.slice(0,-1),s=t.length%2;return-1!=i[e][s].indexOf(r)&&""!==n&&(n=Geohash.adjacent(n,e)),n+Geohash.base32.charAt(o[e][s].indexOf(r))},Geohash.neighbours=function(t){return{n:Geohash.adjacent(t,"n"),ne:Geohash.adjacent(Geohash.adjacent(t,"n"),"e"),e:Geohash.adjacent(t,"e"),se:Geohash.adjacent(Geohash.adjacent(t,"s"),"e"),s:Geohash.adjacent(t,"s"),sw:Geohash.adjacent(Geohash.adjacent(t,"s"),"w"),w:Geohash.adjacent(t,"w"),nw:Geohash.adjacent(Geohash.adjacent(t,"n"),"w")}},"undefined"!=typeof module&&module.exports&&(module.exports=Geohash),function(){var t,e,o=function(t,e){function o(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},i={}.hasOwnProperty,r=function(t,e){return function(){return t.apply(e,arguments)}};e=App.module("Photos.Models"),e.PhotoMembership=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.modelName="App.Photos.Models.PhotoMembership",e.prototype.initialize=function(t,o){var i,r,n;null==o&&(o={}),r={id:t.id};for(i in t)n=t[i],/^membership\_attr\_/.test(i)&&(r[i]=n);for(i in r)n=r[i],"id"!==i&&delete t[i];return this.photo=App.Photos.Models.PhotoManager.createOrUpdateModel(t),e.__super__.initialize.call(this,r,o)},e.prototype.toJSON=function(){return this.photo.toJSON()},e.prototype.getPhoto=function(){return this.photo},e}(Backbone.Model),e.Photo=function(t){function e(){return this.reportContent=r(this.reportContent,this),e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.LICENSE_URLS={0:"https://500px.com/terms",1:"https://creativecommons.org/licenses/by-nc/3.0/",2:"https://creativecommons.org/licenses/by-nc-nd/3.0/",3:"https://creativecommons.org/licenses/by-nc-sa/3.0/",4:"https://creativecommons.org/licenses/by/3.0/",5:"https://creativecommons.org/licenses/by-nd/3.0/",6:"https://creativecommons.org/licenses/by-sa/3.0/",7:"http://creativecommons.org/publicdomain/mark/1.0/",8:"http://creativecommons.org/publicdomain/zero/1.0/"},e.prototype.LICENSE_NAMES={0:"Standard 500px License",1:"Attribution-NonCommercial 3.0",2:"Attribution-NonCommercial-NoDerivs 3.0",3:"Attribution-NonCommercial-ShareAlike 3.0",4:"Attribution 3.0",5:"Attribution-NoDerivs 3.0",6:"Attribution-ShareAlike 3.0",7:"Public Domain Mark 1.0",8:"Public Domain Dedication"},e.prototype.WEB_READY_LONGEST_EDGE=1500,e.prototype.CRITIQUES_CALLOUT_TIMEOUT=48,e.prototype.url=function(){return PxApp.Constants.WEB_BFF_URL+"/photos/"+this.id},e.prototype.initialize=function(t,o){if(null==o&&(o={}),this._commentsData=o.commentsData,this.fromCacheManager=o.fromCacheManager,!this.fromCacheManager)throw new Error("Photo objects should be managed by App.Photos.Models.PhotoManager");return e.__super__.initialize.apply(this,arguments)},e.prototype.loadPurchaseInfo=function(){var t,e;return e=PxApp.Constants.PRIME_URL+"/api/photos/"+this.id+"?purchase_info=true",t=$.getJSON(e),t.done(function(t){return function(e){return t.set(_.pick(e.data,"purchased_by_me","purchase_url")),t.trigger("purchase:loaded")}}(this)),t},e.prototype.isPurchasedByUser=function(){return!!this.get("purchased_by_me")},e.prototype.purchaseDownloadUrl=function(){return this.get("purchase_url")},e.prototype.hasGeoCoords=function(){return!0},e.prototype.geoCoords=function(){var t,e;return null!=(e=this.get("longitude"))&&null!=(t=this.get("latitude"))?{longitude:e,latitude:t}:null},e.prototype.geohash=function(){var t;return t=this.geoCoords(),null!=t?Geohash.encode(t.latitude,t.longitude):void 0},e.prototype.geoLocationName=function(){var t,e,o,i;return i=[],null!=(t=this.get("location_details"))&&((null!=(e=t.city)?e.length:void 0)>0&&i.push(""+t.city[0]),(null!=(o=t.country)?o.length:void 0)>0&&i.push(""+t.country[0])),i.join(", ")},e.prototype.setAsCover=function(){var t,e,o;if(!this._settingCover)return this._settingCover=!0,this.trigger("cover:setting"),o=PxApp.Constants.SERVICE_MEDIA_CLIENT.USER_COVER_UPLOAD_URL,o+="?"+$.param({user_id:App.currentUser.id,authenticity_token:PxApp.csrf_token}),t=new FormData,t.append("source_photo_id",this.id),e=$.ajax({type:"POST",url:o,data:t,processData:!1,contentType:!1,cache:!1}),e.done(function(t){return function(){return t.set("is_cover",!0),t.trigger("cover:succeeded")}}(this)).fail(function(t){return function(e,o,i){return t.trigger("cover:failed")}}(this)).always(function(t){return function(){return t._settingCover=!1}}(this)),e},e.prototype.canBeCover=function(){var t,e;return null==(e=this.get("width"))||null==(t=this.get("height"))?!1:e>=2e3&&t>=1e3},e.prototype.reportContent=function(t,e){var o,i;return null==e&&(e=""),i={reason:t},t===""+PxApp.Constants.FLAGGED_CONTENT.REPORT_REASON_OTHER&&(i.reason_details=e),o=$.post(PxApp.Constants.API_URL+"/photos/"+this.id+"/report",i),o.done(function(e){return function(){return e._contentReported=!0,e._contentReportReason=t,$.cookie("reported-this-photo-"+e.id,"1"),e.trigger("contentReported",t)}}(this)),o},e.prototype.contentReported=function(){var t;return!!(null!=(t=this._contentReported)?t:"1"===$.cookie("reported-this-photo-"+this.id))},e.prototype.contentReportReason=function(){return this._contentReportReason},e.prototype.isEditorsChoice=function(){return!!this.get("editors_choice")},e.prototype.canBeEditorsChoice=function(){return App.currentUser?App.currentUser.id!==this.get("user_id")&&!this.get("nsfw"):!1},e.prototype.submitLicensingRequest=function(t){var e;return null==t&&(t={}),App.currentUser?(e=t.suggest?$.post(PxApp.Constants.API_URL+"/photos/"+this.id+"/licensing_suggest"):$.post(PxApp.Constants.API_URL+"/photos/"+this.id+"/licensing_request"),e.done(function(e){return function(){return t.suggest?e.set({licensing_suggested:!0}):e.set({licensing_requested:!0})}}(this)),e):void 0},e.prototype.submitEditorsChoice=function(){var t;if(App.currentUser&&!this.isEditorsChoice())return t=$.post(PxApp.Constants.API_URL+"/editors/photos/"+this.id+"/editors_choice"),t.done(function(t){return function(){return t.set({editors_choice:!0,editors_choice_date:Date.now(),editored_by:{fullname:App.currentUser.get("fullname"),user_id:App.currentUser.id}})}}(this)),t},e.prototype.removeEditorsChoice=function(){var t;if(App.currentUser&&this.isEditorsChoice())return t=$.ajax({type:"DELETE",url:PxApp.Constants.API_URL+"/editors/photos/"+this.id+"/editors_choice"}),t.done(function(t){return function(){return t.set({editors_choice:!1,editors_choice_date:null,editored_by:null})}}(this)),t},e.prototype.newResolutionCalculation=function(t){var e,o,i,r,n,s,a,l;return a=this.get("store_width")||this.get("width"),s=this.get("store_height")||this.get("height"),n=[a,s],l=n[0],o=n[1],null!=t.resize_max&&t.resize_max>0&&(a>=s?(l=Math.min(a,t.resize_max),o=Math.round(s*l/a)):(o=Math.min(s,t.resize_max),l=Math.round(a*o/s))),e=t.resize_dpi,r=Math.floor(l/e*10)/10,i=Math.floor(o/e*10)/10,{width:l,height:o,printWidth:r,printHeight:i}},e.prototype.isAvailableForImmediatePurchase=function(){var t;return t=this.get("licensing_status"),null==t?!1:_.contains([PxApp.Constants.LICENSING_STATUS.PRIME,PxApp.Constants.LICENSING_STATUS.SUBPRIME,PxApp.Constants.LICENSING_STATUS.EDITORIAL,PxApp.Constants.LICENSING_STATUS.SUBEDITORIAL],t);
},e.prototype.isSubmitted=function(){return _.contains([PxApp.Constants.LICENSING_STATUS.SUBMITTED,PxApp.Constants.LICENSING_STATUS.PRESUBMITTED],this.get("licensing_status"))},e.prototype.isUnderSubmission=function(){var t;return t=this.get("licensing_status"),null==t?!1:_.contains([PxApp.Constants.LICENSING_STATUS.SUBMITTED,PxApp.Constants.LICENSING_STATUS.PRESUBMITTED,PxApp.Constants.LICENSING_STATUS.PENDING],t)},e.prototype.getMarketplaceLicenses=function(){var t,e;return e=PxApp.Constants.API_URL+"/photos/"+this.id+"/licenses",t=$.ajax({url:e,dataType:"json"}),t.done(function(t){return function(e){var o,i,r,n;return n=e,i=new Backbone.Model(e.currency),o=_.each(n.basic_licenses,function(e){return e.resolution=t.newResolutionCalculation(e),e.currency=i}),r=_.each(n.extended_licenses,function(e){return e.resolution=t.newResolutionCalculation(e),e.currency=i}),t.set({basic_licenses:o,extended_licenses:r,currency:i})}}(this))},e.prototype.getLicenseName=function(){var t;return t=this.get("license_type"),this.LICENSE_NAMES[t]},e.prototype.getAllLicenseNames=function(){var t,e,o;return o=[],(t=this.get("basic_licenses"))&&o.push.apply(o,t.map(function(t){return t.license_name})),(e=this.get("extended_licenses"))&&o.push.apply(o,e.map(function(t){return t.license_name})),o},e.prototype.isContributorCollection=function(){return!this.isCuratedCollection()},e.prototype.isCuratedCollection=function(){var t;return(t=this.get("licensing_status"))===PxApp.Constants.LICENSING_STATUS.PRIME||t===PxApp.Constants.LICENSING_STATUS.EDITORIAL},e.prototype.deprecatedLicenseUrl=function(t,e){var o;return null==e&&(e=""),o={utm_source:"500px",utm_content:this.LICENSES[t].utmContent,utm_term:e,utm_medium:"referral",utm_campaign:"photo page",license_type:t},PxApp.Constants.PRIME_URL+"/checkout/"+this.id+"?"+$.param(o)},e.prototype.marketplaceCheckoutUrl=function(t,e){var o;return null==e&&(e=""),o={utm_source:"500px",utm_term:e,utm_medium:"referral",utm_campaign:"photo page",licenses:t},PxApp.Constants.PRIME_URL+"/checkout/"+this.id+"?"+$.param(o)},e.prototype.compUrl=function(){return PxApp.Constants.PRIME_URL+"/photos/"+this.id+"/comp"},e.prototype.isExclusive=function(){var t;return t=this.get("licensing_status"),null==t?!1:_.contains([PxApp.Constants.LICENSING_STATUS.NONE,PxApp.Constants.LICENSING_STATUS.REMOVED,PxApp.Constants.LICENSING_STATUS.ILLEGAL,PxApp.Constants.LICENSING_STATUS.PENDING,PxApp.Constants.LICENSING_STATUS.RIGHTS_MANAGED],t)?!1:"exclusive"===this.get("licensing_type")},e.prototype.isEditorial=function(){return _.contains([PxApp.Constants.LICENSING_STATUS.EDITORIAL,PxApp.Constants.LICENSING_STATUS.SUBEDITORIAL],this.get("licensing_status"))},e.prototype.isModelReleased=function(){var t;return t=this.get("releases"),null==t?!1:!!_.find(t,function(t){return"model"===t.type})},e.prototype.isLocationReleased=function(){var t;return t=this.get("releases"),null==t?!1:!!_.find(t,function(t){return"location"===t.type})},e.prototype.isPurchasable=function(){var t;return t=this.get("licensing_status"),null==t?!0:!_.contains([PxApp.Constants.LICENSING_STATUS.REMOVED,PxApp.Constants.LICENSING_STATUS.ILLEGAL],t)},e.prototype.isSubmittable=function(){var t;return t=this.get("licensing_status"),null==t?!0:!_.contains([PxApp.Constants.LICENSING_STATUS.ILLEGAL],t)},e.prototype.isRequestable=function(){return this.get("license_requests_enabled")},e.prototype.isStoreEnabled=function(){var t;return!!(null!=(t=this.getUser())?t.get("store_on"):void 0)},e.prototype.isRightsManaged=function(){return this.get("licensing_status")===PxApp.Constants.LICENSING_STATUS.RIGHTS_MANAGED},e.prototype.isIllegal=function(){return this.get("licensing_status")===PxApp.Constants.LICENSING_STATUS.ILLEGAL},e.prototype.isLicenseable=function(){return this.isStoreEnabled()?this.isOwner()?this.isSubmittable():this.isCreativeCommonsCompatible()||this.isAvailableForImmediatePurchase():!1},e.prototype.isFreePhoto=function(){return this.get("is_free_photo")},e.prototype.freePhotoUrl=function(){return PxApp.Constants.PRIME_URL+"/freephoto/download"},e.prototype.isCreativeCommonsCompatible=function(){var t;return t=this.get("license_type"),null!=t&&0!==t},e.prototype.getCreativeCommonsLicenseUrl=function(){var t;return this.isCreativeCommonsCompatible()?(t=this.get("license_type"),this.LICENSE_URLS[t]):void 0},e.prototype.getCreativeCommonsPhotoUrl=function(){return this.isCreativeCommonsCompatible()?this.imageUrl():void 0},e.prototype.getComments=function(){var t;return null!=this._comments?this._comments:this._comments=new App.Photos.Collections.Comments(null!=(t=this._commentsData)?t:!1,{photo:this})},e.prototype.isAssignmentRejected=function(){var t;return"rejected"===(null!=(t=this.get("listing_photo"))?t.state:void 0)},e.prototype.timeAfterUpload=function(t){return null==t&&(t="hours"),"years"!==t&&"months"!==t&&"weeks"!==t&&"days"!==t&&"hours"!==t&&"minutes"!==t&&"seconds"!==t&&(t="hours"),moment().diff(this.get("created_at"),t)},e.prototype.shouldShowCritiquesCallout=function(){return!1},e.prototype.like=function(){var t;return t=e.__super__.like.apply(this,arguments),t.done(function(t){return function(){var e,o;return e=t.getLikedByUsers(),null!=e.numOfLikes?(o=$.Deferred().resolve(),e.numOfLikes+=1,App.Photos.Models.UserManager.getModelById(App.currentUser.id,{noFetch:!0})||App.Photos.Models.UserManager.createOrUpdateModel(App.currentUser.toJSON()),e.add(new App.Photos.Models.UserMembership({id:App.currentUser.id}),{at:0})):o=e.fetch(),o.done(function(){return t.trigger("change:likedByCurrentUser")})}}(this))},e.prototype.unlike=function(){var t;return t=e.__super__.unlike.apply(this,arguments),t.done(function(t){return function(){var e,o;return e=t.getLikedByUsers(),null!=e.numOfLikes?(e.numOfLikes-=1,o=e.findWhere({id:App.currentUser.id}),null!=o&&e.remove(o),t.trigger("change:likedByCurrentUser")):void 0}}(this))},e.prototype.favorite=function(){var t;return t=e.__super__.favorite.apply(this,arguments),t.done(function(t){return function(){var e,o;return e=t.getFavoritedByUsers(),null!=e.numOfLikes?(o=$.Deferred().resolve(),e.numOfLikes+=1,App.Photos.Models.UserManager.getModelById(App.currentUser.id,{noFetch:!0})||App.Photos.Models.UserManager.createOrUpdateModel(App.currentUser.toJSON()),e.add(new App.Photos.Models.UserMembership({id:App.currentUser.id}),{at:0})):o=e.fetch(),o.done(function(){return t.trigger("change:favoritedByCurrentUser")})}}(this))},e.prototype.unfavorite=function(){var t;return t=e.__super__.unfavorite.apply(this,arguments),t.done(function(t){return function(){var e,o;return e=t.getFavoritedByUsers(),null!=e.numOfLikes?(e.numOfLikes-=1,o=e.findWhere({id:App.currentUser.id}),null!=o&&e.remove(o),t.trigger("change:favoritedByCurrentUser")):void 0}}(this))},e.prototype.getFavoritedByUsers=function(){return null!=this._favoritedByUsers?this._favoritedByUsers:this._favoritedByUsers=new App.Photos.Collections.FavoritedByUsers(!1,{photo:this})},e.prototype.getLikedByUsers=function(){return null!=this._likedByUsers?this._likedByUsers:this._likedByUsers=null!=this.get("liked_by")?new App.Photos.Collections.LikedByUsers(this.get("liked_by"),{photo:this,numOfLikes:this.getLikeCount()}):new App.Photos.Collections.LikedByUsers(!1,{photo:this})},e.prototype.likedByUsersFetched=function(){var t;return null!=this.get("liked_by")||null!=(null!=(t=this._likedByUsers)?t.numOfLikes:void 0)},e.prototype.getRelatedPhotos=function(){return null!=this._relatedPhotos?this._relatedPhotos:this._relatedPhotos=new App.Photos.Collections.RelatedPhotos(!1,{photoIds:[this.id]})},e.prototype.getUser=function(){return null!=this._user?this._user:this._user=App.Photos.Models.UserManager.getModelById(this.get("user_id"),{noFetch:!0})},e.prototype.toJSON=function(t){var o;return _.extend(e.__super__.toJSON.apply(this,arguments),{user:null!=(o=this.getUser())?o.toJSON():void 0})},e.prototype.share=function(t){return null==this.popup&&(this.popup=new App.Lib.Sharelizer({url:this.getCanonicalUrl(),category:"Photo Page"})),this[t]()},e.prototype.google=function(t){return this.popup.google()},e.prototype.facebook=function(){return this.popup.facebook()},e.prototype.vk=function(){return this.popup.vk()},e.prototype._pinterestShareData=function(){return{media:this.getImagePath({size:PxApp.Constants.PHOTO_SIZES.S3_IMG_SIZE_XLARGE}),description:this.get("name")+" - "+this.get("description")}},e.prototype.pinterest=function(){var t;if(t=this._pinterestShareData(),!t.media||!t.description)throw"This view doesn't know how to share with pinterest";return this.popup.pinterest(t.media,t.description)},e.prototype._twitterShareData=function(){var t,e,o,i;return e=this.get("name"),i=null!=(o=this.getUser().get("contacts"))?o.twitter:void 0,t=this.getUser().get("fullname"),i?{text:'"'+e+'" by @'+i+"."}:{text:'"'+e+'" by '+t+"."}},e.prototype.twitter=function(){var t;if(t=this._twitterShareData(),!t.text)throw"This view doesn't know how to share with twitter";return this.popup.twitter(t.text)},e.prototype._stumbleuponShareData=function(){return{title:'Photo "'+this.get("name")+'" by '+this.getUser().get("fullname")}},e.prototype.stumbleupon=function(){var t;if(t=this._stumbleuponShareData(),!t.title)throw"This view doesn't know how to share with StumbleUpon";return this.popup.stumbleupon(t)},e.prototype.getCategoryText=function(){return PxApp.Constants.CATEGORY_NAMES[this.get("category")]},e}(App.Models.PhotoForViewer),t=function(){function t(){}return t.prototype.MAX_BATCH_SIZE=50,t.prototype.BATCH_INTERVAL=200,t.prototype.cache={},t.prototype.fetchingPromises={},t.prototype.fetchingOptions={},t.prototype.createOrUpdateModel=function(t){var e,o;return e=t.id,o=this.cache[e],null==o&&(o=this.cache[e]=new App.Photos.Models.Photo({},{fromCacheManager:!0})),this._updateModelAttributes(o,t),o},t.prototype._updateModelAttributes=function(t,e){var o,i,r,n,s,a,l,u;if(e.user&&(u=e.user,l=App.Photos.Models.UserManager.createOrUpdateModel(u),t.set("user",l)),e.images){for(o=null!=(s=t.get("images"))?s:[],a=e.images,i=0,n=a.length;n>i;i++)r=a[i],null==t.getInternalImagePath({size:r.size,ignoresConverting:!0})&&o.push(r);t.set("images",o)}return t.set(_.omit(e,"user","images"))},t.prototype._apiParams=function(t){var e;return e={image_size:PxApp.Constants.PHOTO_GRID_IMAGE_SIZES,expanded_user_info:!0},t.tags&&(e.include_tags=t.tags),t.geo&&(e.include_geo=t.geo),t.userFollowingStates&&(e.is_following=!0),t.equipmentInfo&&(e.include_equipment_info=!0),t.licensingStates&&(e.include_licensing=!0,e.include_releases=!0),t.likedByUsers&&(e.liked_by=1,e.following_sample=100),e},t.prototype.prefetchModels=function(t,e){var o,i;return null==e&&(e={}),i=function(){var i,r,n;for(n=[],i=0,r=t.length;r>i;i++)o=t[i],n.push({id:o,options:e});return n}(),i.length>0?e.batchable?this._queueBatchedPhotos(i):this._internalPrefetchModels(i):void 0},t.prototype._optionsIncluded=function(t,e){var o,i;for(o in e)if(i=e[o],i&&!t[o])return!1;return!0},t.prototype._unionOptions=function(t,e){var o,i,r;null==e&&(e={}),i={};for(o in e)r=e[o],r&&(i[o]=!0);for(o in t)r=t[o],r&&(i[o]=!0);return i},t.prototype._queueBatchedPhotos=function(t){var e,o,i,r;for(null==this.batchedPhotos&&(this.batchedPhotos={}),e=0,r=t.length;r>e;e++)i=t[e],o=i.id,this.batchedPhotos[o]=this._unionOptions(i.options,this.batchedPhotos[o]);return _.keys(this.batchedPhotos).length>=this.MAX_BATCH_SIZE?this._processQueuedPrefetch():(null==this._throtted&&(this._throtted=_.throttle(function(t){return function(){return t._processQueuedPrefetch()}}(this),this.BATCH_INTERVAL,{leading:!1,trailing:!0})),this._throtted())},t.prototype._processQueuedPrefetch=function(){var t,e,o;return o=function(){var o,i;o=this.batchedPhotos,i=[];for(t in o)e=o[t],i.push({id:t,options:e});return i}.call(this),this.batchedPhotos={},this._internalPrefetchModels(o)},t.prototype.isCachedOrFetching=function(t,e){return!this._shouldFetch(this.cache[t],e)||this._isFetchingInProgress(t,e)},t.prototype._internalPrefetchModels=function(t){var e,o,i,r,n,s,a,l,u,p,c,h,d,g,f,m;for(o={},d={},n=[],f={},i=0,u=t.length;u>i;i++)if(s=t[i],r=s.id,c=s.options,!this.isCachedOrFetching(r,c)){n.push(r),g=s.options;for(l in g)m=g[l],m&&(f[l]=!0);e=$.Deferred(),d[r]=this.fetchingPromises[r]=e.promise(),o[r]=e}if(0!==n.length){for(a=0,p=n.length;p>a;a++)r=n[a],this.fetchingOptions[r]=this._unionOptions(f,this.fetchingOptions[r]);return h=_.extend(this._apiParams(f),{ids:n.join(",")}),$.get(PxApp.Constants.API_URL+"/photos?"+$.param(h)).done(function(t){return function(i){var n,s,a,l;l=[];for(r in o)e=o[r],null!=(n=null!=i&&null!=(a=i.photos)?a[r]:void 0)?(s=t.createOrUpdateModel(n),e.resolve(s)):e.reject("__error::error"),d[r]===t.fetchingPromises[r]?(delete t.fetchingPromises[r],l.push(delete t.fetchingOptions[r])):l.push(void 0);return l}}(this)).fail(function(t){return function(){var i,n,s;i=(n=App.Helpers.API).parseError.apply(n,arguments),s=[];for(r in o)e=o[r],e.reject(i),d[r]===t.fetchingPromises[r]?(delete t.fetchingPromises[r],s.push(delete t.fetchingOptions[r])):s.push(void 0);return s}}(this))}},t.prototype._shouldFetch=function(t,e){var o,i;return null==e&&(e={}),o=null==t,e.favoriteAndLikeStates&&null!=App.currentUser&&(o||(o=null==t.get("liked"))),e.tags&&(o||(o=null==t.get("tags"))),e.licensingStates&&(o||(o=null==t.get("licensing_status"))),e.equipmentInfo&&(o||(o=null==t.get("camera_info"))),e.userFollowingStates&&(o||(o=null==(i=t.getUser())),o||(o=!i.isSelf()&&null==i.get("following"))),e.likedByUsers&&(o||(o=!t.likedByUsersFetched())),o},t.prototype.getCachedModelById=function(t){return this.cache[t]},t.prototype._isFetchingInProgress=function(t,e){return null!=this.fetchingPromises[t]&&this._optionsIncluded(this.fetchingOptions[t],e)},t.prototype.getModelById=function(t,e){var o,i,r,n;return null==e&&(e={}),r=this.cache[t],e.noFetch?$.Deferred().resolve(r).promise():(this._shouldFetch(r,e)?this._isFetchingInProgress(t,e)?n=this.fetchingPromises[t]:(o=$.Deferred(),n=this.fetchingPromises[t]=o.promise(),this.fetchingOptions[t]=this._unionOptions(e,this.fetchingOptions[t]),i=_.extend(this._apiParams(e),{ids:t}),$.get(PxApp.Constants.API_URL+"/photos?"+$.param(i)).done(function(e){return function(i){var s,a;return null!=(s=null!=i&&null!=(a=i.photos)?a[t]:void 0)?(r=e.createOrUpdateModel(s),o.resolve(r)):o.reject("__error::error"),n===e.fetchingPromises[t]?(delete e.fetchingPromises[t],delete e.fetchingOptions[t]):void 0}}(this)).fail(function(e){return function(){var i,r;return i=(r=App.Helpers.API).parseError.apply(r,arguments),o.reject(i),n===e.fetchingPromises[t]?(delete e.fetchingPromises[t],delete e.fetchingOptions[t]):void 0}}(this))):n=$.Deferred().resolve(r).promise(),n)},t}(),null==e.PhotoManager&&(e.PhotoManager=new t)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty,i=[].indexOf||function(t){for(var e=0,o=this.length;o>e;e++)if(e in this&&this[e]===t)return e;return-1};t=App.module("Collections"),t.InfiniteCollection=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.page=null,o.prototype.rpp=20,o.prototype.fetching=function(){return this._inProgress===!0},o.prototype.initialize=function(t,e){return null==t&&(t=[]),null==e&&(e={}),this.cursorPagination=!!this.cursorPagination,this.fetchUntilEmpty=!!this.fetchUntilEmpty,this.cursorPagination?(null==e.page&&(e.page=null),this.page=e.page):(null==e.page&&(e.page=1),null!=e.page&&(this.page=0|e.page)),null!=e.rpp&&(this.rpp=0|e.rpp),this._firstPage=this.page},o.prototype._resetState=function(){return this.page=null,this.totalPages=null,this.nextPageCursor=null,this.prevPageCursor=null,this.seenCursors=[],this._done=!1,this._singlePage=!1,this._inProgress=!1},o.prototype.reset=function(t,e){var i,r;return null==t&&(t=[]),null==e&&(e={}),this.trigger("before:reset"),this._resetState(),this.cursorPagination?this.page=null!=(i=e.page)?i:null:this.page=null!=(r=e.page)?r:1,t.length>0&&(this.cursorPagination||(this.page=1),t.length<this.rpp&&(this.totalPages=1,this._done=!0,this._singlePage=!0)),o.__super__.reset.apply(this,arguments)},o.prototype.getFirstPage=function(){return this._firstPage},o.prototype.fetch=function(t){var e,r,n,s,a;return null==t&&(t={}),this.cursorPagination&&t.previousPage&&!this.prevPageCursor?$.Deferred.resolve({}).promise():(this.cursorPagination?null==this.page&&(this.page=null):null==this.page&&(this.page=1),a=$.isFunction(this.url)?this.url():this.url,s=i.call(a,"?")>=0?"&":"?",n=null,this.cursorPagination?t.previousPage?n="prev_page="+this.prevPageCursor:null!=this.nextPageCursor&&(n="next_page="+this.nextPageCursor):(r=t.previousPage?this._firstPage:this.page,n="page="+r),a=null!=n?""+a+s+n+"&rpp="+this.rpp:""+a+s+"rpp="+this.rpp,this._inProgress=!0,e=_.extend({},{url:a,remove:!1},_.omit(t,"page")),o.__super__.fetch.call(this,e).done(function(t){return function(e){return!t.cursorPagination&&t.totalPages>0&&t._firstPage>t.totalPages?(t._firstPage=t.page=t.totalPages,App.vent.trigger("pagination:overflow",t.totalPages),t.trigger("pagination:overflow",t.totalPages),t.fetch().done(function(){return t.trigger("pagination:overflow:refetched",t.totalPages)})):(t._inProgress=!1,t.trigger("fetch:done"))}}(this)))},o.prototype.nextPage=function(){var t;return t=$.Deferred(),this._inProgress||this._done?t.resolve(this.page,this._done).promise():(this._inProgress=!0,!this.cursorPagination&&(null==this.totalPages||this.page<this.totalPages)&&(this.page+=1),this.fetch().done(function(e){return function(){return t.resolve(e.page,e._done)}}(this)),t.promise())},o.prototype.previousPage=function(){var t;return t=$.Deferred(),this.cursorPagination&&!this.prevPageCursor?t.resolve(null,!0).promise():this._inProgress||1===this._firstPage?t.resolve(this._firstPage,1===this._firstPage).promise():(this._inProgress=!0,this._firstPage-=1,this.fetch({previousPage:!0}).done(function(e){return function(){return t.resolve(e._firstPage,1===e._firstPage)}}(this)),t.promise())},o.prototype._extractModels=function(t){var e,o,r;o=["meta","total_pages","current_page","feature","total_items","total_pages","pagination","next_page"];for(e in t)if(r=t[e],i.call(o,e)<0)return r},o.prototype.finished=function(){return this._done===!0},o.prototype.loading=function(){return this._inProgress===!0},o.prototype.singlePage=function(){return this._singlePage===!0},o.prototype.parse=function(t){var e,o;return e=this._extractModels(t),this.cursorPagination?(this._just_parsed_page=this.page=this.nextPageCursor,this.nextPageCursor=t.pagination.next_page,this.prevPageCursor=t.pagination.prev_page,null==this.totalPages&&(this.totalPages=1),null==this.seenCursors&&(this.seenCursors=[]),null!=this.nextPageCursor&&(o=this.nextPageCursor,i.call(this.seenCursors,o)<0)&&(this.totalPages+=1,this.seenCursors.push(this.nextPageCursor)),this.nextPageCursor?this._done=!1:this.fetchUntilEmpty&&0!==(null!=e?e.length:void 0)||(this._done=!0,this.trigger("pagination:end"))):(null!=t.meta?(this._just_parsed_page=t.meta.pagination.page,this.totalPages!==t.meta.pagination.total_pages&&(this.totalPages=t.meta.pagination.total_pages,this.trigger("pagination:page_count_update",this.totalPages)),this.totalItems!==t.meta.pagination.total_items&&(this.totalItems=t.meta.pagination.total_items,this.trigger("pagination:item_count_update",this.totalItems))):(this._just_parsed_page=t.current_page,this.totalPages!==t.total_pages&&(this.totalPages=t.total_pages,this.trigger("pagination:page_count_update",this.totalPages)),this.totalItems!==t.total_items&&(this.totalItems=t.total_items,this.trigger("pagination:item_count_update",this.totalItems))),this._just_parsed_page>this.page&&(this.page=this._just_parsed_page),this.page>=this.totalPages&&(this._done=!0,this.trigger("pagination:end"))),e},o}(Backbone.Collection)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty,i=[].indexOf||function(t){for(var e=0,o=this.length;o>e;e++)if(e in this&&this[e]===t)return e;return-1};t=App.module("Photos.Collections"),t.NavigationalInfiniteCollection=function(t){function o(t,e){var i;null==e&&(e={}),this.navigationDisabled=null!=(i=e.navigationDisabled)?i:!1,this.navigationDisabled||(this.comparator="membership_attr_nav_offset"),o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.FETCH_MORE_THRESHOLD=5,o.prototype.photoAt=function(t){throw new Error("Not implemented!")},o.prototype._getPhotoIds=function(){throw new Error("Not implemented!")},o.prototype._contextUrlParams=function(){throw new Error("Not implemented!")},o.prototype._extractPhotoIdFromItem=function(t){throw new Error("Not implemented!")},o.prototype._buildDisplayedItemData=function(t){throw new Error("Not implemented!")},o.prototype.shouldHideRelatedPhotos=function(){throw new Error("Not implemented!")},o.parseBrowserUrlParams=function(t){var e,o,i;return e={contextName:t},o=null!=(i=App.controller.tidyIntParam("ctx_page"))?i:1,0>=o&&(o=1),e.page=o,e},o.prototype.initialize=function(t,e){return null==e&&(e={}),o.__super__.initialize.apply(this,arguments),this.navigationDisabled?void 0:(e.contextHash&&(this._selectedPhotoPage=this._firstPage=this.page=e.contextHash.page,this._displayedPhoto=e.contextHash.displayedPhoto),this.listenToOnce(this,"pagination:overflow:refetched",function(t){return function(e){var o,i;if(null!=t._displayedPhotoId){if(i=t._getPhotoIds().indexOf(t._displayedPhotoId),null==i)throw new Error("Cannot find the injected photo in nav context!");return o=t.at(i),o.set({membership_attr_nav_page:e,membership_attr_nav_intra_page_offset:0,membership_attr_nav_offset:(e-1)*(t.rpp+1)},{silient:!0}),1!==e?t.previousPage():void 0}}}(this)))},o.prototype.buildBrowserUrlParams=function(){if(this.navigationDisabled)throw new Error("navigation is disabled");return _.extend({ctx_page:this._selectedPhotoPage},this._contextUrlParams())},o.prototype.selectedPhotoOffset=function(){if(this.navigationDisabled)throw new Error("navigation is disabled");return this._selectedPhotoId?this._getPhotoIds().indexOf(this._selectedPhotoId):-1},o.prototype.selectPhoto=function(t){var e;if(this.navigationDisabled)throw new Error("navigation is disabled");switch(e=this._internalSelectPhoto(t)){case 1:return this.nextPage();case-1:return this.previousPage()}},o.prototype.getLength=function(){return this.length},o.prototype._internalSelectPhoto=function(t){var e,o,i,r,n;if(this._selectedPhotoId!==t.id){if(i=this._getPhotoIds(),e=i.indexOf(t.id),null==e)throw new Error("Cannot find the newly selected photo in nav context!");return this._selectedPhotoId=t.id,r=this.at(e),this._selectedPhotoPage=r.get("membership_attr_nav_page"),n=r.get("membership_attr_nav_intra_page_offset"),n<=this.FETCH_MORE_THRESHOLD?(o=this.getFirstPage(),1===o?!1:this._selectedPhotoPage-1>=o?!1:-1):n>this.rpp-this.FETCH_MORE_THRESHOLD?this.finished()?!1:this._selectedPhotoPage+1<=this.page?!1:1:!1}},o.prototype.parse=function(t){var e,r,n,s,a,l,u,p,c;return t=o.__super__.parse.call(this,t),this.navigationDisabled?t:(n=null!=(c=this._displayedPhoto)?c.id:void 0,a=null==n,r=(this._just_parsed_page-1)*(2*this.rpp+1),s=this._getPhotoIds(),e=function(){var e,o,c;for(c=[],l=e=0,o=t.length;o>e;l=++e)u=t[l],p=this._extractPhotoIdFromItem(u),i.call(s,p)>=0||(s.unshift(p),u.membership_attr_nav_page=this._just_parsed_page,u.membership_attr_nav_intra_page_offset=l+1,u.membership_attr_nav_offset=r+u.membership_attr_nav_intra_page_offset,a||(a=p===n),c.push(u));return c}.call(this),a||(u=this._buildDisplayedItemData(this._displayedPhoto),u.membership_attr_nav_page=this._just_parsed_page,u.membership_attr_nav_intra_page_offset=0,u.membership_attr_nav_offset=r,e.unshift(u),this._displayedPhotoId=this._displayedPhoto.id),this._displayedPhoto=null,e)},o}(App.Collections.InfiniteCollection)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Quests.Collections"),t.QuestEntries=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.rpp=50,o.prototype.model=App.Photos.Models.PhotoMembership,o.prototype.initialize=function(t,e){return o.__super__.initialize.apply(this,arguments),e.contextHash?this.questId=e.contextHash.questId:(this.questId=e.questId,this.marketplaceOnly=e.marketplaceOnly,null!=e.rpp?this.rpp=e.rpp:void 0)},o.prototype.url=function(){var t;return t={rpp:this.rpp,image_size:PxApp.Constants.PHOTO_GRID_IMAGE_SIZES,include_licensing:!App.currentUser||App.currentUser.isBuyer()},this.marketplaceOnly&&(t.filter="marketplace"),PxApp.Constants.API_URL+"/quests/"+this.questId+"/entries?"+$.param(t)},o.prototype.photoAt=function(t){return this.at(t).getPhoto()},o.prototype._getPhotoIds=function(){return this.pluck("id")},o.prototype._contextUrlParams=function(){return{from:"quest_entries",quest_id:this.questId}},o.prototype._extractPhotoIdFromItem=function(t){return t.id},o.prototype._buildDisplayedItemData=function(t){return t.toJSON()},o.prototype.shouldHideRelatedPhotos=function(){return!1},o.parseBrowserUrlParams=function(t){var e,i;return e=o.__super__.constructor.parseBrowserUrlParams.apply(this,arguments),e.questId=null!=(i=App.controller.tidyIntParam("quest_id"))?i:-1,e.questId>0?e:{}},o}(App.Photos.Collections.NavigationalInfiniteCollection)}.call(this),function(){var t,e,o,i,r,n=function(t,e){function o(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},s={}.hasOwnProperty,a=function(t,e){return function(){return t.apply(e,arguments)}},l=[].indexOf||function(t){for(var e=0,o=this.length;o>e;e++)if(e in this&&this[e]===t)return e;return-1};i=null!=(r="undefined"!=typeof App&&null!==App?App.module("Views"):void 0)?r:window,t=$(window),e=3,o=function(t){function o(){null==this.modelEvents&&(this.modelEvents={}),_.extend(this.modelEvents,{"change:selected":"changeSelected","change:images":"onRender","change:name":"onRender","change:selected":"onRender"}),null==this.events&&(this.events={}),_.extend(this.events,{click:"clickPhoto"}),o.__super__.constructor.apply(this,arguments)}return n(o,t),o.prototype.template="squared_photo_grid_item",o.prototype.tagName="li",o.prototype.className="squared_photo_grid_item",o.prototype.clickPhoto=function(t){return t.stopPropagation(),this.throttledPhotoSelection(t)},o.prototype._selectPhoto=function(t){var e;return null!=(e=this.model.collection)?e.trigger("select",this.model,t):void 0},o.prototype._getPhotoModel=function(){throw new Error("Missing implementation")},o.prototype.changeSelected=function(t,e){return this.$el.toggleClass("ui-selected",!!this.model.get("selected"))},o.prototype.serializeData=function(){var t,e,o,i,r;for(o=this._getPhotoModel().toJSON(),r=this._getPhotoModel().get("images"),e=0,i=r.length;i>e;e++)t=r[e],3===t.size&&"jpeg"===t.format&&(o.image_url=t.https_url);return o},o.prototype.onRender=function(){var t,o,i,r,n,s,a,l,u;for(o=null!=(s=_.result(this,"defaultImageSize"))?s:e,i=new Image,a=this._getPhotoModel().get("images"),r=0,n=a.length;n>r;r++)t=a[r],t.size===o&&"jpeg"===t.format&&(u=t.https_url);return null==u&&(u=null!=(l=this._getPhotoModel().get("images")[0])?l.https_url:void 0),i.alt="name",i.onload=function(t){return function(){var e;return t.changeSelected(),e=i.height>i.width,t.$("img").attr("src",i.src).toggleClass("portrait",e).toggleClass("landscape",!e),t.resizeOverlay(),t.$el.addClass("loaded")}}(this),i.onerror=function(t){return function(){return t.changeSelected(),t.$el.find("img").attr("src","//assetcdn.500px.org/assets/organizer/converting_drag_handle-65e26c3290e09280004461b1e6aea05d.png"),t.$el.addClass("loaded")}}(this),null!=u&&(i.src=u),this.$el.data("model",this.model),null!=this.throttledPhotoSelection?this.throttledPhotoSelection:this.throttledPhotoSelection=_.throttle(this._selectPhoto,300,{trailing:!1})},o.prototype.resizeOverlay=function(){var t,e,o;return t=this.$("img"),o=2*Math.round((t.width()-1)/2),e=2*Math.round((t.height()-1)/2),0!==t.width()&&0!==t.height()?this.$(".overlay").width(o).height(e):void 0},o}(Marionette.ItemView),i.SquaredPhotoGrid=function(e){function i(t){this.onMouseClickLockedForm=a(this.onMouseClickLockedForm,this),this.onMouseDownUnlockedForm=a(this.onMouseDownUnlockedForm,this),null==this.behaviors&&(this.behaviors={}),null!=t.collection.fetching&&(this.behaviors.InfiniteScroll={container:function(){return this.$el}}),i.__super__.constructor.apply(this,arguments)}return n(i,e),i.GridItem=o,i.prototype.config={thumbMargin:20,minWidth:140},i.prototype.className="squared_photo_grid",i.prototype.tagName="ul",i.prototype.childView=o,i.prototype.childViewContainer="ul.photos",i.prototype.collectionEvents=function(){return{select:"toggleModelSelection",selectAll:"selectAll","change:selected":"onModelSelected"}},i.prototype._isClickOnScrollbar=function(t){var e,o,i;return o=null!=(i=t.offsetX)?i:t.pageX-this.$el.offset().left,e=this.$el.outerWidth()-o,null==this._scrollbarWidth&&(this._scrollbarWidth=App.Views.Common.Helpers.measureScrollBarWidth()),e<=this._scrollbarWidth},i.prototype.enable=function(){return this.$el.removeClass("disabled")},i.prototype.disable=function(){return this.$el.addClass("disabled")},i.prototype.onMouseDownUnlockedForm=function(t){var e,o,i;if(!this._isClickOnScrollbar(t)&&!t.metaKey&&!t.ctrlKey)return e=$(t.target),e.is("ul.squared_photo_grid")||e.is(".groupDivider")||e.is("h3.fixedheader")?("function"==typeof(o=this.collection).startSelection&&o.startSelection(),this._clearSelection(),"function"==typeof(i=this.collection).finishSelection?i.finishSelection():void 0):void 0},i.prototype.onMouseClickLockedForm=function(t){var e,o,i;if(!this._isClickOnScrollbar(t)&&(e=$(t.target),e.is("ul.squared_photo_grid")||e.is(".groupDivider")||e.is("h3.fixedheader")))return(e.is("ul.squared_photo_grid")||e.is(".groupDivider")||e.is("h3.fixedheader"))&&App.router.lockNavigationConfirmMessage&&confirm(App.router.lockNavigationConfirmMessage)?("function"==typeof(o=this.collection).startSelection&&o.startSelection(),this._clearSelection(),"function"==typeof(i=this.collection).finishSelection&&i.finishSelection(),App.router.unlockNavigation()):void 0},i.prototype.initialize=function(t){var e,o,i,r;return null==t&&(t={}),this._resizeDebounced=_.debounce(function(t){return function(){return t.resize()}}(this)),null!=t.maxFiles&&null==t.multiselect&&(t.multiselect=1!==t.maxFiles),this.multiselect=null!=(e=t.multiselect)?e:!0,this.autoReset=null!=(o=t.autoReset)?o:!1,this.multiselect?this.maxFiles=null!=(i=t.maxFiles)?i:5:(this.autoReset=!0,this.maxFiles=1),this.groupBy=null!=(r=t.groupBy)?r:null,this.$el.on("mousedown",this.onMouseDownUnlockedForm),App.vent.on("unlock-navigation",function(t){return function(){return t.$el.off("click",t.onMouseClickLockedForm),t.$el.on("mousedown",t.onMouseDownUnlockedForm)}}(this)),App.vent.on("lock-navigation",function(t){return function(){return t.$el.on("click",t.onMouseClickLockedForm),t.$el.off("mousedown",t.onMouseDownUnlockedForm)}}(this))},i.prototype.onBeforeAddChild=function(t){var e,o,i;return this._thumbWidth||this._computeThumbWidth(),null!=this.groupBy&&(o=this.groupBy(t.model),e=t.model.collection,i=e.indexOf(t.model),0===i||this.groupBy(e.at(i-1))!==o)?this.$el.append(this.buildSeperatorEl(o)):void 0},i.prototype.buildSeperatorEl=function(t){throw new Error("Implementation missing")},i.prototype._clearSelection=function(t){var e,o,i,r,n,s,a,u,p,c;if(null==t&&(t=null),t instanceof Array){for(s=this.collection.models,p=[],e=0,i=s.length;i>e;e++)n=s[e],!n.get("selected")||(a=n.id,l.call(t,a)>=0)||p.push(n.set("selected",!1));return p}for(u=this.collection.models,c=[],o=0,r=u.length;r>o;o++)n=u[o],n.get("selected")&&n.id!==t&&c.push(n.set("selected",!1));return c},i.prototype.selectAll=function(){var t,e,o,i,r,n;if(this.maxFiles<=0||this.collection.models.length<=this.maxFiles){for("function"==typeof(t=this.collection).startSelection&&t.startSelection(),n=this.collection.models,o=0,i=n.length;i>o;o++)r=n[o],r.get("selected")||r.set("selected",!0);return"function"==typeof(e=this.collection).finishSelection?e.finishSelection():void 0}},i.prototype.toggleModelSelection=function(t,e){var o,i;return"function"==typeof(o=this.collection).startSelection&&o.startSelection(),this.multiselect?this.autoReset?t.get("selected")?(null!=e?e.metaKey:void 0)||(null!=e?e.ctrlKey:void 0)?t.set("selected",!1):this._clearSelection(t.id):((null!=e?e.metaKey:void 0)||(null!=e?e.ctrlKey:void 0)||this._clearSelection(),
this.maxFiles<=0||this._getSelected().length<this.maxFiles?t.set("selected",!0):this.collection.trigger("maximum_selection")):t.get("selected")?t.set("selected",!1):this.maxFiles<=0||this._getSelected().length<this.maxFiles?t.set("selected",!0):this.collection.trigger("maximum_selection"):(this._clearSelection(t.id),t.set("selected",!t.get("selected"))),"function"==typeof(i=this.collection).finishSelection?i.finishSelection():void 0},i.prototype.onModelSelected=function(t,e){var o,i;return e&&!this.multiselect&&("function"==typeof(o=this.collection).startSelection&&o.startSelection(),this._clearSelection(t.id),"function"==typeof(i=this.collection).finishSelection&&i.finishSelection()),this.collection.trigger("selection",this._getSelected())},i.prototype.onShow=function(){return t.on("resize",this._resizeDebounced)},i.prototype.onDestroy=function(){return t.off("resize",this._resizeDebounced)},i.prototype.resize=function(){return this.collection.length?(this._computeThumbWidth(),this._scalePhotos()):void 0},i.prototype.addChild=function(){var t;return t=i.__super__.addChild.apply(this,arguments),t.$el.width(this._thumbWidth).height(this._thumbWidth),t},i.prototype._getDefaultGridWidth=function(){},i.prototype._getSelected=function(){var t,e,o,i,r;for(i=this.collection.models,r=[],t=0,e=i.length;e>t;t++)o=i[t],o.get("selected")&&r.push(o);return r},i.prototype._computeThumbWidth=function(){var t,e;return e=(this.$el.width()||this._getDefaultGridWidth())-this._getScrollbarWidth(),e-=this.config.thumbMargin,t=Math.floor(e/(this.config.minWidth+this.config.thumbMargin)),this._thumbWidth=Math.floor(e/t)-this.config.thumbMargin},i.prototype._scalePhotos=function(){return this.children.each(function(t){return function(e){return e.$el.width(t._thumbWidth).height(t._thumbWidth),e.resizeOverlay()}}(this))},i.prototype.thumbWidth=function(){return this._thumbWidth},i.prototype._getScrollbarWidth=function(){var t,e,o,i;return null!=this._scrollbarWidth?this._scrollbarWidth:(e=document.createElement("div"),e.style.visibility="hidden",e.style.width="100px",document.body.appendChild(e),o=e.offsetWidth,e.style.overflow="scroll",t=document.createElement("div"),t.style.width="100%",e.appendChild(t),i=t.offsetWidth,e.parentNode.removeChild(e),this._scrollbarWidth=o-i)},i}(Marionette.CollectionView)}.call(this),function(){var t,e,o,i,r,n=function(t,e){function o(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},s={}.hasOwnProperty;e=null!=(o="undefined"!=typeof App&&null!==App?App.module("Views"):void 0)?o:window,r=null!=(i="undefined"!=typeof App&&null!==App?App.module("Views"):void 0)?i:window,t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.defaultImageSize=30,e.prototype._getPhotoModel=function(){return this.model},e}(r.SquaredPhotoGrid.GridItem),e.PhotoPickerGrid=function(e){function o(){return o.__super__.constructor.apply(this,arguments)}return n(o,e),o.prototype.childView=t,o.prototype._getDefaultGridWith=function(){return 796},o}(r.SquaredPhotoGrid)}.call(this),function(){var t,e,o,i=function(t,e){return function(){return t.apply(e,arguments)}},r=function(t,e){function o(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},n={}.hasOwnProperty;e=null!=(o="undefined"!=typeof App&&null!==App?App.module("Views"):void 0)?o:window,t=$(window),e.PhotoPickerModal=function(o){function n(){return this.resize=i(this.resize,this),n.__super__.constructor.apply(this,arguments)}return r(n,o),n.prototype.DEFAULT_MAX_FILES=10,n.prototype.template="photo_picker_modal",n.prototype.className="photo_picker_modal",n.prototype.ui={title:".title",searchBox:"input.photo-search",addButton:"a.add-button",cancelButton:"a.cancel-button"},n.prototype.regions={photos:".modal-body"},n.prototype.events={"keyup @ui.searchBox":"searchPhotos","change @ui.searchBox":"searchPhotos"},n.prototype.behaviors={HasButtons:{"@ui.cancelButton":"clickCancel","@ui.addButton":"clickAdd"},ModalDialog:{dialogClass:"photo_picker_modal",closeButton:!1}},n.prototype.collectionEvents={selection:"selectionChanged",maximum_selection:"overSelection",reset:"restoreSelected"},n.prototype.initialize=function(t){var e;return this.maxFiles=null!=(e=t.maxFiles)?e:this.DEFAULT_MAX_FILES,this.mode=t.mode},n.prototype.onRender=function(){return null!=this.mode&&(this.ui.title.text(this.ui.title.data("text-"+this.mode)),this.ui.addButton.text(this.ui.addButton.data("text-"+this.mode))),_.delay(function(t){return function(){return t.grid=new e.PhotoPickerGrid({collection:t.collection,maxFiles:t.maxFiles}),t.photos.show(t.grid),t.updateFilesLeft(),null!=t.collection.searchTerm&&t.ui.searchBox.val(t.collection.searchTerm),t._originallySelected=t._selectedPhotos()}}(this))},n.prototype.overSelection=function(){return this.$(".selectionCount").addClass("em"),_.delay(function(t){return function(){return t.$(".selectionCount").removeClass("em")}}(this),250)},n.prototype.selectionChanged=function(t){return this.storeSelected(),this.updateFilesLeft()},n.prototype.updateFilesLeft=function(){var t;return this.$("p.selectionCount span").text(this.maxFiles-(null!=(t=this._selectedPhotos().length)?t:0))},n.prototype.storeSelected=function(){return this._selected=this._selectedPhotos()},n.prototype.restoreSelected=function(){var t,e,o,i,r;for(o=this._selected,i=[],t=0,e=o.length;e>t;t++)r=o[t],i.push(this.collection.add(r));return i},n.prototype._selectedPhotos=function(){var t,e,o,i,r;for(i=this.collection.models,r=[],t=0,e=i.length;e>t;t++)o=i[t],o.get("selected")&&r.push(o);return r},n.prototype.clickCancel=function(){var t,e,o,i,r,n,s;for(n=this.collection.models,t=0,o=n.length;o>t;t++)r=n[t],r.set("selected",!1);for(s=this._originallySelected,e=0,i=s.length;i>e;e++)r=s[e],r.set("selected",!0);return this.destroyModal()},n.prototype.clickAdd=function(){return this.trigger("selected",this._selectedPhotos()),this.destroyModal()},n.prototype.resize=function(){var e,o,i,r,n;return i=1025,n=t.width()-23,i>n&&(i=n),this.$el.css("width",i+"px"),o=700,r=t.height()-23,o>r&&(o=r),this.$el.css("height",o+"px"),e=this.$(".modal-header").outerHeight()+this.$(".modal-footer").innerHeight(),this.grid.$el.css("height",o-e-5+"px"),this.grid.resize(),this.trigger("resize")},n.prototype.searchPhotos=function(){var t;return this.storeSelected(),t=this.ui.searchBox.val(),this.searchTerm!==t?(this.searchTerm=t,this._wasReset||(this.collection.reset(),this._wasReset=!0),this._realSearch()):void 0},n.prototype._realSearch=_.debounce(function(){return this.collection.search(this.searchTerm),this._wasReset=!1},500),n}(Marionette.LayoutView)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Collections"),t.PhotoLibrary=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.ONLY_PROFILE=1,o.prototype.rpp=50,o.prototype.url=function(){var t,e;return t=PxApp.Constants.API_URL+"/photos",e={feature:"user_library",user_id:this.userId,image_size:this.imageSizes},e.only_profile=null!=this.options.only_profile?this.options.only_profile:this.ONLY_PROFILE,this.searchTerm&&(e.search_term=this.searchTerm),t+"?"+$.param(e)},o.prototype.initialize=function(t,e){var i;return null==t&&(t=!1),null==e&&(e={}),this.options=e,this.userId=this.options.userId,this.imageSizes=null!=(i=this.options.imageSizes)?i:[3,4,30],o.__super__.initialize.call(this,t)},o.prototype.search=function(t){return this.searchTerm=t,this.fetch()},o}(App.Collections.InfiniteCollection)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Quests.Views"),t.SubmitToQuestPopover=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.template="submit_to_quest_popover",o.prototype.className="submit_to_quest_popover",o.prototype.ui={submitUploadButton:".submit_to_quest_popover__option--upload",submitLibraryButton:".submit_to_quest_popover__option--library",messages:".submit_to_quest_popover__messages"},o.prototype.behaviors={IsPopover:{classPrefix:"submit_to_quest_popover"},HasButtons:{"@ui.submitUploadButton":"onClickUpload","@ui.submitLibraryButton":"onClickLibrary"}},o.prototype.initialize=function(t){var e;return this.options=null!=t?t:{},this.photoPickerMode=null!=(e=this.options.photoPickerMode)?e:"submit-to-quest"},o.prototype.onClickUpload=function(){return this.dismiss(),App.Uploader.show({quest:this.model.id,redirectToManage:!1}),this.listenTo(App.vent,"uploader:published",function(t){return function(){return t._onSubmitSuccess()}}(this)),this.listenTo(App.vent,"uploader:publishFailed",function(t){return function(){return t._onSubmitFailure()}}(this))},o.prototype.onClickLibrary=function(){var t;return this.dismiss(),t=new App.Collections.PhotoLibrary(!1,{userId:App.currentUser.id,only_profile:!0}),t.fetch().done(function(e){return function(){var o;return o=new App.Views.PhotoPickerModal({collection:t,mode:e.photoPickerMode}),o.showModal(),e.listenTo(o,"selected",e.submitPhotos)}}(this))},o.prototype.submitPhotos=function(t){var e;return e=_.map(t,function(t){return function(e){return e=new App.Models.Photo(e),e.submitToQuest(t.model.id)}}(this)),$.when(e).done(function(t){return function(){return t._onSubmitSuccess()}}(this)).fail(function(t){return function(){return t._onSubmitFailure()}}(this))},o.prototype._onSubmitSuccess=function(){var t,e;return t=null!=(e=this.options.successMessage)?e:this.ui.messages.i18n("success",{"return":!0}),App.Flash.success(t),App.vent.trigger("questSubmission::success")},o.prototype._onSubmitFailure=function(){var t,e;return t=null!=(e=this.options.failMessage)?e:this.ui.messages.i18n("fail",{"return":!0}),App.Flash.error(t)},o}(Marionette.ItemView)}.call(this),function(){var t,e,o=function(t,e){function o(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},i={}.hasOwnProperty;e=App.module("Classes.Views"),t=$(window),e.ClassExercise=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return o(i,e),i.prototype.template="class_exercise",i.prototype.className="class_exercise",i.prototype.regions={sampleGridRegion:".class_exercise__sample_grid_region",submissionsRegion:".class_exercise__submissions_grid_region"},i.prototype.ui={returnLink:".class_return_link",submitButton:".class_exercise__submit_button"},i.prototype.behaviors={HasButtons:{"@ui.returnLink":"_onClickReturn","@ui.submitButton":"_onClickSubmit"}},i.prototype.templateHelpers=function(){var t,e,o,i;return{coursePath:null!=(t=this.model)?t.getLessonsPath():void 0,description:null!=(e=this.model)&&null!=(o=e.getQuest())?o.get("brief"):void 0,hasSubmissions:(null!=(i=this.submissions)?i.length:void 0)>0,dataFetched:this.dataFetched}},i.prototype.initialize=function(t){return null==t&&(t={}),this.courseId=t.courseId,this.dataStore=t.dataStore,this.dataFetched=!1,this.dataStore.getCourse(this.courseId).done(function(t){return function(e){var o;return t.model=e,o=[t.model.fetchQuest(),t.model.fetchExerciseSubmissions()],t.model.hasSampleGallery()&&o.push(t.model.fetchSampleGalleryPhotos()),$.when.apply($,o).done(function(){return t.dataFetched=!0,t.model.hasSampleGallery()&&(t.sampleGalleryPhotos=t.model.getSampleGalleryPhotos()),t.submissions=t.model.getExerciseSubmissions(),t.render()})}}(this)),this.listenTo(App.vent,"showPhoto",function(t){return function(e,o){var i;return i=App.Photos.show(e.id,{navigationContext:o.navigationContext}),o.navigationContext===t.submissions?t.listenToOnce(i,"before:destroyModal",function(){var e;return e=o.navigationContext.selectedPhotoOffset(),t._scrollToShow(e)}):void 0}}(this)),this.listenTo(App.vent,"questSubmission::success",function(t){return function(){var e,o;return null!=(e=t.submissions)&&e.reset(),null!=(o=t.submissions)?o.fetch().done(function(){return t.render()}):void 0}}(this))},i.prototype.onRender=function(){var t,e,o;return null!=this.model&&((null!=(e=this.sampleGalleryPhotos)?e.length:void 0)>0&&(t={collection:this.sampleGalleryPhotos,hasHoverState:!0,showTitle:!0,waitThumbnailsLoad:!1,showPulse:!1,pagination:!1,hasLoadingSpinner:!1,border:0},this.sampleGridRegion.show(new App.Photos.Views.FullAspectRatioPhotoGrid(t))),(null!=(o=this.submissions)?o.length:void 0)>0)?(t={collection:this.submissions,hasHoverState:!0,waitThumbnailsLoad:!1,showPulse:!1,pagination:!0,hasLoadingSpinner:!0,border:0},this.submissionsRegion.show(new App.Photos.Views.FullAspectRatioPhotoGrid(t))):void 0},i.prototype._onClickReturn=function(){return null!=this.model&&Backbone.history.navigate(this.model.getLessonsPath(),{trigger:!0}),!1},i.prototype._onClickSubmit=function(){var t;return t=event,App.Classes.Views.ClassContentLockModal.handleContentAccess(this.model,this.dataStore).done(function(e){return function(){var o,i,r;return null!=(r=window.AmplitudeLogger)&&r.classesEvent("Submit Clicked","Class Exercise",e.model.get("id")),i={position:{my:"top center",at:"bottom center"}},o={model:e.model.getQuest(),photoPickerMode:"submit-to-class",successMessage:e.ui.submitButton.i18n("success",{"return":!0}),failMessage:e.ui.submitButton.i18n("fail",{"return":!0})},e.model.fetchQuest().done(function(){var e;return e=new App.Quests.Views.SubmitToQuestPopover(o),e.showPopover(t,i)})}}(this))},i.prototype._scrollToShow=function(e){var o,i,r;return o=this.$(".class_exercise__submissions_grid_region .full-aspect-ratio-photo-grid .photo_thumbnail").eq(e).offset().top,r=t.scrollTop(),i=t.scrollTop()+t.height()-100,o>=r&&i>=o?void 0:t.scrollTop(o)},i}(Marionette.LayoutView)}.call(this),function(){var t;t=App.module("Helpers"),t.mobileOS=function(t){return t.match(/^ip/)?"ios":"android"},t.appLink=function(t){return t.match(/^ip/)?"https://itunes.apple.com/app/500px/id471965292":"https://play.google.com/store/apps/details?id=com.fivehundredpx.viewer"},t.openOrDownloadApp=function(t,e){return _.delay(function(){return window.location=e},25),window.location=t},t.deviceType=function(){var t,e;return(e=navigator.userAgent.match(/iP(ad|hone)|Android/))?(t=null,"Android"===e[0]?t=navigator.userAgent.match(/Mobile/)?Math.max($(window).height(),$(window).width())>700?"androidTablet":"androidPhone":"androidTablet":e&&(t=e[0].toLowerCase()),t):null},t.isSmartphone=function(){return $("body").hasClass("smartphone")},t.isTablet=function(){return $("body").hasClass("tablet")},t.isDesktop=function(){return $("body").hasClass("desktop")},t.isMobileOrTablet=function(){return t.isSmartphone()||t.isTablet()},t.isIOS=function(){var e;return e=t.deviceType(),e&&"ios"===t.mobileOS(e)},t.androidIntentLink=function(t){return"intent://500px.com"+t+"#Intent;scheme=px;package=com.fivehundredpx.viewer;S.browser_fallback_url="+PxApp.Constants.MAIN_500PX_URL+"/"+t+";end"},t.iosLink=function(t){return"px://500px.com"+t}}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},o=function(t,e){function o(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},i={}.hasOwnProperty;t=App.module("Classes.Views"),t.ClassHeader=function(t){function i(){return this._updateNavOffset=e(this._updateNavOffset,this),i.__super__.constructor.apply(this,arguments)}return o(i,t),i.prototype.template="class_header",i.prototype.tagName="header",i.prototype.fixedClassName="class_header__tabs_wrapper--fixed",i.prototype.ui={tabs:".class_header__tabs_wrapper",overviewTab:".class_header__overview_tab",lessonsTab:".class_header__lessons_tab",classesIndexBtn:".class_header__classes_index_link",joinBtn:".class_header__join_button",leaveBtn:".class_header__leave_button",upgradeBtn:".class_header__locked_banner_upgrade_button",signupBtn:".class_header__locked_banner_signup_button",resendConfirmBtn:".class_header__locked_banner_resend_confirm_button"},i.prototype.behaviors={HasButtons:{"@ui.overviewTab":"_onClickOverview","@ui.lessonsTab":"_onClickLessons","@ui.classesIndexBtn":"_onClickClassesIndex","@ui.joinBtn":"_onClickJoin","@ui.leaveBtn":"_onClickLeave","@ui.upgradeBtn":"_onClickUpgrade","@ui.signupBtn":"_onClickSignup","@ui.resendConfirmBtn":"_onClickResendConfirm"}},i.prototype.templateHelpers=function(){var t,e;return{selectedTab:this.selectedTab,coverPhotoUrl:this.model.coverPhotoUrl(PxApp.Constants.PHOTO_SIZES.S3_IMG_WEB_1500),enrollmentCount:this.model.get("enrollment_count").toLocaleString(),hasClasses:PxCurrentUser.isAuthorized("classes"),enrolled:this.model.isEnrolled(),showLockedBanner:this._showLockedBanner(),onTrial:this._isOnTrial(),timeRemaining:null!=(t=App.currentUser)?t.timeRemaining():void 0,contentLocked:this._isContentLocked(),isUserLoggedIn:null!=App.currentUser,isUserActivated:null!=(e=App.currentUser)?e.isActive():void 0,returnPath:this.model.getPath(),isBrowserIOS:App.Helpers.isIOS(),iosLink:App.Helpers.iosLink("/classes/"+this.model.id),androidLink:App.Helpers.androidIntentLink("/classes/"+this.model.id),returnToMyClasses:"myclasses"===this.dataStore.getIndexRoute()}},i.prototype.className=function(){return this._showLockedBanner()?"class_header class_header--with-locked-banner":"class_header"},i.prototype.initialize=function(t){return null==t&&(t={}),this.selectedTab=t.selectedTab,this.dataStore=t.dataStore,null==this.selectedTab&&(this.selectedTab="overview"),this.listenTo(this.model,"change:enrollment",this.render),$(window).scrollspy({namespace:"class_page",min:function(t){return function(){return t.navOffset}}(this),max:99999999,onEnter:function(t){return function(){return t.fixedTabs=!0,t.ui.tabs.length>0?t.ui.tabs.addClass(t.fixedClassName):void 0}}(this),onLeave:function(t){return function(){return t.fixedTabs=!1,t.ui.tabs.length>0?t.ui.tabs.removeClass(t.fixedClassName):void 0}}(this)})},i.prototype.onRender=function(){return this.$("[data-tab="+this.selectedTab+"]").addClass("active"),this.ui.tabs.length>0&&this.fixedTabs?this.ui.tabs.addClass(this.fixedClassName):void 0},i.prototype.onAttach=function(){return this._updateNavOffset(),$(window).on("resize",this._updateNavOffset),$(window).trigger("scroll")},i.prototype.onDestroy=function(){return $(window).off("scroll.class_page"),$(window).off("resize",this._updateNavOffset)},i.prototype._showLockedBanner=function(){return this._isOnTrial()||this._isContentLocked()},i.prototype._isOnTrial=function(){var t;return null!=(t=App.currentUser)?t.isTrialMember():void 0},i.prototype._isContentLocked=function(){return!App.currentUser||!PxCurrentUser.isAuthorized("classes")},i.prototype._onClickOverview=function(){return"overview"!==this.selectedTab&&Backbone.history.navigate(this.model.getPath(),{trigger:!0}),!1},i.prototype._onClickLessons=function(){return"lessons"!==this.selectedTab&&Backbone.history.navigate(this.model.getLessonsPath(),{trigger:!0}),!1},i.prototype._onClickClassesIndex=function(){return"myclasses"===this.dataStore.getIndexRoute()?Backbone.history.navigate("/classes/myclasses",{trigger:!0}):Backbone.history.navigate("/classes",{trigger:!0}),!1},i.prototype._onClickJoin=function(){var t;return null!=(t=window.AmplitudeLogger)&&t.classesEvent("Enroll Clicked - Enrolled","Class Overview",this.model.get("id"),this.model.videoStateName()),this.model.enroll().done(function(t){return function(){return t.dataStore.setEnrollmentCount(t.dataStore.getEnrollmentCount()+1)}}(this))},i.prototype._onClickLeave=function(){var t;return null!=(t=window.AmplitudeLogger)&&t.classesEvent("Drop Clicked","Class Overview",this.model.get("id"),this.model.videoStateName()),this.model.drop().done(function(t){return function(){return t.dataStore.setEnrollmentCount(t.dataStore.getEnrollmentCount()-1)}}(this))},i.prototype._onClickUpgrade=function(t){var e;return t.preventDefault(),null!=(e=window.AmplitudeLogger)&&e.classesEvent("Upgrade Clicked","Class Overview Lock Banner",this.model.get("id"),this.model.videoStateName()),window.location.href="/upgrade?r="+this.model.getPath()+"&classes_access=false"},i.prototype._onClickSignup=function(){var t,e;return null!=(e=window.AmplitudeLogger)&&e.classesEvent("Signup Clicked","Class Overview Lock Modal",this.model.get("id"),this.model.videoStateName()),t=new App.Views.SignupLoginModal({userAction:"Classes Lock Banner"}),t.on("signup:success login:success",function(){return window.location.reload()}),t.showModal()},i.prototype._onClickResendConfirm=function(){var t,e;return null!=(t=window.AmplitudeLogger)&&t.classesEvent("Resend Email Confirmation Clicked","Class Overview Lock Modal",this.model.get("id"),this.model.videoStateName()),null!=(e=$("#resend_activation_form"))?e.submit():void 0},i.prototype._updateNavOffset=function(){return this.ui.tabs.length>0?this.navOffset=this.ui.tabs.offset().top:void 0},i}(Marionette.LayoutView)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Classes.Views"),t.ClassLessons=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.template="class_lessons",o.prototype.className="class_lessons",o.prototype.regions={headerRegion:".class_header_region",webinarRegion:".class_lesson__webinar_region"},o.prototype.ui={videoItem:".class_lesson__item--video .class_lesson__item_label",tutorialItem:".class_lesson__item--tutorial .class_lesson__item_label",exerciseItem:".class_lesson__item--exercise .class_lesson__item_label",tutorialContent:".class_lesson__item--tutorial .class_lesson__item_expandable_content",downloadTutorialButton:".class_lesson__download_tutorial_button"},o.prototype.behaviors={HasButtons:{"@ui.videoItem":"_onClickVideo","@ui.tutorialItem":"_onClickTutorial","@ui.exerciseItem":"_onClickExercise","@ui.downloadTutorialButton":"_onClickDownloadTutorial"}},o.prototype.templateHelpers=function(){var t,e;return{videoPath:null!=(t=this.model)?t.getVideoPath():void 0,exercisePath:null!=(e=this.model)?e.getExercisePath():void 0,hasTutorial:!!this.model.get("resources_location"),hasVideo:this.model.get("webinar_download_available"),hasExercise:!!this.model.get("quest_id"),lessonItemSequence:function(){return null==this.count&&(this.count=0),this.count+=1}}},o.prototype.initialize=function(t){return null==t&&(t={}),this.courseId=t.courseId,this.dataStore=t.dataStore,this.dataStore.getCourse(this.courseId).done(function(t){return function(e){return t.model=e,t.render()}}(this))},o.prototype.onRender=function(){return null!=this.model&&(this.headerRegion.show(new App.Classes.Views.ClassHeader({model:this.model,selectedTab:"lessons",dataStore:this.dataStore})),this.model.isUpcoming()||this.model.isLive())?this.webinarRegion.show(new App.Classes.Views.ClassWebinarBanner({model:this.model,dataStore:this.dataStore})):void 0},o.prototype._onClickVideo=function(){return null!=this.model&&Backbone.history.navigate(this.model.getVideoPath(),{trigger:!0}),!1},o.prototype._onClickTutorial=function(){return this.ui.tutorialContent.toggleClass("class_lesson__item_expandable_content--expanded")},o.prototype._onClickExercise=function(){return null!=this.model&&Backbone.history.navigate(this.model.getExercisePath(),{trigger:!0}),!1},o.prototype._onClickDownloadTutorial=function(){return App.Classes.Views.ClassContentLockModal.handleContentAccess(this.model,this.dataStore).done(function(t){return function(){var e;return null!=(e=window.AmplitudeLogger)&&e.classesEvent("Download Clicked","Class Lessons",t.model.get("id"),t.classVideoStateName),window.open(t.model.get("resources_location","_blank"))}}(this))},o}(Marionette.LayoutView)}.call(this),function(t,e,o,i){function r(t,e){return t[e]===i?v[e]:t[e]}function n(){var t=e.pageYOffset;return t===i?m.scrollTop:t}function s(t,e){var o=v["on"+t];o&&(b(o)?o.call(e[0]):(o.addClass&&e.addClass(o.addClass),o.removeClass&&e.removeClass(o.removeClass))),e.trigger("lazy"+t,[e]),p()}function a(e){s(e.type,t(this).off(f,a))}function l(o){if(k.length){o=o||v.forceLoad,T=1/0;var i,r,l=n(),u=e.innerHeight||m.clientHeight,p=e.innerWidth||m.clientWidth;for(i=0,r=k.length;r>i;i++){var c,h=k[i],g=h[0],_=h[d],y=!1,w=o;if(S(m,g)){if(o||!_.visibleOnly||g.offsetWidth||g.offsetHeight){if(!w){var C=g.getBoundingClientRect(),P=_.edgeX,A=_.edgeY;c=C.top+l-A-u,w=l>=c&&C.bottom>-A&&C.left<=p+P&&C.right>-P}if(w){s("show",h);var x=_.srcAttr,I=b(x)?x(h):g.getAttribute(x);I&&(h.on(f,a),g.src=I),y=!0}else T>c&&(T=c)}}else y=!0;y&&(k.splice(i--,1),r--)}r||s("complete",t(m))}}function u(){x>1?(x=1,l(),setTimeout(u,v.throttle)):x=0}function p(t){k.length&&(t&&"scroll"===t.type&&t.currentTarget===e&&T>=n()||(x||setTimeout(u,0),x=2))}function c(){C.lazyLoadXT()}function h(){l(!0)}var d="lazyLoadXT",g="lazied",f="load error",_="lazy-hidden",m=o.documentElement||o.body,y=e.onscroll===i||!!e.operamini||!m.getBoundingClientRect,v={autoInit:!0,selector:"img[data-src]",blankImage:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",throttle:99,forceLoad:y,loadEvent:"pageshow",updateEvent:"load orientationchange resize scroll touchmove focus",forceEvent:"",oninit:{removeClass:"lazy"},onshow:{addClass:_},onload:{removeClass:_,addClass:"lazy-loaded"},onerror:{removeClass:_},checkDuplicates:!0},w={srcAttr:"data-src",edgeX:0,edgeY:0,visibleOnly:!0},C=t(e),b=t.isFunction,P=t.extend,A=t.data||function(e,o){return t(e).data(o)},S=t.contains||function(t,e){for(;e=e.parentNode;)if(e===t)return!0;return!1},k=[],T=0,x=0;t[d]=P(v,w,t[d]),t.fn[d]=function(o){o=o||{};var i,n=r(o,"blankImage"),a=r(o,"checkDuplicates"),l=r(o,"scrollContainer"),u={};t(l).on("scroll",p);for(i in w)u[i]=r(o,i);return this.each(function(i,r){if(r===e)t(v.selector).lazyLoadXT(o);else{if(a&&A(r,g))return;var l=t(r).data(g,1);n&&"IMG"===r.tagName&&!r.src&&(r.src=n),l[d]=P({},u),s("init",l),k.push(l),p()}})},t(o).ready(function(){s("start",C),C.on(v.loadEvent,c).on(v.updateEvent,p),v.forceEvent&&C.on(v.forceEvent,h),t(o).on(v.updateEvent,p),v.autoInit&&c()})}(window.jQuery||window.Zepto||window.$,window,document),function(){var t,e,o,i,r,n;for(t=App.module("Flash"),r=["info","error","success"],e=function(t){return App.Flash[t]=function(e,o){return null==o&&(o={}),o.type=t,o.message=e,"undefined"!=typeof PxTopnav&&null!==PxTopnav?PxTopnav.$.publish("flash",o):void 0}},o=0,i=r.length;i>o;o++)n=r[o],e(n)}.call(this),"undefined"==typeof window.AMPLITUDE_LOADED){window.AMPLITUDE_LOADED=!0,function(t,e){function o(t,e){t.prototype[e]=function(){return this._q.push([e].concat(Array.prototype.slice.call(arguments,0))),this}}function i(t){function e(e){t[e]=function(){t._q.push([e].concat(Array.prototype.slice.call(arguments,0)))}}for(var o=0;o<d.length;o++)e(d[o])}var r=t.amplitude||{_q:[],_iq:{}},n=e.createElement("script");n.type="text/javascript",n.async=!0,n.src="https://d24n15hnbwhuhn.cloudfront.net/libs/amplitude-3.0.2-min.gz.js",n.onload=function(){t.amplitude.runQueuedFunctions()};var s=e.getElementsByTagName("script")[0];s.parentNode.insertBefore(n,s);for(var a=function(){return this._q=[],this},l=["add","append","clearAll","prepend","set","setOnce","unset"],u=0;u<l.length;u++)o(a,l[u]);r.Identify=a;for(var p=function(){return this._q=[],this},c=["setProductId","setQuantity","setPrice","setRevenueType","setEventProperties"],h=0;h<c.length;h++)o(p,c[h]);r.Revenue=p;var d=["init","logEvent","logRevenue","setUserId","setUserProperties","setOptOut","setVersionName","setDomain","setDeviceId","setGlobalUserProperties","identify","clearUserProperties","setGroup","logRevenueV2","regenerateDeviceId"];i(r),r.getInstance=function(t){return t=(t&&0!==t.length?t:"$default_instance").toLowerCase(),r._iq.hasOwnProperty(t)||(r._iq[t]={_q:[]},i(r._iq[t])),r._iq[t]},t.amplitude=r}(window,document);var AMPLITUDE_API_KEY="9d249102d4736c5a98373c4526f77ae3";amplitude.getInstance().init(AMPLITUDE_API_KEY,null,{saveEvents:!0,includeUtm:!0,includeReferrer:!0,includeGclid:!0});var userProperties={};if(window.PxCurrentUser&&window.PxCurrentUser.user){null!==PxCurrentUser.id&&amplitude.getInstance().setUserId(PxCurrentUser.id);var currentUser=JSON.parse(PxCurrentUser.user);userProperties={registration_date:currentUser.registration_date,upgrade_status:PxCurrentUser.type||"",show_nude:currentUser.show_nude||"",upload_limit_remaining:currentUser.hasOwnProperty("upload_limit")&&null!==currentUser.upload_limit?currentUser.upload_limit:"Infinite",is_admin:currentUser.admin||!1,upgrade_expiry_date:currentUser.upgrade_expiry_date||"",public_photos_count:currentUser.hasOwnProperty("photos_count")?currentUser.photos_count:"",is_buyer:currentUser.buyer||!1,total_affection:currentUser.hasOwnProperty("affection")?currentUser.affection:"",locale_setting:PxCurrentUser.locale||"",authorizations:[]};for(var feature in PxCurrentUser.__authorizations)PxCurrentUser.isAuthorized(feature)&&userProperties.authorizations.push(feature)}if("undefined"!=typeof optimizely)for(var experiment in optimizely.variationMap)userProperties["experiment_"+experiment+"_variation"]=optimizely.variationMap[experiment];amplitude.getInstance().setUserProperties(userProperties)}!function(t){t.deparam=function(e,o){var i={},r={"true":!0,"false":!1,"null":null};return t.each(e.replace(/\+/g," ").split("&"),function(e,n){var s,a=n.split("="),l=decodeURIComponent(a[0]),u=i,p=0,c=l.split("]["),h=c.length-1;if(/\[/.test(c[0])&&/\]$/.test(c[h])?(c[h]=c[h].replace(/\]$/,""),c=c.shift().split("[").concat(c),h=c.length-1):h=0,2===a.length)if(s=decodeURIComponent(a[1]),o&&(s=s&&!isNaN(s)?+s:"undefined"===s?void 0:void 0!==r[s]?r[s]:s),h)for(;h>=p;p++)l=""===c[p]?u.length:c[p],u=u[l]=h>p?u[l]||(c[p+1]&&isNaN(c[p+1])?{}:[]):s;else t.isArray(i[l])?i[l].push(s):void 0!==i[l]?i[l]=[i[l],s]:i[l]=s;else l&&(i[l]=o?void 0:"")}),i}}(jQuery),function(){var t,e;t=function(t){var e,o,i;return i=document.createElement("a"),i.href=t,o=i.pathname.split("/"),o.length<2?"unknown":(e=null,e=""===o[1]?"LoggedInHome":o[1])},e=function(t,e){var o;if("undefined"!=typeof amplitude&&null!==amplitude)return o=null,o=null!=e?amplitude.getInstance().logEvent(t,e):amplitude.getInstance().logEvent(t)},window.AmplitudeLogger={signup:{visitSignupPage:function(o){var i;return i=t(document.referrer),e("Signup - 1 - Signup - View",{ReferralSource:document.referrer,ActionSource:"Web_"+i,"User Action":o})},clickedSignup:function(t,o,i){return e("Signup - 2 - Signup Button - Click",{RegistrationType:t,ActionSource:o,"User Action":i})},completedSignup:function(t,o){return e("Signup - 3 - Signup - Complete",{UserType:t,"User Action":o})}},upload:{openedUploadModal:function(){var o;return o=t(window.location),e("Upload - 1 - Upload Button - Click",{ActionSource:o})},fileAdded:function(t){return e("Upload - 2 - Upload - Image Selected",{ImageSource:t})},clickedPublish:function(t){return e("Upload - 3 - Publish Photo Button - Press",{ImageSource:t})},publishComplete:function(){return e("Upload - 4 - Publish Photo - Complete")}},upgrade:{BADGE:"Badge",WIDGET:"Widget",PRO_PLUS:"Pro Plus",PRO:"Pro",AWESOME:"Awesome",PLUS:"Plus",PROFILE:"Profile",SIDEBAR:"Sidebar",buttonClicked:function(o,i,r,n){var s;return s=t(window.location),e("Upgrade - Button Click",{ButtonName:o,ActionSource:s,PaymentMethod:i,Success:r,ErrorFields:n})},pageView:function(t){var o;return null==t&&(t={}),_.isEmpty(t)&&(t={source:window.location.pathname,"current user type":PxCurrentUser.type,"referral url":document.referrer,queryParams:window.location.search}),null!=t.queryParams&&(o=$.deparam(t.queryParams.substr(1)),$.extend(!0,t,o),delete t.queryParams),e("Upgrade - Page View",t)},referrer:function(t,o,i){return e("Upgrade - Referrer",{Type:o,Referrer:t,Url:i})}},directoryEvent:{hireClicked:function(t,o){return e("Hire - Button Click",{ClickSource:t,Page:o})},modalSend:function(t,o){return e("Message Modal - Sent",{RecipientId:t,SenderId:o})},modalCancel:function(){return e("Message Modal - Cancelled")}},critiquesEvent:{critiquesCalloutClicked:function(t){var o,i;return null==t&&(t={}),o={source:window.location.pathname,"referral url":document.referrer},i=_.extend(o,t),e("Critiques Callout Clicked",i)},forCritiquesCheckboxClicked:function(t){var o,i;return null==t&&(t={}),o={source:window.location.pathname,"current user type":PxCurrentUser.type,"referral url":document.referrer
},i=_.extend(o,t),e("Uploader - For Critiques Checkbox Clicked",i)}},statisticsEvent:{pageVisit:function(t,o){return e("Statistics Page Visit",{Source:o,"user type":t})},buttonClicked:function(t,o){return e("Statistics Button Click",{section:o,cta:t})},tabView:function(t,o){return e("Statistics - Section Tab View",{tab:t,section:o})},activityChartClick:function(t){return e("Statistics - Activity Chart Click",{tab:t})}},friendFinderEvent:{clickFollowUser:function(t){var o,i;return null==t&&(t={}),o={"user id":PxCurrentUser.id,"current user type":PxCurrentUser.type,"referral url":document.referrer},i=_.extend(o,t),e("Friend Finder - Follow Clicked",i)},clickFindFriends:function(t){var o,i;return null==t&&(t={}),o={"user id":PxCurrentUser.id,"current user type":PxCurrentUser.type,"referral url":document.referrer},i=_.extend(o,t),e("Friend Finder - Find Friends Clicked")}},profileCustomizeTabsEvent:{pageVisit:function(t,o){return e("Profile - Tabs Customize - page view",{source:o,"user type":t})},buttonClicked:function(t){return e("Profile - Tabs Customize - button click",{cta:t})}},discoverEvent:{popularSortClicked:function(t,o){return e("Discover - Popular - Sort",{key:t,order:o})},personalizationFilterClicked:function(t,o){return e("Discover - Categories - Personalization Filter",{checked:t,source:o})},followersFilterClicked:function(t,o){return e("Discover - Followers Filter",{source:t,filter:o})},newDiscoverCta:function(t,o){return e("Discover - New Discover - Button Clicked",{cta:t,ctaType:o})},photoStylesSubmitted:function(t){return e("Discover - For You - Photography Styles Saved",{categories:t})},photoStylesSettingsLinkClicked:function(t){return e("Discover - For You - Photo Styles Settings Link Clicked")},photoStylesModalSubmitted:function(t,o){return e("Discover - Photography Styles Modal - Saved",{type:t,categories:o})},photoStylesModalDismissed:function(t){return e("Discover - Photography Styles Modal - Dismissed",{type:t})}},onboardingEvent:{stepCompleted:function(t,o,i){var r;return r={step:t,skipped:o},null!=(null!=i?i.userData:void 0)&&null!=App.currentUser&&(r.firstnameChanged=i.userData.firstname!==App.currentUser.get("firstname"),r.lastnameChanged=i.userData.lastname!==App.currentUser.get("lastname"),r.usernameChanged=i.userData.username!==App.currentUser.get("username"),r.avatarChanged=null!=i.userData.avatarUrl),null!=(null!=i?i.selectedCategories:void 0)&&(r.selectedCategories=i.selectedCategories),null!=(null!=i?i.selectedGoals:void 0)&&(r.selectedGoals=i.selectedGoals),null!=(null!=i?i.membershipChosen:void 0)&&(r.membershipChosen=i.membershipChosen),e("Onboarding",r)}},loggedInHomeEvent:{joinChallengeClicked:function(t){return e("Logged In Home - Stats Challenge Joined",{section:t})},buttonClicked:function(t,o){return e("Logged In Home - button click",{cta:t,section:o})},popularCTARendered:function(t){return e("Logged In Home - End-of-feed Popular CTA Rendered",{previous_visit:t})},popularCTAClicked:function(t){return e("Logged In Home - End-of-feed Popular CTA Clicked",{previous_visit:t})}},loggedOutHomeEvent:{pageView:function(){return e("Logged Out Home - Page View",{source:window.location.pathname,"referral url":document.referrer})}},photoPageEvent:{buttonClicked:function(t,o){return e("Photo View - button click",{cta:t,section:o})}},photoRecommendationEvent:{photoLiked:function(t,o){var i;return i=o?"Following Feed Photo Recommendation - Like (recommended)":"Following Feed Photo Recommendation - Like (uploads)",e(i,{"photo id":t})},photoViewed:function(t,o){var i;return i=o?"Following Feed Photo Recommendation - View (recommended)":"Following Feed Photo Recommendation - View (uploads)",e(i,{"photo id":t})},followButtonClicked:function(t){return e("Following Feed Photo Recommendation - Follow Button Clicked",{"photo id":t})}},classesEvent:function(t,o,i,r){return null==i&&(i=""),null==r&&(r=""),e("Classes",{action:t,source:window.location.pathname,"page element":o,referrer:document.referrer,"class":i,state:r})}}}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},o=function(t,e){function o(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},i={}.hasOwnProperty;t=App.module("Views"),t.SignupLoginModal=function(t){function i(t){var o,r;null==t&&(t={}),this.signup=e(this.signup,this),this._toggleBuyerMode=e(this._toggleBuyerMode,this),null==this.behaviors&&(this.behaviors={}),o={isModalEnabled:!0},r=_.extend(o,t),this.isModalEnabled=r.isModalEnabled,this.isModalEnabled?this.behaviors.ModalDialog={closeButton:".unified_signup__close"}:delete this.behaviors.ModalDialog,i.__super__.constructor.apply(this,arguments)}return o(i,t),i.prototype.MIN_PASSWORD_LEN=6,i.prototype.MAX_PASSWORD_LEN=64,i.prototype.PRIME_UPDATE_USER_URL=PxApp.Constants.PRIME_URL+"/api/users",i.prototype.template="signup_login_modal",i.prototype.className=function(){return this.isModalEnabled?"signup_login_modal":"signup_login_full"},i.prototype.ui={tagLine:".unified_signup__h2",container:".unified_signup",form:".unified_signup__form",fields:".fields",email:"form input.email",password:"form input.password",emailLabel:"unified_signup__email_label",passwordLabel:"unified_signup__password_label",emailNotificationsField:".email_notifications.checkbox_input",submitButton:".unified_signup__submit_button",toggleSignup:"a.have_account",toggleLogin:"a.have_no_account",toggleBuyerMode:".buyer_mode.checkbox_input",buyerModeFields:".buyer_mode__container",socialLoginFields:".unified_signup__social",phone_number:"#phone_number",company:"#company"},i.prototype.events={"focus @ui.container .field":"_handleFieldFocus","submit @ui.form":"_submitForm","change @ui.toggleBuyerMode":"_toggleBuyerMode","click @ui.toggleSignup":"_toggleSignupLoginMode","click @ui.toggleLogin":"_toggleSignupLoginMode"},i.prototype.templateHelpers=function(){return{isSignupMode:this._isSignupMode(),oAuthAction:this._isSignupMode()?"signup":"login",isFullPage:!this.isModalEnabled,isUSUser:this._isUSUser()}},i.prototype.initialize=function(t){var e;return null==t&&(t={}),e={isSignupMode:!0,oauthRedirect:window.location.href},t=_.extend(e,t),this.isSignupMode=t.isSignupMode,this.oauthRedirect=t.oauthRedirect,this.userAction=t.userAction,this.translationKey=t.translationKey,this.shouldTrackPageVisit=t.shouldTrackPageVisit,null==this.translationKey&&(this.translationKey="default"),null==this.shouldTrackPageVisit&&(this.shouldTrackPageVisit=!0),this.errors={},this.isSignupMode&&this.shouldTrackPageVisit&&this.trackPageVisit(),window.submitWithCaptcha=this.signup},i.prototype._tidyEmailValue=function(){return $.trim(this.ui.email.val()).toLowerCase()},i.prototype._tidyPhoneNumber=function(){return $.trim(this.ui.phone_number.val())},i.prototype._tidyCompany=function(){return $.trim(this.ui.company.val())},i.prototype.trackPageVisit=function(){var t;return null!=(t=window.AmplitudeLogger)?t.signup.visitSignupPage(this.userAction):void 0},i.prototype._checkLoginExistence=function(){var t;return t=this._isSignupMode()?$.post(PxApp.Constants.API_URL+"/session/verify",{login:this._tidyEmailValue()}):$.when({sign_in:!0})},i.prototype._isEmailNotificationsChecked=function(){return this.ui.emailNotificationsField.prop("checked")},i.prototype._isUSUser=function(){return"US"===window.PxCurrentUser.ipCountryCode},i.prototype._isBuyerModeChecked=function(){return this.ui.toggleBuyerMode.prop("checked")},i.prototype._toggleBuyerMode=function(){var t,e;return this._isBuyerModeChecked()?(t=this.ui.submitButton.data("buyer"),this.ui.submitButton.val(t),this.ui.buyerModeFields.slideDown(200).removeClass("hide_me"),this.ui.socialLoginFields.slideUp(200).addClass("hide_me")):(e=this.ui.submitButton.data("normal"),this.ui.submitButton.val(e),this.ui.phone_number.val(""),this.ui.company.val(""),this.ui.buyerModeFields.slideUp(200).addClass("hide_me"),this.ui.socialLoginFields.slideDown(200).removeClass("hide_me")),!0},i.prototype._submitForm=function(t){return t.preventDefault(),this._lockFormFields(),this._checkLoginExistence().done(function(t){return function(e){return t._loginExists=!!e.sign_in,t._loginExists?t._tryLogin():t._validateAndSignup()}}(this)).fail(function(t){return function(e){return t._loginExists=!1,t._validateAndSignup()}}(this))},i.prototype._tryLogin=function(){var t;if(this._isSignupMode()||this._validateEmailAndPassword())return t=PxApp.api.post("/session",{session:{email:this._tidyEmailValue(),password:this.ui.password.val()}}),t.error(function(t){return function(e){var o,i,r;return t._isSignupMode()?t._validateAndSignup():(t._clearErrors(),4===e.readyState?(e.responseText&&(o=JSON.parse(e.responseText),(null!=o&&null!=(i=o.error)?i.email:void 0)&&(t.errors.email=t.ui.form.i18n("errors-email-not-found",{"return":!0})),(null!=o&&null!=(r=o.error)?r.password:void 0)&&(t.errors.password=t.ui.form.i18n("errors-password-incorrect",{"return":!0}))),t.errors.email||t.errors.password||(t.errors.other=t.ui.form.i18n("errors-server",{"return":!0}))):t.errors.other=t.ui.form.i18n("errors-connection",{"return":!0}),t._showErrors())}}(this)),t.success(function(t){return function(e){return App.currentUser=new App.Models.User(e.user),t.trigger("login:success"),t.isModalEnabled?t.destroyModal():void 0}}(this))},i.prototype._updateMarketplaceBuyerSettings=function(t,e){var o,i;return o={},t&&(o.company=t),e&&(o.phone=e),o.create_crm_lead=!0,i={method:"PUT",data:o},$.ajax(this.PRIME_UPDATE_USER_URL+"/"+App.currentUser.id,i)},i.prototype._postSignupActions=function(){return this.trigger("signup:success"),PxApp.GA.event({category:"Groups",action:"Signup"}),PxApp.GA.pageview("/signup/ga_success"),this.isModalEnabled?this.destroyModal():void 0},i.prototype._validateAndSignup=function(){var t;return null!=(t=window.AmplitudeLogger)&&t.signup.clickedSignup("Email","Web_Signup",this.userAction),this._validateEmailAndPassword()?"undefined"!=typeof grecaptcha&&null!==grecaptcha?(null==this.grecaptchaWidgetId&&(this.grecaptchaWidgetId=grecaptcha.render("recaptcha",{},!0)),grecaptcha.execute(this.grecaptchaWidgetId)):this.signup():void 0},i.prototype.signup=function(t){var e;return e=PxApp.api.post("/users",{email:this._tidyEmailValue(),password:this.ui.password.val(),auto_username:"yes",email_notifications_enabled:this._isEmailNotificationsChecked(),buyer_mode_enabled:this._isBuyerModeChecked(),phone_number:this._tidyPhoneNumber(),company:this._tidyCompany(),captcha_response:t}),e.success(function(t){return function(e){var o,i,r,n;return o=t._tidyCompany(),i=t._tidyPhoneNumber(),App.currentUser=new App.Models.User(e.user),n=t._isBuyerModeChecked()?"buyer":"photographer",null!=(r=window.AmplitudeLogger)&&r.signup.completedSignup(n,t.userAction),t._isBuyerModeChecked()?t._updateMarketplaceBuyerSettings(o,i).always(function(){return t._postSignupActions()}):t._postSignupActions()}}(this)),e.error(function(t){return function(e){var o,i,r;return"undefined"!=typeof grecaptcha&&null!==grecaptcha&&grecaptcha.reset(),t._clearErrors(),4===e.readyState?(e.responseText&&(o=JSON.parse(e.responseText),(null!=o&&null!=(i=o.error)?i.email:void 0)&&(/taken/.test(o.error.email[0])?t.errors.email=t.ui.form.i18n("errors-email-taken",{"return":!0}):t.errors.email=t.ui.emailLabel.text()+" "+o.error.email[0]),(null!=o&&null!=(r=o.error)?r.password:void 0)&&(t.errors.password=t.ui.passwordLabel.text()+" "+o.error.password[0])),t.errors.email||t.errors.password||(t.errors.other=t.ui.form.i18n("errors-server",{"return":!0}))):t.errors.other=t.ui.form.i18n("errors-connection",{"return":!0}),t._showErrors()}}(this))},i.prototype._handleOauthSuccess=function(t,e){var o;return e?(this._lockFormFields(),App.currentUser=new App.Models.User(e),null!=(o=App.currentUser)&&o.fetch(),e.was_created?this.trigger("signup:success"):this.trigger("login:success"),this.isModalEnabled?this.destroyModal():void 0):(this._clearErrors(),this.errors.other=this.ui.form.i18n("errors-oauth",{"return":!0}),this._showErrors())},i.prototype._handleOauthError=function(t){return this._clearErrors(),this.errors.other=this.ui.form.i18n("errors-oauth",{"return":!0}),this._showErrors()},i.prototype.onShow=function(){return this.ui.tagLine.i18n(this.translationKey.replace(/_/g,"-")),this.$("a[data-oauth-provider-login]").on("oauth:loggedIn",function(t){return function(e){return t._handleOauthSuccess(e.provider,e.user)}}(this)).on("oauth:loginFailed",function(t){return function(e){return t._handleOauthError(e.provider)}}(this)).on("oauth:loginCancelled",function(t){return function(e){return t._handleOauthError(e.provider)}}(this)),this.oauthRedirect&&this.$("a[data-oauth-provider-login]").data("oauth-redirect",this.oauthRedirect),this},i.prototype.resize=function(){return this.$el.width(400),this.trigger("resize")},i.prototype.onBeforeDestroyModal=function(){return"undefined"!=typeof grecaptcha&&null!==grecaptcha&&null!=this.grecaptchaWidgetId?grecaptcha.reset():void 0},i.prototype._validateEmailAndPassword=function(){return this._clearErrors(),this.errors.email=this._checkEmail(this.ui.email),this.errors.password=this._checkPassword(this.ui.password.val()),this.errors.email||this.errors.password?(this._showErrors(),!1):!0},i.prototype._clearErrors=function(){return this.errors={},this._markErrorElements(this.errors)},i.prototype._showErrors=function(){var t;return t=_.compact(_.values(this.errors)).join(" "),App.Flash.error(t),this._markErrorElements(this.errors),this.trigger("signup:error"),this._unlockFormFields()},i.prototype._checkEmail=function(t){var e;return t=this._tidyEmailValue(),e=this._isSignupMode(),""===t?e?this.ui.form.i18n("errors-email-empty",{"return":!0}):this.ui.form.i18n("errors-email-username-empty",{"return":!0}):e&&!this._isValidEmail(t)?this.ui.form.i18n("errors-email-invalid",{"return":!0}):void 0},i.prototype._isValidEmail=function(t){return PxApp.Constants.EMAIL_REGEXP.test(t)},i.prototype._checkPassword=function(t){var e;if(e=this._isSignupMode(),""===t)return this.ui.form.i18n("errors-password-empty",{"return":!0});if(e){if(t.length<this.MIN_PASSWORD_LEN)return this.ui.form.i18n("errors-password-too-short",{num:this.MIN_PASSWORD_LEN,"return":!0});if(t.length>this.MAX_PASSWORD_LEN)return this.ui.form.i18n("errors-password-too-long",{num:this.MAX_PASSWORD_LEN,"return":!0})}},i.prototype._isSignupMode=function(){return this.isSignupMode},i.prototype._getModeName=function(){return this._isSignupMode()?"Sign Up Form":"Log In Form"},i.prototype._toggleSignupLoginMode=function(){return this.isModalEnabled?(this.isSignupMode=!this.isSignupMode,this.render(),this.trigger("resize"),!1):!0},i.prototype._handleFieldFocus=function(t){return this.errors={},this._markErrorElements(this.errors)},i.prototype._lockFormFields=function(){return this.ui.container.addClass("loading"),this.$(".field").prop("disabled",!0)},i.prototype._unlockFormFields=function(){return this.ui.container.removeClass("loading"),this.$(".field").prop("disabled",!1)},i.prototype._markErrorElements=function(t){var e;return this.$("[data-field-for-error]").removeClass("error"),e=_.filter(_.keys(t),function(e){return null!=t[e]}),_.each(e,function(t){return this.$("[data-field-for-error="+t+"]").addClass("error")})},i}(Marionette.LayoutView)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},o=function(t,e){function o(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},i={}.hasOwnProperty;t=App.module("Behaviors"),t.IsDismissible=function(i){function r(){return this.dismiss=e(this.dismiss,this),r.__super__.constructor.apply(this,arguments)}return o(r,i),r.shouldShow=function(t,e){var o,i;if(o=t.$(".is_dismissible__should_show_"+e),!(o.length>0))throw new Error("IsDismissible behavior requires is_dismissible partial to be rendered in the view with matching name parameter");return!!o.data("should-show")&&!$.cookie("dismiss_tooltip_"+e+"_"+(null!=(i=App.currentUser)?i.id:void 0))},r.dismiss=function(t,e){return this.writeCookie(e),this.setShouldShowToFalse(t,e)},r.setShouldShowToFalse=function(t,e){return t.$(".is_dismissible__should_show_"+e).data("should-show",!1)},r.writeCookie=function(t){var e;return $.cookie("dismiss_tooltip_"+t+"_"+(null!=(e=App.currentUser)?e.id:void 0),1,{expires:365,path:"/"})},r.prototype.initialize=function(t){if(null==t&&(t={}),this.options=t,null==this.options.name)throw new Error("IsDismissible behavior requires name option");return this.dismissed=!1},r.prototype.onRender=function(){var e;return e=t.IsDismissible.shouldShow(this.view,this.options.name),this.view.dismiss=this.dismiss,this.view.dismissed=function(t){return function(){return t.dismissed}}(this),e?this.options.selector?(this.$dismissEl=this.view.$(this.options.selector),this.$dismissEl.on("click",function(t){return function(){return t.dismiss()}}(this))):void 0:this._hideView()},r.prototype.onDestroy=function(){var t;return null!=(t=this.$dismissEl)?t.off("click"):void 0},r.prototype.dismiss=function(){return t.IsDismissible.dismiss(this.view,this.options.name),this._hideView()},r.prototype._hideView=function(){return this.dismissed=!0,this.view.$el.hide()},r}(Marionette.Behavior)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Views"),t.PublicActionModal=function(o){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,o),i.prototype.template="public_action_modal",i.prototype.NAME="public_action",i.prototype.ui={confirm:".confirm",cancel:".cancel",noPopup:".checkbox"},i.prototype.events={"click @ui.noPopup":function(){return this.ui.noPopup.toggleClass("checked")}},i.prototype.behaviors={ModalDialog:{closeButton:".close",closeOnEsc:!0},IsDismissible:{name:i.prototype.NAME},HasButtons:{"@ui.confirm":"onClickConfirm","@ui.cancel":"onClickCancel"}},i.shouldShow=function(){var t;return(null!=(t=App.currentUser)?t.isBuyer():void 0)&&App.Behaviors.IsDismissible.shouldShow(window,this.prototype.NAME)},i.setShouldShowToFalse=function(){return App.Behaviors.IsDismissible.setShouldShowToFalse(window,this.prototype.NAME)},i.prototype.initialize=function(t){return null==t&&(t={}),this.callback=t.callback},i.prototype.onClickConfirm=function(){return this.ui.noPopup.hasClass("checked")&&(this.dismiss(),t.PublicActionModal.setShouldShowToFalse()),"function"==typeof this.callback&&this.callback(),this.destroyModal()},i.prototype.onClickCancel=function(){return this.destroyModal()},i.prototype.resize=function(){return this.$el.width(600),this.trigger("resize")},i}(Marionette.ItemView)}.call(this),function(){var t,e,o=function(t,e){function o(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},i={}.hasOwnProperty;e=App.module("Behaviors"),e.HasLikeButton=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return o(i,e),i.prototype.initialize=function(t){return null==t&&(t={}),this.options=t},i.prototype.onRender=function(){var e,o;if(this.view.$(".like-button").length>0)return null==this.view.likeButton&&this.view.addRegion("likeButton",".like-button"),o=$.isFunction(this.options.model)?this.options.model.call(this.view):this.view.model,e=new t({model:o,options:this.options,parentView:this.view}),this.view.likeButton.show(e)},i}(Marionette.Behavior),t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.template="like_button",e.prototype.ui={likeButton:".button"},e.prototype.behaviors={HasButtons:{"@ui.likeButton":"onClick"}},e.prototype.modelEvents={"change:liked":"render"},e.prototype.initialize=function(t){if(null==t&&(t={}),this.options=t.options,this.parentView=t.parentView,!$.isFunction(this.model.isOwner))throw new Error("Model does not define required function: isOwner()");if(!$.isFunction(this.model.getLikeState))throw new Error("Model does not define required function: getLikeState()");if(!$.isFunction(this.model.like))throw new Error("Model does not define required function: like()")},e.prototype.templateHelpers=function(){var t;return t={},this.options.withCount&&(t.count=this.model.getFormatLikeCount()),this.options.withMobileCount&&(t.count=this.model.getAbbreviateLikeCount()),t},e.prototype.onRender=function(){return this.options.withCount&&this.ui.likeButton.addClass("with_count"),null!=this.options["class"]&&this.ui.likeButton.addClass(this.options["class"]),this.model.isOwner()&&this.ui.likeButton.addClass("disabled"),this._changeState(this.model.getLikeState())},e.prototype.onClick=function(){var t;return null!=App.currentUser?!this.likeState&&App.Views.PublicActionModal.shouldShow()?(t=new App.Views.PublicActionModal({callback:function(t){return function(){return t._toggleLike()}}(this)}),t.showModal()):this._toggleLike():this._handleVisitor()},e.prototype._handleVisitor=function(){var t,e,o,i;return this.parentView.trigger("like:signup"),e=App.Helpers.deviceType(),/^ip/.test(e)?(t="px://500px.com/photo/"+this.model.id,i=App.Helpers.appLink(e),App.Helpers.openOrDownloadApp(t,i)):/^android/.test(e)?window.location=App.Helpers.appLink(e):(o=new App.Views.SignupLoginModal({userAction:"photos_like"}),this.listenToOnce(o,"signup:success login:success",function(t){return function(){return t.model.like(function(t,e){return window.location.reload()})}}(this)),o.showModal())},e.prototype._toggleLike=function(){var t;return t=this.likeState===!1?"like":"unlike",this.parentView.trigger("like:before"),this.model[t].call(this.model,function(t){return function(e,o){return e?(App.Flash.error(App.Helpers.API.getErrorMessage(e)),t.parentView.trigger("like:before")):(t._changeState(o),t.parentView.trigger("like:after",o))}}(this))},e.prototype._changeState=function(t){return this.isDestroyed?void 0:(this.likeState=t,this.ui.likeButton.toggleClass("hearted",this.likeState))},e}(Marionette.ItemView)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Behaviors"),t.HasButtons=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.initialize=function(){var t,e,o,i,r;null==(t=this.view).events&&(t.events={}),this.options=this.view.normalizeUIKeys(this.options),e=this.options,o=[];for(i in e)r=e[i],o.push(function(t){return function(e,o){return t.bindClickEvent(e,o)}}(this)(i,r));return o},o.prototype.bindClickEvent=function(t,e){var o,i,r;return i=this,null!=(o=this.view.events)[r="click "+t]?o[r]:o[r]=function(o){var r,n,s,a,l,u,p,c,h;return h=this,a=i._extractOptions(h,e),"#"!==$(o.target).attr("href")&&(o.metaKey||o.ctrlKey||o.shiftKey)?void 0:(r=h.$(t),n=null!=(l=a.disabledClass)?l:"disabled",s=null!=(u=a.loadingClass)?u:"loading",r.hasClass(n)||r.is(":disabled")?i._stopEvent(o,a):i._confirmClick(h,r,o,a)?(p=a.fn.call(h,o),p===!0?!0:(c=i._stopEvent(o,a),$.isFunction(null!=p?p.always:void 0)&&(r.addClass("disabled loading"),p.always(function(){return r.removeClass("disabled loading")})),c)):i._stopEvent(o,a))}},o.prototype._extractOptions=function(t,e){var o;if(o={},$.isPlainObject(e)){if(o=e,null!=e.trigger?o.fn=function(o){return function(){return t.trigger(e.trigger)}}(this):!$.isFunction(o.fn)&&$.isFunction(t[o.fn])&&(o.fn=t[o.fn]),!$.isFunction(o.fn))throw new Error("No callback function specified")}else if($.isFunction(e))o={fn:e};else{if(!$.isFunction(t[e]))throw console.error(e),new Error("HasButton doesn't know how to use this value: "+e);o={fn:t[e]}}return o},o.prototype._stopEvent=function(t,e){if(null==e.stopEvent&&(e.stopEvent=!0),e.stopEvent===!0)return t.preventDefault(),!1;if(t[e.stopEvent]===!1)return!0;if(t[e.stopEvent])return t[e.stopEvent]();throw new Error("Unknown HasButtons value for stopEvent: "+option.stopEvent)},o.prototype._confirmClick=function(t,e,o,i){var r,n,s;return r=null!=(n=i.confirm)?n:e.data("confirm"),null!=r&&r!==!1?$.isFunction(r)?(s=r.apply(t),_.isString(s)?window.confirm(s):s):window.confirm(r):!0},o}(Marionette.Behavior)}.call(this),function(){var t,e,o=function(t,e){function o(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},i={}.hasOwnProperty;e=App.module("Behaviors"),t=$(window),e.HasQTipPopovers=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return o(i,e),i.prototype._extractOptions=function(t,e){var o,r;if($.isPlainObject(e))r=_.omit(e,["trigger","fn"]),o=_.omit(r,["popover"]);else if($.isFunction(e))r={popover:e},o={};else{if(!$.isFunction(t[e]))throw new Error("HasQTipPopovers doesn't know how to use hashed value: "+e);r={popover:t[e]},o={}}if(r.view=t,null==r.popover)throw new Error("HasQTipPopovers cannot find popover function");return o.fn=_.partial(this._popoverGenerator,_,r),i.__super__._extractOptions.call(this,t,o)},i.prototype._popoverGenerator=function(e,o){var i,r,n,s,a,l;return n=$(e.target),s=o.classPrefix,r=$("<div></div>").addClass("popover").hide(),i=$("<div></div>").addClass("contain"),r.append(i),null!=s&&(r.addClass(s+"__container"),i.addClass(s+"__composite")),a={overwrite:!1,style:{def:!1,classes:"px_popover "+s,tip:{width:20,height:10}},position:{my:"left center",at:"right center",viewport:t,effect:!1,adjust:{method:"flipinvert shift"}},show:{event:e.type,delay:0,ready:!0},hide:{delay:0,event:"click unfocus"},events:{render:function(t){return function(e,r){var n;return t.$el.addClass("active"),n=o.popover.call(o.view,i,r),n.render()}}(this),show:function(e,i){return t.one("scroll resize",function(){return i.hide()}),o.view.trigger("HasQTipPopovers:show",i)},hide:function(t){return function(e,i){return t.$el.removeClass("active"),o.view.trigger("HasQTipPopovers:hide",i),i.destroy()}}(this)}},null!=o.position&&_.extend(a.position,_.omit(o.position,"effect")),l=_.defaults({content:r},a),n.qtip(l,e),!1},i}(App.Behaviors.HasButtons)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Behaviors"),t.HasTooltips=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.defaults={style:""},o.prototype.onRender=function(){var t,e,o,i,r,n;for(r=this.$(".px_tooltip"),n=[],o=0,i=r.length;i>o;o++)e=r[o],t=$(e),n.push(t.qtip({content:t.find(".px_tooltip__content"),style:{classes:"px_tooltip__container "+this.options.style,tip:{width:14,height:8}},position:{my:"top center",at:"bottom center"},hide:{fixed:!0,delay:300}}));return n},o}(Marionette.Behavior)}.call(this),function(){var t,e,o,i=function(t,e){function o(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},r={}.hasOwnProperty;o=App.module("Behaviors"),t=$(window),o.HasExtraActionsDropdown=function(o){function r(){return r.__super__.constructor.apply(this,arguments)}return i(r,o),r.prototype.onRender=function(){var t,e,o,i;this.dropdowns={},e=this.options,i=[];for(o in e)t=e[o],i.push(this._createExtraActionDropdown(o,t));return i},r.prototype._createExtraActionDropdown=function(o,i){var r,n,s,a,l,u,p,c,h,d,g,f,m;if(g=this.view[o],null==g)throw new Error("Cannot find region "+o);if(n=this.view.$(g.el),n.data("i18n-button-default")&&(s=n.i18n("button-default",{"return":!0})),m=_.extend(_.clone(i),{buttonText:s}),f=new e(m),g.show(f),h={style:{classes:"extra-actions-qtip-dropdown",def:!1,tip:{width:20,height:10}},position:{my:"top center",at:"bottom center",viewport:$(window),effect:!1,adjust:{method:"flipinvert",y:3}},show:{delay:0,event:"click"},hide:{delay:0,event:"click unfocus"},events:{show:function(e){return function(){return f.$el.addClass("active"),e.trigger("extraActionsDropdown:show",e,o),t.one("scroll",function(){var t,i;return null!=(t=e.dropdowns)&&null!=(i=t[o])?i.qtipApi.hide():void 0}),t.one("resize",function(){var t,i;return null!=(t=e.dropdowns)&&null!=(i=t[o])?i.qtipApi.hide():void 0})}}(this),hide:function(t){return function(){return f.$el.removeClass("active"),t.trigger("extraActionsDropdown:hide",t,o)}}(this)}},$.fn.qtip.zindex=100100,p=f.ui.button.qtip(_.defaults({content:f.$(".extra-actions-dropdown-container").hide()},h)),c=p.qtip("api"),u=$.isFunction(i.dropdownViewClass)?i.dropdownViewClass.call(this.view):i.dropdownViewClass,a=null!=(d=i.compactList)?d:!0,l=new u({model:this.view.model,qtipApi:c,compactList:a}),!$.isFunction(l.handleAction))throw new Error("The implementation of handleAction cannot be found in "+i.dropdownViewClass.name);return l.render(),r=f.$(".extra-actions-dropdown-composite"),a?r.addClass("compact"):r.addClass("list"),r.append(l.$el.addClass("clearfix inside")),this.dropdowns[o]={dropdownView:l,qtipApi:c},l},r.prototype.onDestroy=function(){var t,e,o,i,r;e=this.dropdowns;for(t in e)r=e[t],null!=(o=r.qtipApi)&&o.destroy(!0),null!=(i=r.dropdownView)&&i.destroy();return this.dropdowns=null},r}(Marionette.Behavior),o.HasExtraActionsDropdown.DropdownBase=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.events={"click .extra-action":"_internalHandleAction"},e.prototype.initialize=function(t){return this.qtipApi=t.qtipApi,this.compactList=t.compactList,t},e.prototype._internalHandleAction=function(t){var e,o;if(t.preventDefault(),e=$(t.target).closest(".extra-action"),!e.hasClass("disabled")){if(o=null!=e?e.data("action"):void 0,!o)throw new Error("The action name cannot be found");return this.handleAction(e.data("action"),e),this.qtipApi.hide()}},e}(Marionette.LayoutView),e=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.template="extra_actions_widget",e.prototype.className="extra-actions-widget",e.prototype.ui={button:".extra-actions-button"},e.prototype.initialize=function(t){return null==t&&(t={}),this.buttonClass=t.buttonClass,this.buttonText=t.buttonText,null!=this.buttonClass?this.buttonClass:this.buttonClass="more"},e.prototype.onRender=function(){return this.ui.button.addClass(this.buttonClass),this.buttonText?this.ui.button.text(this.buttonText):void 0},e}(Marionette.ItemView)}.call(this),function(){var t;t=App.module("Helpers"),t.StatsTracking=function(){function t(){}return t.TRACKING_SOURCES={following:"following",fresh:"fresh",upcoming:"upcoming",editors:"editors",popular:"popular","stock-photos":"marketplace",discover:"discover",places:"places","trending-places":"places","trending-place":"places",geohash:"places",search:"search",activity:"activity",gallery:"galleries",profile:"profile",user:"profile",quest_entries:"other",quest_winners:"other",facebook:"facebook",twitter:"twitter","t.co":"twitter",groups:"other","class":"class",other:"other",photoPage:"photo_page"},t.EXTERNAL_TRACKING_SOURCES=["facebook","twitter","t.co"],t.trackRecommendedPhotos=function(t){return $.ajax({type:"POST",url:PxApp.Constants.API_URL+"/photos/track_recommended_photos",dataType:"json",contentType:"application/json",data:JSON.stringify(t)})},t.trackProfile=function(t,e,o){return t?this.track("profile",t,e,o):void 0},t.trackPhoto=function(t,e,o){return t&&e?this.track("photo",t,e,o):void 0},t.track=function(t,e,o,i){var r,n;return null==this.trackedViews&&(this.trackedViews={}),null==(r=this.trackedViews)[t]&&(r[t]={}),null==this.trackingQueue&&(this.trackingQueue=[]),n={object_type:t,object_id:e},null!=o&&(n.source=o),null!=i&&(n.metadata=i),this.trackedViews[t][e]||(this.trackingQueue.push(n),this.trackedViews[t][e]={}),this.trackedViews[t][e][o]=!0,null==this.trackViews&&(this.trackViews=_.throttle(this._submitTrackingQueue,5e3)),this.trackingQueue.length>0?this.trackViews():void 0},t.viewedPhotoIds=function(t){var e,o;return null==t&&(t={}),o=t.source,(null!=(e=this.trackedViews)?e.photo:void 0)?o?_.reduce(this.trackedViews.photo,function(t,e,i){return e[o]&&t.push(i),t},[]):_.keys(this.trackedViews.photo):[]},t._submitTrackingQueue=function(){var t;return t={views:this.trackingQueue},this.trackingQueue=[],$.ajax({type:"POST",url:PxApp.Constants.API_URL+"/stats/track",dataType:"json",contentType:"application/json",data:JSON.stringify(t)})},t}()}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,
t},o={}.hasOwnProperty;t=App.module("Models"),t.Gallery=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.modelName="App.Models.Gallery",o.prototype.isEmpty=function(){return 0===this.get("items_count")},o.prototype.containsOwnerPhotosOnly=function(){var t;return(t=this.get("kind"))===PxApp.Constants.GALLERY_KINDS.KIND_PROFILE||t===PxApp.Constants.GALLERY_KINDS.KIND_PORTFOLIO||t===PxApp.Constants.GALLERY_KINDS.KIND_CRITIQUE},o.prototype.isPrivate=function(){return this.get("privacy")},o.prototype.isCritique=function(){return this.get("kind")===PxApp.Constants.GALLERY_KINDS.KIND_CRITIQUE},o.prototype.markPhotoMembership=function(t,e){return null==e&&(e={}),null==this._memberPhotoIds&&(this._memberPhotoIds={}),this._memberPhotoIds[t]=!0,e.silent?void 0:this.trigger("change:photoMembership",t,!0)},o.prototype.containsPhoto=function(t){return null==this._memberPhotoIds&&(this._memberPhotoIds={}),t.id in this._memberPhotoIds},o.prototype.getCoverPhotoId=function(){var t;return null!=(t=this.getCoverPhoto())?t.id:void 0},o.prototype.getCoverPhoto=function(){var t;return null!=(t=this.get("cover_photo"))?t[0]:void 0},o.prototype.setCover=function(t){var e;return e={_method:"put",cover_photo_id:t,cover_size:2048},$.post(PxApp.Constants.API_URL+"/users/"+this.get("user_id")+"/galleries/"+this.get("id"),e).done(function(t){return function(e){return t.set("cover_photo",e.gallery.cover_photo)}}(this))},o.prototype.addPhotos=function(t){var e,o;return o={_method:"put",add:{photos:function(){var o,i,r;for(r=[],o=0,i=t.length;i>o;o++)e=t[o],r.push(e.id);return r}()}},$.post(PxApp.Constants.API_URL+"/users/"+this.get("user_id")+"/galleries/"+this.get("id")+"/items",o).done(function(o){return function(i){var r,n,s;for(r=0,n=t.length;n>r;r++)e=t[r],"added"===(null!=(s=i[e.id])?s.result:void 0)&&(null==o._memberPhotoIds&&(o._memberPhotoIds={}),o._memberPhotoIds[e.id]=!0,o.trigger("change:photoMembership",e.id,!0),o._lastAddedPhotoHistory=_.reject(o._lastAddedPhotoHistory,function(t){return t.id===e.id}),o._lastAddedPhotoHistory.push(e));return o.set("updated_at",(new Date).toISOString())}}(this))},o.prototype.removePhotos=function(t){var e,o;return o={_method:"put",remove:{photos:function(){var o,i,r;for(r=[],o=0,i=t.length;i>o;o++)e=t[o],r.push(e.id);return r}()}},$.post(PxApp.Constants.API_URL+"/users/"+this.get("user_id")+"/galleries/"+this.get("id")+"/items",o).done(function(o){return function(i){var r,n,s;for(r=0,n=t.length;n>r;r++)e=t[r],"removed"===(null!=(s=i[e.id])?s.result:void 0)&&(null==o._memberPhotoIds&&(o._memberPhotoIds={}),delete o._memberPhotoIds[e.id],o.trigger("change:photoMembership",e.id,!1),o.set("items_count",o.get("items_count")-1),o._lastAddedPhotoHistory=_.reject(o._lastAddedPhotoHistory,function(t){return t.id===e.id}));return o.set("updated_at",(new Date).toISOString())}}(this))},o.prototype.getLastAddedPhoto=function(){var t;return null==this._lastAddedPhotoHistory&&(this._lastAddedPhotoHistory=[],t=this.get("last_added_photo"),null!=t&&this._lastAddedPhotoHistory.push(new App.Models.Photo(t))),_.last(this._lastAddedPhotoHistory)},o.prototype.getPrivateShareUrl=function(){return null==this.privateUrlDfd&&(this.privateUrlDfd=$.Deferred(),$.get(PxApp.Constants.API_URL+"/users/"+this.get("user_id")+"/galleries/"+this.get("id")+"/share_url").done(function(t){return function(e){return t.privateUrlDfd.resolve(PxApp.Constants.MAIN_500PX_URL+"/"+e.share_url)}}(this)).fail(function(t){return function(e,o,i){var r;return(r=t.privateUrlDfd).reject.apply(r,arguments)}}(this))),this.privateUrlDfd.promise()},o.prototype.getCanonicalPath=function(){var t,e,o,i;return this.isPrivate()?"/g/"+this.get("token"):(e=null!=(t=this.galleryPath)?t:this.get("custom_path"),null==e&&(e=this.id),o=this.get("user"),i=_.isFunction(o.get)?o.get("username"):o.username,"/"+i+"/galleries/"+e)},o.prototype.getCanonicalUrl=function(){var t;return t=this.getCanonicalPath(),""+PxApp.Constants.MAIN_500PX_URL+t},o.prototype.getUrl=function(){var t,e;return t=this.get("user"),e=_.isFunction(t.get)?t.get("username"):t.username,PxApp.Constants.MAIN_500PX_URL+"/"+e+"/galleries/"+this.get("custom_path")},o.prototype.isOwnedByCurrentUser=function(){var t;return this.get("user_id")===(null!=(t=App.currentUser)?t.get("id"):void 0)},o.prototype.getApiIdentifier=function(){var t;return t=this.isPrivate()&&!this.isOwnedByCurrentUser()?this.galleryPath:this.id},o.prototype.getOwnerID=function(){return this.get("user_id")},o.prototype.share=function(t,e){return null==this.popup&&(this.popup=new App.Lib.Sharelizer({url:this.getCanonicalUrl(),category:"Gallery Page"})),this[t](e)},o.prototype.google=function(t){return this.popup.google()},o.prototype.facebook=function(t){return this.popup.facebook()},o.prototype.vk=function(t){return this.popup.vk()},o.prototype._pinterestShareData=function(){var t;return{media:null!=(t=this.get("cover_photo"))?t[0].url:void 0,description:this.get("description")}},o.prototype.pinterest=function(t){var e;if(e=this._pinterestShareData(),!e.media)throw"This view doesn't know how to share with pinterest";return this.popup.pinterest(e.media,e.description)},o.prototype._twitterShareData=function(){return{text:'Gallery "'+this.get("name")+'" by '+this.get("user").fullname+" #500px"}},o.prototype.twitter=function(t){var e;if(e=this._twitterShareData(),!e.text)throw"This view doesn't know how to share with twitter";return this.popup.twitter(e.text)},o.prototype._stumbleuponShareData=function(){return{title:'Gallery "'+this.get("name")+'" by '+this.get("user").fullname+" #500px"}},o.prototype.stumbleupon=function(t){var e;if(e=this._stumbleuponShareData(),!e.title)throw"This view doesn't know how to share with StumbleUpon";return this.popup.stumbleupon(e)},o.prototype.isFeatured=function(){return!!this.get("editors_choice")},o.prototype.feature=function(){var t,e;if(!App.currentUser)throw new Error("feature requires current user");if(this.isFeatured())throw new Error("gallery is already featured");return e=PxApp.Constants.API_URL+"/users/"+this.userId+"/galleries/"+this.galleryPath+"/editors_choice/add",t={method:"PUT"},$.ajax(e,t).done(function(t){return function(){return t.set({editors_choice:!0})}}(this))},o.prototype.unfeature=function(){var t,e;if(!App.currentUser)throw new Error("feature requires current user");if(!this.isFeatured())throw new Error("gallery is not featured");return e=PxApp.Constants.API_URL+"/users/"+this.userId+"/galleries/"+this.galleryPath+"/editors_choice/remove",t={method:"PUT"},$.ajax(e,t).done(function(t){return function(){return t.set({editors_choice:!1})}}(this))},o.prototype.reportContent=function(t,e){var o,i,r;return null==e&&(e=""),o=this.getApiIdentifier(),r=PxApp.Constants.API_URL+"/users/"+this.userId+"/galleries/"+o+"/report",i={reason:t},0===Number(t)&&(i.reason_details=e),$.post(r,i).done(function(e){return function(){return e.trigger("contentReported",t)}}(this))},o}(Backbone.Model)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty,i=[].slice;t=App.module("Collections"),t.MyGalleries=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.rpp=20,o.prototype.model=App.Models.Gallery,o.prototype.comparator=function(t){return-Date.parse(t.get("updated_at"))},o.prototype.url=function(){var t;return t={privacy:"both",include_cover:1,cover_size:3,include_last_added:!0,sort:"last_added_to_at",sort_direction:"desc",kinds:"0,1,2,4,5"},PxApp.Constants.API_URL+"/users/"+App.currentUser.id+"/galleries?"+$.param(t)},o.prototype.initialize=function(t,e){if(null==e&&(e={}),o.__super__.initialize.apply(this,arguments),this.on("add",this.onModelAdded),null==App.currentUser)throw new Error("Cannot find currentUser")},o.prototype.reconcileMembershipOfPhoto=function(t){return this._loadMembershipOfPhoto(t)},o.prototype._loadMembershipOfPhoto=function(t,e){var o,r,n,s,a;if(null==e&&(e=1),1===e){null!=(s=this._pendingReconciliationXhr)&&s.abort(),null==this._notLoadedGalleriesInfo&&(this._notLoadedGalleriesInfo={}),a=this._notLoadedGalleriesInfo;for(o in a)r=a[o],delete r[t]}return n={sort:"updated_at",sort_direction:"desc",user_id:App.currentUser.id,rpp:1e3},this._pendingReconciliationXhr=$.get(PxApp.Constants.API_URL+"/photos/"+t+"/galleries?"+$.param(n)).done(function(o){return function(i){var r,n,s,a,l,u;for(o._pendingReconciliationXhr=null,u=i.galleries,a=0,l=u.length;l>a;a++)n=u[a],s=n.id,n=o.findWhere({id:s}),null!=n?n.markPhotoMembership(t):(null==(r=o._notLoadedGalleriesInfo)[s]&&(r[s]={}),o._notLoadedGalleriesInfo[s][t]=!0);return e<i.total_pages?o._loadMembershipOfPhoto(t,e+1):void 0}}(this)).fail(function(t){return function(e,o,r){return"abort"!==o?t.trigger.apply(t,["error:reconcileMembershipOfPhoto"].concat(i.call(arguments))):void 0}}(this))},o.prototype.onModelAdded=function(t){var e,o,i,r;if(e=null!=(i=this._notLoadedGalleriesInfo)?i[t.id]:void 0,null!=e){for(o in e)r=e[o],t.markPhotoMembership(o);return delete this._notLoadedGalleriesInfo[t.id]}},o.prototype.parse=function(t){var e,i,r,n,s;for(s=null!=(n=null!=t?t.galleries:void 0)?n:[],i=0,r=s.length;r>i;i++)e=s[i],e.user=App.currentUser.toJSON();return o.__super__.parse.call(this,t)},o}(App.Collections.InfiniteCollection)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Galleries.Models"),t.Gallery=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.initialize=function(t){return null==t&&(t={}),this.userId=t.userId,this.galleryPath=t.galleryPath},o.prototype.url=function(){var t,e;return t={include_user:!0,include_cover:1,cover_size:2048},e=PxApp.Constants.API_URL+"/users/"+this.userId+"/galleries",null!=this.galleryPath&&(e+="/"+this.galleryPath),e+"?"+$.param(t)},o.prototype.parse=function(t){return t.gallery},o}(App.Models.Gallery)}.call(this),function(){var t,e,o=function(t,e){return function(){return t.apply(e,arguments)}},i=function(t,e){function o(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},r={}.hasOwnProperty;e=App.module("Behaviors"),t=$(window),e.IsPopover=function(e){function r(){return this.dismiss=o(this.dismiss,this),this.showPopover=o(this.showPopover,this),r.__super__.constructor.apply(this,arguments)}return i(r,e),r.prototype.initialize=function(t){if(this.classPrefix=t.classPrefix,null==this.classPrefix)throw new Error("must provide classPrefix");return this.view.dismiss=this.dismiss,this.view.showPopover=this.showPopover},r.prototype.showPopover=function(e,o){var i,r,n,s,a;if(null==o&&(o={}),null==e)throw new Error("View creator must provide event");return r=$("<div></div>").addClass("popover "+this.classPrefix+"__container").hide(),i=$("<div></div>").addClass("contain "+this.classPrefix+"__composite"),r.append(i),s={overwrite:!1,style:{def:!1,classes:"px_popover "+this.classPrefix,tip:{width:20,height:10}},position:{my:"left center",at:"right center",viewport:t,effect:!1,adjust:{method:"flipinvert shift"}},show:{event:e.type,delay:0,ready:!0},hide:{delay:0,event:"click unfocus"},events:{render:function(t){return function(e,o){return t.view.setElement(i),t.view.render()}}(this),show:function(e){return function(o,i){return t.one("scroll resize",function(){return i.hide()}),e.view.trigger("IsPopover:show",i)}}(this),hide:function(t){return function(e,o){return t.view.trigger("IsPopover:hide",o),t.qtipApi=null,o.destroy()}}(this)}},null!=o.position&&_.extend(s.position,o.position),null!=o.hide&&_.extend(s.hide,o.hide),n=$(o.target||e.target),a=_.defaults({content:r},s),this.qtipApi=n.qtip(a,e).qtip("api")},r.prototype.dismiss=function(){var t;return null!=(t=this.qtipApi)?t.hide():void 0},r}(Marionette.Behavior)}.call(this),function(){var t,e,o,i,r=function(t,e){function o(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},n={}.hasOwnProperty;i=App.module("Views"),t=$(window),e=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.template="add_to_galleries_popover_empty",e.prototype.className="add_to_galleries_popover_empty",e}(Marionette.ItemView),o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.template="add_to_galleries_popover_item",e.prototype.tagName="li",e.prototype.className="add_to_galleries_popover__item",e.prototype.ui={thumbnail:".add_to_galleries_popover_item__thumbnail",checkbox:".add_to_galleries_popover_item__checkmark",popoverItem:".add_to_galleries_popover_item__wrap"},e.prototype.triggers={"click @ui.popoverItem":"clicked"},e.prototype.modelEvents={"change:photoMembership":"_updateCheckmark"},e.prototype.onRender=function(){return this._updateCheckmark()},e.prototype._updateCheckmark=function(){var t,e,o,i,r,n,s;if(this.model.isNew())t=!0,e=!1;else if(this.options.photos)for(t=!0,e=!1,s=this.options.photos,i=0,r=s.length;r>i;i++)n=s[i],this.model.containsPhoto(n)?e=!0:t=!1;else this.options.batchEditablePhoto&&(o=this.options.batchEditablePhoto.checkGalleryMembership(this.model),t=o.containsAllPhotos,e=o.containsSomePhotos);return t?this.select():e?this.selectPartial():this.unselect()},e.prototype.templateHelpers=function(){var t;return{thumbUrl:null!=(t=this.model.getLastAddedPhoto())?t.getImagePath({size:1}):void 0,galleryUrl:this.model.getCanonicalUrl()}},e.prototype.toggleCheckmark=function(){return this._checked=this._partiallyChecked?!0:!this._checked,this._partiallyChecked=!1,this.ui.thumbnail.toggleClass("add_to_galleries_popover_item__thumbnail--checked",this._checked),this.ui.checkbox.toggleClass("add_to_galleries_popover_item__checkmark--checked",this._checked),this.ui.checkbox.removeClass("add_to_galleries_popover_item__checkmark--partial_checked")},e.prototype.selected=function(){return this._checked},e.prototype.select=function(){return this._checked=!0,this._partiallyChecked=!1,this.ui.thumbnail.addClass("add_to_galleries_popover_item__thumbnail--checked"),this.ui.checkbox.addClass("add_to_galleries_popover_item__checkmark--checked")},e.prototype.selectPartial=function(){return this._checked=!0,this._partiallyChecked=!0,this.ui.thumbnail.addClass("add_to_galleries_popover_item__thumbnail--checked"),this.ui.checkbox.addClass("add_to_galleries_popover_item__checkmark--partial_checked")},e.prototype.unselect=function(){return this._checked=!1,this._partiallyChecked=!1,this.ui.thumbnail.removeClass("add_to_galleries_popover_item__thumbnail--checked"),this.ui.checkbox.removeClass("add_to_galleries_popover_item__checkmark--checked"),this.ui.checkbox.removeClass("add_to_galleries_popover_item__checkmark--partial_checked")},e}(Marionette.ItemView),i.AddToGalleriesPopover=function(t){function i(t){null==t&&(t={}),null==App.myGalleries&&(App.myGalleries=new App.Collections.MyGalleries([])),App.myGalleries.sort(),t.collection=App.myGalleries,i.__super__.constructor.call(this,t)}return r(i,t),i.prototype.template="add_to_galleries_popover",i.prototype.childViewContainer="ul",i.prototype.childView=o,i.prototype.emptyView=e,i.prototype.childViewOptions=function(){return{batchEditablePhoto:this.batchEditablePhoto,photos:this.photos}},i.prototype.behaviors={InfiniteScroll:{container:function(){return this.ui.list}},HasButtons:{"@ui.createButton":"onCreateButtonClicked"},IsPopover:{classPrefix:"add_to_galleries_popover"}},i.prototype.ui={title:".add_to_galleries_popover__create_gallery__title",closeButton:".add_to_galleries_popover__close_button",createIcon:".add_to_galleries_popover__create_icon",createInput:".add_to_galleries_popover__title_input",createSection:".add_to_galleries_popover__create_section",privacyCheckbox:".add_to_galleries_popover__checkbox",createButton:".add_to_galleries_popover__create_button",list:".add_to_galleries_popover__galleries_list.scroll"},i.prototype.events={"click @ui.closeButton":"onClickClose","click @ui.createIcon":"onCreateIconClicked","click @ui.createInput":function(){return this.toggleCreateSection(!0)},"input @ui.createInput":function(){return this.toggleCreateSection(!0)},"click @ui.privacyCheckbox":function(){return this.ui.privacyCheckbox.toggleClass("checked")},keyup:"onKeyup"},i.prototype.onClickClose=function(){return this.dismiss()},i.prototype.onCreateIconClicked=function(){return this.toggleCreateSection(!0),this.ui.createInput.focus()},i.prototype.onCreateButtonClicked=function(){var t,e,o,i;return e=(null!=(i=App.currentUser)?i.isBuyer():void 0)?!0:this.ui.privacyCheckbox.hasClass("checked"),t={userId:App.currentUser.id,name:this._getNewTitle(),privacy:e,kind:PxApp.Constants.GALLERY_KINDS.KIND_GENERAL,auto_path:!0},o=new App.Galleries.Models.Gallery(t),o.save().done(function(t){return function(e){return o.set({user:App.currentUser.toJSON()},{silent:!0}),t.toggleCreateSection(!1),t._toggleGalleryMembership(o,!0),App.myGalleries.add(o,{at:0})}}(this)).fail(function(t){return function(){var e,o;return e=(o=App.Helpers.API).parseError.apply(o,arguments),App.Flash.error(App.Helpers.API.getErrorMessage(e)),t.ui.createInput.focus()}}(this))},i.prototype.toggleCreateSection=function(t){return this.createMode=t,this.ui.createSection.toggleClass("add_to_galleries_popover__create_section--active",t),t||this.ui.createInput.val(""),this._updateCreateButton(),this.ui.list.height(this.$(".inside").innerHeight()-this.ui.title.outerHeight()-this.ui.createInput.outerHeight()-2-(t?111:0))},i.prototype._updateCreateButton=function(){return this.ui.createButton.toggleClass("disabled",this._getNewTitle().length<1)},i.prototype._getNewTitle=function(){return $.trim(this.ui.createInput.val())},i.prototype.initialize=function(t){var e;if(this.kind=t.kind,this.batchEditablePhoto=t.batchEditablePhoto,this.photos=t.photos,"gallery"!==(e=this.kind)&&"portfolio"!==e&&"profile"!==e)throw new Error("Incorrect kind: "+this.kind);if(null!=this.batchEditablePhoto){if(null!=this.photos)throw new Error("photos should not be used in batch editing mode")}else if(!(null!=this.photos&&this.photos.length>0))throw new Error("photos are missing");return this.createMode=!1,this._checkMembership()},i.prototype._checkMembership=function(){var t,e,o,i;if(null!=this.photos)for(i=this.photos,t=0,e=i.length;e>t;t++)o=i[t],this.collection.reconcileMembershipOfPhoto(o.id);else this.batchEditablePhoto.reconcileGalleryMemberships(this.collection);return this.listenTo(this.collection,"error:reconcileMembershipOfPhoto",function(t){return function(){var t,e;return t=(e=App.Helpers.API).parseError.apply(e,arguments),App.Flash.error(App.Helpers.API.getErrorMessage(t))}}(this))},i.prototype.onKeyup=function(t){var e;switch(t.which){case 27:return this.createMode?this.ui.createInput.val()?(e=this.ui.list.i18n("messages-abort-creation",{"return":!0}),confirm(e)?this.toggleCreateSection(!1):this.ui.createInput.focus()):this.toggleCreateSection(!1):this.dismiss();case 13:if(this.createMode&&!this.ui.createButton.hasClass("disabled"))return this.onCreateButtonClicked()}},i.prototype.onRender=function(){return null==this.collection.totalPages&&this.collection.fetch(),this.ui.title.i18n("galleries",{count:1}),this.ui.createInput.attr("placeholder",this.ui.createInput.i18n(this.kind,{"return":!0})),this.ui.list.scrollLock("on",null,!0),_.defer(function(t){return function(){return t.ui.createInput.focus(),t.toggleCreateSection(!1)}}(this))},i.prototype.onChildviewClicked=function(t,e){return t.toggleCheckmark(),this._toggleGalleryMembership(e.model,t.selected(),t)},i.prototype._toggleGalleryMembership=function(t,e,o){var i,r,n,s,a,l;return null!=this.batchEditablePhoto?e?this.batchEditablePhoto.addGallery(t.id):(this.batchEditablePhoto.removeGallery(t.id),null!=o&&o.render(),App.vent.trigger("addToGalleriesPopover:removePhoto",t.id,null!=(n=o.options.photos)&&null!=(s=n[0])?s.id:void 0)):(e?(i=t.addPhotos,r="messages-gallery-add"):(App.vent.trigger("addToGalleriesPopover:removePhoto",t.id,null!=(a=o.options.photos)&&null!=(l=a[0])?l.id:void 0),i=t.removePhotos,r="messages-gallery-remove"),i.call(t,this.photos).done(function(e){return function(){var o,i;return i=$("<a>").text(e.ui.list.i18n("messages-view-gallery",{"return":!0})).attr("href",t.getCanonicalUrl()).attr("target","_blank")[0].outerHTML,o=e.ui.list.i18n(r,{count:e.photos.length,"return":!0})+" "+i,App.Flash.success(o),e.dismiss()}}(this)).fail(function(t){return function(){var t,e;return t=(e=App.Helpers.API).parseError.apply(e,arguments),App.Flash.error(App.Helpers.API.getErrorMessage(t))}}(this))),App.vent.trigger("change:gallery_membership")},i}(Marionette.CompositeView)}.call(this),function(){var t,e,o=function(t,e){function o(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},i={}.hasOwnProperty;e=App.module("Galleries.Views"),t=$(window),e.GalleryPhotoRequestRemovalModal=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return o(i,e),i.prototype.template="gallery_photo_request_removal_modal",i.prototype.className="gallery_photo_request_removal_modal action_modal report-content-modal",i.prototype.ui={closeButton:".header .close",reasonDetails:".content textarea",submitButton:".content .submit"},i.prototype.behaviors={ModalDialog:{closeButton:!1,wrapperClass:"report-content-modal-wrapper",dialogClass:"report-content-modal-dialog"},HasButtons:{"@ui.closeButton":"onCloseClicked","@ui.submitButton":"onSubmitClicked"}},i.prototype.initialize=function(t){if(null==t&&(t={}),this.photo=t.photo,null==this.photo)throw new Error("Gallery photo is missing!")},i.prototype.onShow=function(){return this.ui.reasonDetails.focus()},i.prototype.resize=function(){return t.width()<=360?this.$el.width(t.width()-20):this.$el.width(360),this.trigger("resize")},i.prototype.onCloseClicked=function(){return this.destroyModal()},i.prototype.onSubmitClicked=function(){var t;return t="[RR:"+this.photo.id+"]"+this.ui.reasonDetails.val(),this.model.reportContent(0,t).done(function(t){return function(){return App.Flash.success(t.ui.submitButton.i18n("success",{"return":!0})),t.destroyModal()}}(this))},i}(Marionette.LayoutView)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Collections"),t.SampleUserPhotos=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.model=App.Photos.Models.PhotoMembership,o.prototype.initialize=function(t){return null==t&&(t={}),this.user_id=t.user.id},o.prototype.baseUrl=PxApp.Constants.API_URL+"/photos",o.prototype.url=function(){var t;return t={rpp:5,feature:"user",user_id:this.user_id,include_states:!0,exclude:"Nude",image_size:PxApp.Constants.PHOTO_GRID_IMAGE_SIZES},this.baseUrl+"?"+$.param(t)},o.prototype.parse=function(t){return t.photos},o}(Backbone.Collection)}.call(this),function(){var t,e,o,i,r=function(t,e){function o(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},n={}.hasOwnProperty;i=App.module("Views"),t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.template=!1,e.prototype.className="hover_card_item",e}(Marionette.ItemView),e=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.tagName="a",e.prototype.template=!1,e.prototype.className="hover_card_item",e.prototype.attributes=function(){var t;return t=this.model.photo.getImagePath({size:PxApp.Constants.PHOTO_SIZES.S3_IMG_GRID_300}),{href:this.model.get("url"),style:"background-image: url('"+t+"')"}},e}(Marionette.ItemView),o=function(o){function i(){return i.__super__.constructor.apply(this,arguments)}return r(i,o),i.prototype.className="user_hover_card__bottom_wrapper",i.prototype.filter=function(t,e,o){return o.indexOf(t)<3},i.prototype.getChildView=function(o){return o.get("emptyView")?t:e},i}(Marionette.CollectionView),i.UserHoverCard=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return r(e,t),e.prototype.template="user_hover_card",e.prototype.className="user_hover_card",e.prototype.regions={imagesRegion:".user_hover_card__bottom"},e.prototype.behaviors={IsPopover:{classPrefix:"user_hover_card"},HasFollowButton:{"class":"mini_follow"}},e.prototype.initialize=function(t){var e,o,i,r;if(this.photos=t.photos,this.source=t.source,this.statsTrackingMetadata=t.statsTrackingMetadata,i=this.photos.length,i&&3>i)for(o=3-i,e=0,r=o;r>=0?r>e:e>r;r>=0?e++:e--)this.photos.push(new Backbone.Model({emptyView:!0}));return this.behaviors.HasFollowButton.statsTracking={source:this.source,metadata:this.statsTrackingMetadata}},e.prototype.onRender=function(){return this.photos.length?this.imagesRegion.show(new o({collection:this.photos})):void 0},e.prototype.templateHelpers=function(){var t;return{path:userPath(this.model,null,{source:this.source,medium:null!=(t=this.statsTrackingMetadata)?t.medium:void 0}),hasPhotos:this.photos.length>0,followers_count:App.Helpers.Numbers.suffixFormatter(this.model.get("followers_count"),1),singleFollower:1===this.model.get("followers_count")}},e}(Marionette.LayoutView)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Views"),t.AddToGalleryButton=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.template=!1,o.prototype.initialize=function(t){return null==t&&(t={}),null!=t.onOpenGA&&(this.onOpenGA=t.onOpenGA),null!=t.onClick?this.onClick=t.onClick:void 0},o.prototype.events={click:"_openAddToGalleryPopover"},o.prototype._openAddToGalleryPopover=function(t){var e,o,i;return null!=this.onOpenGA&&null!=this.onOpenGA.category&&PxApp.GA.event(this.onOpenGA),null!=App.currentUser?(i=new App.Views.AddToGalleriesPopover({kind:"gallery",photos:[this.model]}),e=function(){return i.dismiss()},this.listenToOnce(i,"IsPopover:show",function(t){return function(){return $(".photo_sidebar").one("scroll",e)}}(this)),this.listenToOnce(i,"IsPopover:hide",function(t){return function(){return $(".photo_sidebar").off("scroll",e)}}(this)),i.showPopover(t)):(o=new App.Views.SignupLoginModal({userAction:"add_to_gallery"}),this.listenToOnce(o,"signup:success login:success",function(){return window.location.reload()}),o.showModal()),"function"==typeof this.onClick&&this.onClick(),!1},o}(Marionette.ItemView)}.call(this),function(){var t;t=App.module("Helpers"),t.UserHoverCardHelper=function(){function t(){}return t.MIN_HOVER_DELAY=500,t.attachHoverCard=function(t,e,o){return t.on("mouseover",null,{userId:e,statsTracking:o},this._onMouseOver),t.on("mouseout",this._onMouseOut)},t._onMouseOver=function(e){var o,i,r,n;return r=App.Photos.Models.UserManager.getModelById(e.data.userId,{followingStates:!0,viewCount:!0}),i=new App.Collections.SampleUserPhotos({user:{id:e.data.userId}}),o=i.fetch(),n=$.when(r,o),t.userHoverTimeout=setTimeout(function(){return n.done(function(t){var o,r;return o={hide:{fixed:!0,delay:300,event:"mouseleave"}},r=new App.Views.UserHoverCard({model:t,photos:i,source:e.data.statsTracking.source,statsTrackingMetadata:{medium:"hover_card"}}),r.showPopover(e,o)})},t.MIN_HOVER_DELAY)},t._onMouseOut=function(e){return t.userHoverTimeout?(clearTimeout(t.userHoverTimeout),t.userHoverTimeout=null):void 0},t}()}.call(this),function(){var t,e,o,i,r,n=function(t,e){function o(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},s={}.hasOwnProperty;$.lazyLoadXT.autoInit=!1,r=App.module("Photos.Views"),t=$(window),e=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.template="assignments_more_button_popover",e.prototype.ui={removeFromAssignment:".remove_from_assignment"},e.prototype.initialize=function(t){return this.qtip=t.qtip,this.listing=t.listing,this.photo=t.photo,this.qtipApi=this.qtip},e.prototype.handleAction=function(t,e){switch(t){case"remove_photo":return this._removePhotoFromAssignment()}},e.prototype._removePhotoFromAssignment=function(){return this.listing.getActiveClaim().removePhoto(this.photo).done(function(t){return function(){return t.listing.getActiveClaim().fetch(),App.Flash.success("Removed photo from assignment"),t.photo.trigger("removePhoto")}}(this)).fail(function(t){return function(){var t,e;return t=(e=App.Helpers.API).parseError.apply(e,arguments),App.Flash.error(App.Helpers.API.getErrorMessage(t))}}(this))},e}(App.Behaviors.HasExtraActionsDropdown.DropdownBase),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.template="quest_more_button_popover",e.prototype.ui={removeFromQuest:".remove_from_quest"},e.prototype.initialize=function(t){return this.qtip=t.qtip,this.quest=t.quest,this.photo=t.photo,this.qtipApi=this.qtip},e.prototype.handleAction=function(t,e){switch(t){case"remove_photo":return this._removePhotoFromQuest()}},e.prototype._removePhotoFromQuest=function(){return this.quest.removePhoto(this.photo).done(function(t){return function(){return App.Flash.success("Removed photo from quest"),t.photo.trigger("removePhoto")}}(this)).fail(function(t){return function(){var t,e;return t=(e=App.Helpers.API).parseError.apply(e,arguments),App.Flash.error(App.Helpers.API.getErrorMessage(t))}}(this))},e}(App.Behaviors.HasExtraActionsDropdown.DropdownBase),o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.template="galleries_more_button_popover",e.prototype.ui={setAsCover:".set_as_cover",requestRemoval:".request_removal",removeFromGallery:".remove_from_gallery"},e.prototype.initialize=function(t){return this.qtip=t.qtip,this.gallery=t.gallery,this.photo=t.photo,this.qtipApi=this.qtip},e.prototype.templateHelpers=function(){return{isGalleryOwnedByCurrentUser:this.gallery.isOwnedByCurrentUser(),isGalleryCoverPhoto:this.gallery.getCoverPhotoId()===this.photo.id,isPhotoOwnedByCurrentUser:this.photo.isOwner()}},e.prototype.handleAction=function(t,e){switch(t){case"request_removal":return this._requestRemoval();case"set_as_cover":return this._setAsGalleryCoverPhoto();case"remove_from_gallery":return this._removePhotoFromGallery()}},e.prototype._requestRemoval=function(){var t;return t=new App.Galleries.Views.GalleryPhotoRequestRemovalModal({model:this.gallery,photo:this.photo}),t.showModal(),this.qtip.destroy()},e.prototype._setAsGalleryCoverPhoto=function(){return this.gallery.setCover(this.photo.id).done(function(t){return function(){var e;return e=t.ui.setAsCover.i18n("flash-success",{"return":!0}),App.Flash.success(e)}}(this)).fail(function(t){return function(){var t,e;return t=(e=App.Helpers.API).parseError.apply(e,arguments),App.Flash.error(App.Helpers.API.getErrorMessage(t))}}(this)),this.qtip.destroy()},e.prototype._removePhotoFromGallery=function(){return this.gallery.removePhotos([this.photo]).done(function(t){return function(){var e;return e=t.ui.removeFromGallery.i18n("flash-success",{"return":!0}),App.Flash.success(e),t.photo.trigger("removePhoto"),t.gallery.trigger("updateItemsCount")}}(this)).fail(function(t){return function(){var t,e;return t=(e=App.Helpers.API).parseError.apply(e,arguments),App.Flash.error(App.Helpers.API.getErrorMessage(t))}}(this)),this.qtip.destroy()},e}(App.Behaviors.HasExtraActionsDropdown.DropdownBase),r.PhotoItem=function(r){function s(t){var e,o;if(this.maxRowHeight=t.maxRowHeight,this.eventName=t.eventName,this.hasHoverState=t.hasHoverState,this.waitThumbnailsLoad=t.waitThumbnailsLoad,this.showTitle=t.showTitle,this.scrollContainer=t.scrollContainer,this.hasVisibleCredits=t.hasVisibleCredits,this.showPulse=t.showPulse,this.gallery=t.gallery,this.quest=t.quest,this.listing=t.listing,this.GA=t.GA,this.commenter=t.commenter,this.fixedWidth=t.fixedWidth,this.source=t.source,this.statsTrackingMetadata=t.statsTrackingMetadata,this.hasDetailsTooltip=t.hasDetailsTooltip,this.fixedHeight=t.fixedHeight,null==this.maxRowHeight)throw new Error("maxRowHeight is missing");if(null==this.eventName)throw new Error("eventName is missing");
if(null==this.hasHoverState)throw new Error("hasHoverState is missing");if(null==this.waitThumbnailsLoad)throw new Error("waitThumbnailsLoad is missing");if(null==this.showTitle)throw new Error("showTitle is missing");if(null==this.hasVisibleCredits)throw new Error("hasVisibleCredits is missing");if(null==this.showPulse)throw new Error("showPulse is missing");if(null!=this.fixedWidth&&null!=this.fixedHeight)throw new Error("fixedWidth and fixedHeight are mutually exclusive");e=t.model.getPhoto(),null==this.GA&&(this.GA={}),null==this.behaviors&&(this.behaviors={}),!this.hasHoverState||e.isOwner()||(null!=(o=App.currentUser)?o.isBuyer():void 0)?delete this.behaviors.HasLikeButton:this.behaviors.HasLikeButton={"class":"only_icon",model:function(){return e}},this.hasHoverState&&App.Photos.Models.PhotoManager.prefetchModels([t.model.id],{favoriteAndLikeStates:null!=this.behaviors.HasLikeButton,licensingStates:!App.currentUser||App.currentUser.isBuyer(),batchable:!0}),this.once("imageSrc::update",function(t){return function(){return t.updateImageSrc()}}(this)),s.__super__.constructor.call(this,t)}return n(s,r),s.prototype.template="photo_item",s.prototype.className="photo_thumbnail",s.prototype.ui={assignmentsReviewButton:".assignments_review_button",addToGalleryButton:".add_to_gallery_button",cartButton:".cart_button",image:".photo_link img",moreButton:".photo__top_buttons__more_button",photoLink:"a.photo_link",photoThumbnail:".photo_thumbnail",tooltipViews:".photo_tooltip__details_views",tooltipLikes:".photo_tooltip__details_likes",tooltipComments:".photo_tooltip__details_comments",photographer:".photographer"},s.prototype.events={"click .photo_link":"onPhotoClicked","click .photo_title":"onPhotoClicked","click .avatar":"_onClickUserAvatar","click .photographer":"_onClickUserName","contextmenu img":"onImgRightClick"},s.prototype.behaviors={HasTooltips:!0,HasQTipPopovers:{"@ui.moreButton":{classPrefix:"galleries_more_button_popover",position:{my:"top center",at:"bottom center",adjust:{method:"shift flipinvert"}},popover:function(t,r){var n;return n={el:t,qtip:r,photo:this.model.getPhoto()},this.gallery?new o(_.extend(n,{gallery:this.gallery})):this.quest?new i(_.extend(n,{quest:this.quest})):this.listing?new e(_.extend(n,{listing:this.listing})):void 0}}},HasButtons:{"@ui.addToGalleryButton":"_openAddToGalleryPopover","@ui.cartButton":"onPhotoClicked"}},s.prototype._openAddToGalleryPopover=function(t){var e,o;return null!=App.currentUser?(o=new App.Views.AddToGalleriesPopover({kind:"gallery",photos:[this.model.getPhoto()]}),this.listenToOnce(o,"IsPopover:show",function(t){return function(){return t.$el.addClass("active")}}(this)),this.listenToOnce(o,"IsPopover:hide",function(t){return function(){return t.$el.removeClass("active")}}(this)),o.showPopover(t),this._sendGAEvent({action:"Add To Gallery Popover Opened"})):(e=new App.Views.SignupLoginModal({userAction:"add_to_gallery"}),this.listenToOnce(e,"signup:success login:success",function(){return window.location.reload()}),e.showModal()),!1},s.prototype.LAZYOFFSET=t.height(),s.prototype._shouldShowTopMenuButton=function(){var t,e,o,i,r;return t=this.model.getPhoto(),o=null!=this.gallery&&(this.gallery.isOwnedByCurrentUser()||t.isOwner()),r=null!=this.quest&&(null!=(e=App.currentUser)?e.get("admin"):void 0),i=null!=this.listing,o||r||i},s.prototype.onAttach=function(){return null!=this.model.get("user")?App.Helpers.UserHoverCardHelper.attachHoverCard(this.ui.photographer,this.model.get("user").id,{source:this.source}):void 0},s.prototype.templateHelpers=function(){var t,e,o,i,r,n,s,a,l,u,p,c,h;return t=this.model.getPhoto(),e="Untitled"===t.get("name")?"Photo":t.get("name"),h=null!=(o=t.getUser())?o.get("fullname"):void 0,c=t.get("nsfw")&&(null!=(i=App.currentUser)?i.get("admin"):void 0),{photoId:t.id,hasHoverState:this.hasHoverState,hasAddToGalleryButton:!(!App.currentUser&&t.isLicenseable()||!t.isPublic()&&!t.isOwner()),hasLikeButton:t.isPublic()&&!t.isOwner(),hasCartButton:t.isLicenseable()&&!t.isOwner()&&(!App.currentUser||App.currentUser.isBuyer()),hasVisibleCredits:this.hasVisibleCredits&&!App.Helpers.isMobileOrTablet(),showTitle:this.showTitle,isOwnedByCurrentUser:t.isOwner(),canShowMenu:this._shouldShowTopMenuButton(),dimensionsAvailable:!this.waitThumbnailsLoad&&(null!=(r=t.get("width"))?r:-1)>0&&(null!=(n=t.get("height"))?n:-1)>0,imgAlt:""+e,showPulse:this.showPulse,isNsfw:t.get("nsfw"),hasDetailsTooltip:this.hasDetailsTooltip,createdAt:moment(this.model.getPhoto().get("created_at")).format("ll"),hasAssignmentsReviewButton:this.model.getPhoto().isAssignmentRejected(),assignmentsReviewNote:null!=(s=this.model.getPhoto().get("listing_photo"))&&null!=(a=s.rejection_note)?a.body:void 0,listingPhotoRequirementFields:null!=(l=this.model.getPhoto().get("listing_photo"))?l.listing_photo_requirement_fields:void 0,source:this.source,medium:null!=(u=null!=(p=this.statsTrackingMetadata)?p.medium:void 0)?u:"photo_grid",showNsfwFlag:c,shouldShowTopElement:this._shouldShowTopMenuButton()||c}},s.prototype.updateImageSrc=function(){var t,e,o,i,r,n,s,a;if(i=this.model.getPhoto(),t=this.$("img"),this.hasDetailsTooltip)return void t.attr("src",i.get("image_url"));if(App.isBot()&&(a=i.getImagePath({size:14})))return void t.attr("src",a);for(s=Math.max(1,null!=(r=window.devicePixelRatio)?r:1),o=[{height:300,size:32},{height:450,size:31},{height:600,size:33}],o.sort(function(t,e){return e.height-t.height}),s=Math.min(s,1.5),n=t.height()*s,e=o.pop();o.length>0&&e.height<n;)e=o.pop();return t.attr("src",i.getImagePath({size:e.size}))},s.prototype.onRender=function(){var t,e,o,i,r,n;return this.hasHoverState||this.hasDetailsTooltip||this.ui.photoLink.attr("href",null),this.hasDetailsTooltip&&(this.ui.tooltipViews.i18n({count:this.model.get("views")}),this.ui.tooltipLikes.i18n({count:this.model.get("likes")}),this.ui.tooltipComments.i18n({count:this.model.get("comments")})),this.fixedWidth&&(this.ui.image.css("width",this.fixedWidth),t=this.fixedWidth*(this.model.getPhoto().get("height")/this.model.getPhoto().get("width")),this.ui.image.css("height",t)),this.fixedHeight&&(this.ui.image.css("height",this.fixedHeight),n=this.fixedHeight*(this.model.getPhoto().get("width")/this.model.getPhoto().get("height")),this.ui.image.css("width",n)),r=null!=(o=null!=(i=App.currentUser)?i.get("show_nude"):void 0)?o:!1,e=this.model.getPhoto().get("nsfw"),r===!1&&e===!0&&this.$el.addClass("nsfw_placeholder"),this.$("img").lazyLoadXT({scrollContainer:this.scrollContainer,edgeY:this.LAZYOFFSET}),this.$el.data("id",this.model.getPhoto().id),this.listenTo(this,"like:after",this._onPhotoLiked)},s.prototype.onShow=function(){return this.model.getPhoto().isAssignmentRejected()&&this.$el.addClass("photo_thumbnail--changes_required"),this.listenTo(this.model.getPhoto(),"removePhoto",function(t){return function(){return t.$el.fadeOut(200,function(){return $(t.ui.photoThumbnail).addClass("photo_removal_transition"),t.model.collection.remove(t.model)})}}(this)),this.gallery?this.listenTo(App.vent,"addToGalleriesPopover:removePhoto",function(t){return function(e,o){return o===t.model.getPhoto().id&&e===t.gallery.id?t.$el.fadeOut(200,function(){return $(t.ui.photoThumbnail).addClass("photo_removal_transition"),t.model.collection.remove(t.model)}):void 0}}(this)):void 0},s.prototype.onPhotoClicked=function(t){var e,o,i,r,n;if(!this.hasDetailsTooltip)return this._sendGAEvent({action:"Photo Modal Opened"}),r=this.model.getPhoto(),App.Helpers.isMobileOrTablet()||t.metaKey||t.ctrlKey?("function"==typeof(e=this.model.collection).selectPhoto&&e.selectPhoto(r),n="function"==typeof(o=this.model.collection).buildBrowserUrlParams?o.buildBrowserUrlParams():void 0,i=r.get("url"),null!=n&&(i+="?"+$.param(n)),App.Helpers.isMobileOrTablet()?document.location=i:window.open(i,"_blank")):r.has("highlightedComments")&&null!=this.commenter?App.vent.trigger(this.eventName,r,{GA:this.GA,navigationContext:this.model.collection,commenter:this.commenter}):App.vent.trigger(this.eventName,r,{GA:this.GA,navigationContext:this.model.collection}),App.vent.trigger("fullAspectRatioPhotoItem:click"),!1},s.prototype.onImgRightClick=function(t){var e;if(null!=(null!=(e=this.model)?e.getPhoto:void 0))return App.Photos.Views.PhotoCopyrightTooltip.showTooltip(this.model.getPhoto(),t),t.preventDefault()},s.prototype._onPhotoLiked=function(t){var e,o;return t?(this._sendGAEvent({action:"Like Button Clicked"}),e=this.model.getPhoto(),this.source&&e.get("user_id")!==(null!=(o=App.currentUser)?o.get("id"):void 0)?App.Helpers.StatsTracking.trackPhoto(e.get("id"),this.source,this.statsTrackingMetadata):void 0):this._sendGAEvent({action:"Unlike Button Clicked"})},s.prototype._onClickUserName=function(){return this._sendGAEvent({action:"User Name Clicked"})},s.prototype._onClickUserAvatar=function(){return this._sendGAEvent({action:"User Avatar Clicked"})},s.prototype._sendGAEvent=function(t){var e;return null==t&&(t={}),null!=this.GA&&null!=this.GA.category?(e=_.extend({},this.GA,t),PxApp.GA.event(e)):void 0},s}(Marionette.LayoutView)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Photos.Views"),t.FullAspectRatioPhotoGrid=function(t){function o(t){null==this.behaviors&&(this.behaviors={}),null!=t.emptyView&&(this.emptyView=t.emptyView),this.scrollContainer=t.scrollContainer,this.hasLoadingSpinner=t.hasLoadingSpinner,null==this.hasLoadingSpinner&&(this.hasLoadingSpinner=!0),null!=this.scrollContainer?this.behaviors.InfiniteScroll={container:function(){return this.scrollContainer},queryString:!1}:this.hasLoadingSpinner?this.behaviors.InfiniteScroll=!0:delete this.behaviors.InfiniteScroll,o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.template="full_aspect_ratio_photo_grid",o.prototype.className="full-aspect-ratio-photo-grid",o.prototype.childView=App.Photos.Views.PhotoItem,o.prototype.childViewContainer=".grid-container",o.prototype.collectionEvents={sync:"refreshGallery",remove:"_recalcLayout"},o.prototype.NUDGE_LEFT_CLASS="photo-thumbnail--nudge-left",o.prototype.NUDGE_RIGHT_CLASS="photo-thumbnail--nudge-right",o.prototype.NUDGE_OFFSET=4,o.prototype.ORIGINAL_WHILE_DRAGGING_CLASS="photo-thumbnail--original-start-drag",o.prototype.HEALING_TRANSITION_DURATION=400,o.prototype.HEALING_TRANSITION_DELAY=600,o.prototype.ui={showMore:".full_aspect_ratio_photo_grid__show_more_container",backToTop:".full_aspect_ratio_photo_grid__back_to_top_container",pageCounter:".full_aspect_ratio_photo_grid__page_counter"},o.prototype.behaviors={HasButtons:{".full_aspect_ratio_photo_grid__show_more":"onClickMorePhotos",".full_aspect_ratio_photo_grid__back_to_top":"onClickBackToTop"}},o.prototype.templateHelpers=function(){return{isPaginated:this.pagination}},o.prototype.initialize=function(t){var e;return this.eventName=t.eventName,this.hasHoverState=t.hasHoverState,this.waitThumbnailsLoad=t.waitThumbnailsLoad,this.maxRowHeightPercentage=t.maxRowHeightPercentage,this.showTitle=t.showTitle,this.photoGridPadding=t.photoGridPadding,this.hasVisibleCredits=t.hasVisibleCredits,this.showPulse=t.showPulse,this.isSortable=t.isSortable,this.gallery=t.gallery,this.quest=t.quest,this.listing=t.listing,this.shotlistItem=t.shotlistItem,this.hideLastRow=t.hideLastRow,this.pagination=t.pagination,this.GA=t.GA,this.commenter=t.commenter,this.forceRowHeight=t.forceRowHeight,this.useJustifiedGallery=t.useJustifiedGallery,this.fixedWidth=t.fixedWidth,this.source=t.source,this.statsTrackingMetadata=t.statsTrackingMetadata,this.hasDetailsTooltip=t.hasDetailsTooltip,this.maxNumRows=t.maxNumRows,this.border=t.border,null==this.showTitle&&(this.showTitle=!1),null==this.eventName&&(this.eventName="showPhoto"),null==this.hasHoverState&&(this.hasHoverState=!1),null==this.hasVisibleCredits&&(this.hasVisibleCredits=!1),null==this.waitThumbnailsLoad&&(this.waitThumbnailsLoad=!0),null==this.showPulse&&(this.showPulse=!1),null==this.isSortable&&(this.isSortable=!1),null==this.hideLastRow&&(this.hideLastRow=!1),null==this.pagination&&(this.pagination=!1),null==this.commenter&&(this.commenter=null),null==this.useJustifiedGallery&&(this.useJustifiedGallery=!0),null==this.fixedWidth&&(this.fixedWidth=null),null==this.hasDetailsTooltip&&(this.hasDetailsTooltip=!1),null==this.maxNumRows&&(this.maxNumRows=0),null==this.border&&(this.border=-1),PxCurrentUser.isAuthorized("limited_infinite_scroll")||(this.pagination=!1),null==this.photoGridPadding&&(this.photoGridPadding=0),null==this.maxRowHeightPercentage&&(this.maxRowHeightPercentage=120),this.forceRowHeight?this.maxRowHeight=this.forceRowHeight:this.maxRowHeight=this._computeMaxRowHeight(this._computeRowHeightForWidth($(window).width()-this.photoGridPadding)),this.pagination&&(e=this._extractUrlParams(),null!=e.page)?this.collection.page=parseInt(e.page):void 0},o.prototype.childViewOptions=function(t,e){return{showTitle:this.showTitle,hasHoverState:this.hasHoverState,eventName:this.eventName,waitThumbnailsLoad:this.waitThumbnailsLoad,maxRowHeight:this.maxRowHeight,scrollContainer:this.scrollContainer,hasVisibleCredits:this.hasVisibleCredits,showPulse:this.showPulse&&!App.Helpers.isMobileOrTablet(),gallery:this.gallery,quest:this.quest,listing:this.listing,shotlistItem:this.shotlistItem,GA:this.GA,commenter:this.commenter,fixedWidth:this.fixedWidth,source:this.source,statsTrackingMetadata:this.statsTrackingMetadata,hasDetailsTooltip:this.hasDetailsTooltip}},o.prototype.onAttach=function(){return this.forceRowHeight?(this.rowHeight=this.forceRowHeight,this.maxRowHeight=this.rowHeight):(this.rowHeight=this._computeRowHeightForWidth(this.$el.width()),this.maxRowHeight=this._computeMaxRowHeight(this.rowHeight)),this.useJustifiedGallery?this.$(this.childViewContainer).on("jg.complete",function(t){return function(){return t._updateImages()}}(this)):this._updateImages(),this.collection.length>0&&this.useJustifiedGallery&&this._setupGallery(),this.$el.toggleClass("infinite_scroll_container--no_content_yet",0===this.collection.length),this.isSortable&&this.initializeSortable(),this.pagination&&(this.ui.showMore.hide(),this.ui.backToTop.hide()),this.hasLoadingSpinner?void 0:this.$(this.childViewContainer).addClass("no-infinite-scroll")},o.prototype.initializeSortable=function(){var t;return t={placeholder:"photo-thumbnail__placeholder",delay:200,tolerance:"pointer",opacity:.8,helper:"clone",items:"> .photo_thumbnail",appendTo:this.childViewContainer,containment:"parent",delay:150,start:this._onStartDragging,stop:function(t){return function(e,o){return t._onStopDragging(e,o)}}(this),change:function(t){return function(e,o){return t._onDraggingOverNewPosition(e,o)}}(this)},this.$(this.childViewContainer).sortable(t)},o.prototype._updateImages=function(){return this.children.each(function(t){return t.trigger("imageSrc::update")})},o.prototype.nudgeRow=function(t){var e,o,i,r,n;return n=t.position().top,i=t.position().left,e=$(".photo_thumbnail").filter(function(t,e){return $(e).position().top===n}),o=e.filter(function(t,e){return $(e).position().left+$(e).width()<i}),r=e.filter(function(t,e){return $(e).position().left>i}),o.addClass(this.NUDGE_LEFT_CLASS),r.addClass(this.NUDGE_RIGHT_CLASS)},o.prototype.unNudge=function(){return $("."+this.NUDGE_LEFT_CLASS).removeClass(this.NUDGE_LEFT_CLASS),$("."+this.NUDGE_RIGHT_CLASS).removeClass(this.NUDGE_RIGHT_CLASS)},o.prototype.onDragDropComplete=function(t,e,o){var i,r;return r=t.data("id"),i=e.data("id"),this._recalcLayout(),this.trigger("change:photoOrder",r,i)},o.prototype._computeRowHeightForWidth=function(t){var e;return e=Math.round(t/6+50),this._rowHeightForMaxHeight(375)>e&&e>this._rowHeightForMaxHeight(300)&&(e=this._rowHeightForMaxHeight(300)),Math.min(e,this._rowHeightForMaxHeight(450))},o.prototype._computeMaxRowHeight=function(t){return t*this.maxRowHeightPercentage/100},o.prototype._rowHeightForMaxHeight=function(t){return t/(this.maxRowHeightPercentage/100)},o.prototype._setupGallery=function(){var t,e;if(!this._galleryInitialized)return this._galleryInitialized=!0,t=App.Helpers.isMobileOrTablet()?2:10,e={useSizeFromData:!0,rowHeight:this.rowHeight,maxRowHeight:this.maxRowHeight,fixedHeight:null!=this.forceRowHeight,margins:t,cssAnimation:!0,lastRow:this.hideLastRow?"hide":"nojustify",waitThumbnailsLoad:this.waitThumbnailsLoad,selector:"> .photo_thumbnail",captions:!1,hasLoadingSpinner:this.hasLoadingSpinner,maxNumRows:this.maxNumRows,border:this.border},this.$(this.childViewContainer).justifiedGallery(e).on("jg.resize",function(t){return function(){var e;return e=t.$(".photo_thumbnail:eq(1)"),e.find(".add_to_gallery_button").qtip("reposition")}}(this))},o.prototype._recalcLayout=function(){return this.useJustifiedGallery?_.defer(function(t){return function(){return t.$(t.childViewContainer).justifiedGallery()}}(this)):void 0},o.prototype._onStartDragging=function(t,e){return e.item.show().addClass(this.ORIGINAL_WHILE_DRAGGING_CLASS),e.helper.addClass("photo-thumbnail--dragging")},o.prototype._onStopDragging=function(t,e){var o,i,r;return e.item.show().removeClass(this.ORIGINAL_WHILE_DRAGGING_CLASS).removeAttr("style"),this.$(".photo-thumbnail--dragging").removeClass("photo-thumbnail--dragging"),this.unNudge(),o=e.item.next(),i=e.item.prev(),r=e.item,r.append('<div class="photo-feedback-overlay"></div>'),r.find(".photo-feedback-overlay").animate({opacity:"toggle"},this.HEALING_TRANSITION_DURATION),_.delay(function(){return r.find(".photo-feedback-overlay").animate({opacity:"toggle"},this.HEALING_TRANSITION_DURATION,"swing",function(){return r.find(".photo-feedback-overlay").remove()})},this.HEALING_TRANSITION_DELAY),this.onDragDropComplete(r,i,o)},o.prototype._onDraggingOverNewPosition=function(t,e){var o,i,r;return this.unNudge(),i=e.placeholder,o=i.prev(".photo_thumbnail"),r=i.next(".photo_thumbnail"),o.length||r.length?(o.length?(i.height(o.height()),i.css({top:o.position().top+"px",left:o.position().left+o.width()+this.NUDGE_OFFSET+"px"})):(i.height(r.height()),i.css({top:r.position().top+"px",left:r.position().left-this.NUDGE_OFFSET+"px"})),this.nudgeRow(i),i.removeClass("photo-thumbnail__placeholder--visible"),_.delay(function(){return i.addClass("photo-thumbnail__placeholder--visible")},100)):void 0},o.prototype.showLastRow=function(){return this.useJustifiedGallery&&0!==this.collection.length?(this._setupGallery(),this.$(this.childViewContainer).justifiedGallery({lastRow:"nojustify"})):void 0},o.prototype.refreshGallery=function(){if(0!==this.collection.length&&(this.$el.removeClass("infinite_scroll_container--no_content_yet"),this.useJustifiedGallery&&(this._setupGallery(),this.$(this.childViewContainer).justifiedGallery("norewind")),this.ui.showMore.hide(),this.ui.backToTop.hide(),this.pagination)){if(this.updatePaginationUrlParam(),this.ui.pageCounter.i18n("page",{page:this.collection.page,total:this.collection.totalPages}),this.collection.page<=2?this.ui.backToTop.hide():this.ui.backToTop.show(),this.collection.page%2!==0)return this.ui.showMore.hide();if(this.pauseInfiniteScroll(),!this.collection.finished())return this.ui.showMore.show()}},o.prototype.onClickMorePhotos=function(){return this.collection.remove(this.collection.models),$(window).scrollTop(this.$el.offset().top-58),this.continueInfiniteScroll(),this.trigger("infinite_scroll:fetch_next")},o.prototype.onClickBackToTop=function(){return this.collection.remove(this.collection.models),this.collection.reset(),this.continueInfiniteScroll(),this.collection.fetch()},o.prototype.updatePaginationUrlParam=function(){var t;return t=this._extractUrlParams(),t.page=this.collection.page,App.router.navigate(document.location.pathname+"?"+$.param(t),{replace:!0})},o.prototype.pauseInfiniteScroll=function(){return this.trigger("infinite_scroll:pause")},o.prototype.continueInfiniteScroll=function(){return this.trigger("infinite_scroll:continue")},o.prototype._extractUrlParams=function(){var t,e;return e={},""!==document.location.search&&(t=_.map(document.location.search.substr(1).split("&"),function(t){return t.split("=")}),_.each(t,function(t){return e[t[0]]=t[1]})),e},o}(Marionette.CompositeView)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Classes.Views"),t.ClassOverview=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.template="class_overview",o.prototype.className="class_overview",o.prototype.regions={headerRegion:".class_header_region",sampleGridRegion:".class_overview__sample_grid_region",webinarRegion:".class_overview__webinar_region"},o.prototype.ui={joinBtn:".class_overview__join_button",leaveBtn:".class_overview__leave_button"},o.prototype.behaviors={HasButtons:{"@ui.joinBtn":"_onClickJoin","@ui.leaveBtn":"_onClickLeave"}},o.prototype.templateHelpers=function(){var t,e,o,i,r,n,s;return{instructorAvatar:null!=(t=this.model)&&null!=(e=t.get("instructor"))?e.avatars.small.https:void 0,hasSampleGallery:(null!=(o=this.model)?o.hasSampleGallery():void 0)&&(null!=(i=this.sampleGalleryPhotos)?i.length:void 0)>0,enrollmentCount:null!=(r=this.model)&&null!=(n=r.get("enrollment_count"))?n.toLocaleString():void 0,hasClasses:PxCurrentUser.isAuthorized("classes"),enrolled:null!=(s=this.model)?s.isEnrolled():void 0,dataFetched:null!=this.model}},o.prototype.initialize=function(t){return null==t&&(t={}),this.courseId=t.courseId,this.dataStore=t.dataStore,this.dataStore.getCourse(this.courseId).done(function(t){return function(e){return t.model=e,t.render(),t.model.hasSampleGallery()&&!App.Helpers.isMobileOrTablet()?t.model.fetchSampleGalleryPhotos().done(function(){return t.sampleGalleryPhotos=t.model.getSampleGalleryPhotos(),t.render()}):void 0}}(this)),this.listenTo(App.vent,"showPhoto",function(t){return function(e,o){var i;return i=App.Photos.show(e.id,{navigationContext:t.sampleGalleryPhotos})}}(this))},o.prototype.onRender=function(){var t,e;return null!=this.model&&(this.headerRegion.show(new App.Classes.Views.ClassHeader({model:this.model,selectedTab:"overview",dataStore:this.dataStore})),(null!=(e=this.sampleGalleryPhotos)?e.length:void 0)>0&&(t={collection:this.sampleGalleryPhotos,hasHoverState:!0,showTitle:!0,waitThumbnailsLoad:!1,showPulse:!1,pagination:!1,hasLoadingSpinner:!1,border:0},this.sampleGridRegion.show(new App.Photos.Views.FullAspectRatioPhotoGrid(t))),this.model.isUpcoming()||this.model.isLive())?this.webinarRegion.show(new App.Classes.Views.ClassWebinarBanner({model:this.model,dataStore:this.dataStore})):void 0},o.prototype.onShow=function(){return this.dataStore.getAutoEnroll()?(this.dataStore.setAutoEnroll(!1),this.model.enroll()):void 0},o.prototype._onClickJoin=function(){var t;return null!=(t=window.AmplitudeLogger)&&t.classesEvent("Enroll Clicked - Enrolled","Class Overview",this.model.get("id"),this.model.videoStateName()),this.model.enroll().done(function(t){return function(){return t.dataStore.setEnrollmentCount(t.dataStore.getEnrollmentCount()+1),t.render()}}(this))},o.prototype._onClickLeave=function(){var t;return null!=(t=window.AmplitudeLogger)&&t.classesEvent("Drop Clicked","Class Overview",this.model.get("id"),this.model.videoStateName()),this.model.drop().done(function(t){return function(){return t.dataStore.setEnrollmentCount(t.dataStore.getEnrollmentCount()-1),t.render()}}(this))},o}(Marionette.LayoutView)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Classes.Views"),t.ClassVideo=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.template="class_video",o.prototype.className="class_video",o.prototype.ui={returnLink:".class_return_link",cover:".class_video__cover_image"},o.prototype.behaviors={HasButtons:{"@ui.returnLink":"_onClickReturn","@ui.cover":"_playVideo"}},o.prototype.templateHelpers=function(){var t,e;return{coursePath:null!=(t=this.model)?t.getLessonsPath():void 0,videoVisible:(null!=(e=this.model)?e.get("webinar_download"):void 0)&&this.videoVisible,coverPhotoUrl:this.model.coverPhotoUrl(PxApp.Constants.PHOTO_SIZES.S3_IMG_WEB_1500)}},o.prototype.initialize=function(t){return null==t&&(t={}),this.courseId=t.courseId,this.dataStore=t.dataStore,this.dataStore.getCourse(this.courseId).done(function(t){return function(e){return t.model=e}}(this)),this.videoVisible=!1},o.prototype.onRender=function(){return null==this.model?this.dataStore.getCourse(this.courseId).done(function(t){return function(e){return t.render()}}(this)):void 0},o.prototype._onClickReturn=function(){return null!=this.model&&Backbone.history.navigate(this.model.getLessonsPath(),{trigger:!0}),!1},o.prototype._playVideo=function(){return App.Classes.Views.ClassContentLockModal.handleContentAccess(this.model,this.dataStore).done(function(t){return function(){var e;return null!=(e=window.AmplitudeLogger)&&e.classesEvent("Watch Clicked","Class Video",t.model.get("id"),t.model.videoStateName()),t.videoVisible=!0,t.render()}}(this))},o}(Marionette.LayoutView)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Classes.Views"),t.ClassWebinarBanner=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.template="class_webinar_banner",o.prototype.className="class_webinar_banner",o.prototype.ui={watchButton:".class_webinar_banner__watch_button"},o.prototype.behaviors={HasButtons:{"@ui.watchButton":"_onClickWatch"}},o.prototype.templateHelpers=function(){return{startDateTime:moment(this.model.get("webinar_start")).format(this._startDateTimeFormat()),startDate:moment(this.model.get("webinar_start")).format("LL"),startTime:moment(this.model.get("webinar_start")).format("LT"),isUpcoming:this.model.isUpcoming(),isLive:this.model.isLive(),isMobile:App.Helpers.isMobileOrTablet()}},o.prototype.initialize=function(t){return this.dataStore=t.dataStore},o.prototype._onClickWatch=function(){return App.Classes.Views.ClassContentLockModal.handleContentAccess(this.model,this.dataStore).done(function(t){return function(){var e;return null!=(e=window.AmplitudeLogger)&&e.classesEvent("Watch Clicked","Class Overview",t.model.get("id"),t.model.videoStateName()),t.model.get("gotowebinar_id")&&moment(t.model.get("webinar_end")).isAfter(moment())?window.open(t.model.getWatchPath(),"_blank","width=800,height=600"):void 0}}(this))},o.prototype._startDateTimeFormat=function(){return App.Helpers.isMobileOrTablet()?"LLL":"LLLL"},o}(Marionette.LayoutView)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Classes.Views"),t.ClassCardView=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.template="classes_class_card",o.prototype.ui={viewButton:".class_card__cta",coverPhoto:".top",title:".class_card__title"},o.prototype.behaviors={HasButtons:{"@ui.viewButton":"_onClickView","@ui.coverPhoto":"_onClickView","@ui.title":"_onClickView"}},o.prototype.initialize=function(t){return this.options=t},o.prototype.templateHelpers=function(){return{coverPhotoUrl:this.model.coverPhotoUrl(PxApp.Constants.PHOTO_SIZES.S3_IMG_GRID_450),instructorAvatar:this.model.get("instructor").avatars.small.https,coursePath:this.model.getPath(),isUpcoming:this.model.isUpcoming(),startTime:moment(this.model.get("webinar_start")).format("LLL"),hasEnrolledUsers:this.model.get("enrollment_count")>0,enrollmentCount:this.model.get("enrollment_count").toLocaleString()}},o.prototype._onClickView=function(t){var e;return null!=(e=window.AmplitudeLogger)&&e.classesEvent("View Clicked","Class Card",this.model.get("id"),this.model.videoStateName()),this.options.allowLinkClickEvents?!0:(t.preventDefault(),Backbone.history.navigate(this.model.getPath(),{trigger:!0}),!1)},o}(Marionette.ItemView)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},o=function(t,e){function o(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},i={}.hasOwnProperty;t=App.module("Classes.Views"),t.ClassesHeader=function(t){function i(){return this._updateNavOffset=e(this._updateNavOffset,this),i.__super__.constructor.apply(this,arguments)}return o(i,t),i.prototype.template="classes_header",i.prototype.className="classes_header",i.prototype.tagName="header",i.prototype.fixedClassName="classes_header__tabs_wrapper--fixed",i.prototype.ui={tabs:".classes_header__tabs_wrapper",libraryTab:".classes_header__library_tab",myClassesTab:".classes_header__my_classes_tab"},i.prototype.behaviors={HasButtons:{"@ui.libraryTab":"_onClickLibrary","@ui.myClassesTab":"_onClickMyClasses"}},i.prototype.templateHelpers=function(){return{hasEnrollments:this.dataStore.getEnrollmentCount()>0}},i.prototype.initialize=function(t){var e;return null==t&&(t={}),this.selectedTab=null!=(e=t.selectedTab)?e:"library",this.dataStore=t.dataStore,this.listenTo(this.dataStore,"change:enrollmentCount",this.render),$(window).scrollspy({namespace:"classes_index",min:function(t){return function(){return t.navOffset}}(this),max:99999999,onEnter:function(t){return function(){return t.ui.tabs.length>0?t.ui.tabs.addClass(t.fixedClassName):void 0}}(this),onLeave:function(t){return function(){return t.ui.tabs.length>0?t.ui.tabs.removeClass(t.fixedClassName):void 0}}(this)})},i.prototype.onRender=function(){return this.$("[data-tab="+this.selectedTab+"]").addClass("active")},i.prototype.onAttach=function(){return this._updateNavOffset(),$(window).on("resize",this._updateNavOffset)},i.prototype._updateNavOffset=function(){return this.ui.tabs.length>0?this.navOffset=this.ui.tabs.offset().top:void 0},i.prototype.onDestroy=function(){return $(window).off("scroll.classes_index"),$(window).off("resize",this._updateNavOffset)},i.prototype._onClickLibrary=function(){return Backbone.history.navigate("/classes",{trigger:!0}),!1},i.prototype._onClickMyClasses=function(){return Backbone.history.navigate("/classes/myclasses",{trigger:!0}),!1},i}(Marionette.LayoutView)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty,i=function(t,e){return function(){return t.apply(e,arguments)}};t=App.module("Classes.Views"),t.ClassesIndexLayout=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.template="classes_index_layout",o.prototype.className="classes_index_layout",o.prototype.regions={headerRegion:".classes_index__header_region",sidebarRegion:".classes_index__sidebar_region",classListRegion:".classes_course_list_region"},o.prototype.initialize=function(t){var e;return this.dataStore=t.dataStore,this.selectedCategory=null!=(e=t.category)?e:"all"},o.prototype.onRender=function(){return this.headerRegion.show(new App.Classes.Views.ClassesHeader({dataStore:this.dataStore})),this.dataStore.getLibrary().done(function(t){return function(e){return null!=e.hasCategory(t.selectedCategory)?(t.sidebarRegion.show(new App.Classes.Views.ClassesSidebar({dataStore:t.dataStore,selectedCategory:t.selectedCategory})),t.classListRegion.show(new App.Classes.Views.ClassesCourseList({collection:e.getCoursesByCategory(t.selectedCategory)})),$(window).trigger("scroll")):Backbone.history.navigate("/classes",{trigger:!0,replace:!0})}}(this))},o}(Marionette.LayoutView),t.ClassesSidebar=function(t){function o(){return this._updateNavOffset=i(this._updateNavOffset,this),o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.template="classes_sidebar",o.prototype.className="classes_sidebar",o.prototype.fixedClassName="classes_sidebar__category_list--fixed",o.prototype.fixedNoHeaderClassName="classes_sidebar__category_list--fixed_no_header",o.prototype.ui={categoryList:".classes_sidebar__category_list",categories:".classes_sidebar__category",categorySelect:".classes_sidebar__category_select"},o.prototype.events={"click @ui.categories":"_onClickCategory","change @ui.categorySelect":"_onClickCategorySelect"},o.prototype.templateHelpers=function(){
var t;return{categories:null!=(t=this.library)?t.categories().map(function(t){return function(t){return{key:t.get("key"),title:t.get("title")}}}(this)):void 0}},o.prototype.initialize=function(t){return this.dataStore=t.dataStore,this.selectedCategory=t.selectedCategory,this.dataStore.getLibrary().done(function(t){return function(e){return t.library=e,t.render()}}(this)),$(window).scrollspy({namespace:"classes_sidebar",min:function(t){return function(){return t.navOffset}}(this),max:99999999,onEnter:function(t){return function(){return t.ui.categoryList.addClass(t.dataStore.getEnrollmentCount()>0?t.fixedClassName:t.fixedNoHeaderClassName)}}(this),onLeave:function(t){return function(){return t.ui.categoryList.removeClass(t.dataStore.getEnrollmentCount()>0?t.fixedClassName:t.fixedNoHeaderClassName)}}(this)})},o.prototype.onRender=function(){return this.$("[data-key="+this.selectedCategory+"]").addClass("classes_sidebar__category--active"),this.ui.categorySelect.val(this.selectedCategory)},o.prototype.onAttach=function(){return this._updateNavOffset(),$(window).on("resize",this._updateNavOffset)},o.prototype._updateNavOffset=function(){var t;return t=20,this.dataStore.getEnrollmentCount()>0&&(t+=50),this.navOffset=this.$el.offset().top-t},o.prototype.onDestroy=function(){return $(window).off("scroll.classes_sidebar"),$(window).off("resize",this._updateNavOffset)},o.prototype._onClickCategory=function(t){return this._changeCategory($(t.target).data("key"))},o.prototype._onClickCategorySelect=function(t){return this._changeCategory($(t.target).val())},o.prototype._changeCategory=function(t){return t!==this.selectedCategory?Backbone.history.navigate("/classes/"+t,{trigger:!0}):void 0},o}(Marionette.ItemView),t.ClassesCourseList=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.className="classes_course_list",o.prototype.childView=App.Classes.Views.ClassCardView,o}(Marionette.CollectionView)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Groups.Models"),t.Post=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.urlRoot=function(){return PxApp.Constants.API_URL+"/groups/"+this.get("group_id")+"/posts"},o.prototype.url=function(){var t,e;return t=this.urlRoot(),e=this.get("id")?t+"/"+this.get("id"):this.get("parent_post_id")?t+"/"+this.get("parent_post_id")+"/replies":t,e+"?"+$.param(this._urlParams())},o.prototype._urlParams=function(){var t;return t={thumbnail_sizes:[3,600],attachment_sizes:[4,2048],include_top_replies:!0,include_attribution:!0,include_attachments:!0}},o.prototype.defaults={topic:"",body:"",translated:!1},o.prototype.exportable=["isPostOwner","canDelete","canBan","displayedBody","thumbnailPhotoUrl","thumbnailPhoto2xUrl"],o.prototype.viewOnlyAttrs=["group","created_by"],o.prototype.toJSON=function(t){return _.has(null!=t?t:{},"emulateHTTP")&&this.viewOnlyAttrs?_.omit(this.attributes,this.viewOnlyAttrs):o.__super__.toJSON.apply(this,arguments)},o.prototype.validate=function(t){var e;return e=[],"photo"===t.discussion_type?t.attachments.length>0||e.push(["attachments","blank"]):(null==t.parent_post_id&&(t.topic.trim().length>0||e.push(["topic","blank"])),t.body.trim().length>0||e.push(["body","blank"])),e.length>0?_.object(e):void 0},o.prototype.isOwnedBy=function(t){return t.id===this.get("created_by").id},o.prototype.slug=function(){return this.get("topic").toLowerCase().replace(/[^a-z0-9\s]/g,"").trim().replace(/\s+/g,"-")},o.prototype.score=function(){return this.get("votes_count")>=0?2*this.get("positive_votes_count")-this.get("votes_count"):""},o.prototype.isPostOwner=function(){return null!=App.currentUser&&this.postOwnerId()===App.currentUser.id},o.prototype.postOwnerId=function(){return null!=this.get("created_by")?this.get("created_by").id:this.get("user_id")},o.prototype.isGroupAdmin=function(){return null!=App.currentUser&&this.get("group_admin")},o.prototype.canFlag=function(){return null!=App.currentUser&&!this.isPostOwner()&&!this.isGroupAdmin()&&!App.currentUser.get("admin")},o.prototype.canDelete=function(){return null!=App.currentUser&&(this.isPostOwner()||this.isGroupAdmin()||App.currentUser.get("admin"))},o.prototype.canBan=function(){return null!=App.currentUser&&(this.isGroupAdmin()||App.currentUser.get("admin"))&&App.currentUser.id!==this.postOwnerId()},o.prototype.thumbnailPhotoUrl=function(){var t,e;return null!=(t=this.get("thumbnail_photo"))&&null!=(e=t[3])?e.secure_url:void 0},o.prototype.thumbnailPhoto2xUrl=function(){var t,e;return null!=(t=this.get("thumbnail_photo"))&&null!=(e=t[600])?e.secure_url:void 0},o.prototype.buildReply=function(t){var e;return null==t&&(t={}),e=new o,e.set({parent_post_id:this.id,group_id:this.get("group_id"),created_by:App.currentUser,replies_count:this.get("replies_count")}),e.set(t),e},o.prototype.getAttachments=function(){var t;return new App.Collections.Attachments(null!=(t=this.get("attachments"))?t:!1,{postId:this.id})},o.prototype.getActiveAttachments=function(){var t;return new App.Collections.Attachments(null!=(t=_.filter(this.get("attachments"),function(t){return!t.deleted}))?t:[],{postId:this.id})},o.prototype.getActiveAttachmentsCount=function(){var t,e,o,i,r;if(null!=this.get("attachments")){for(e=0,r=this.get("attachments"),o=0,i=r.length;i>o;o++)t=r[o],t.deleted||(e+=1);return e}return this.get("attachments_count")},o.prototype.getTopReplies=function(t){var e;return null==t&&(t=2),null!=this._topReplies?this._topReplies:this._topReplies=new App.Groups.Collections.Posts(null!=(e=_.first(this.get("top_replies"),t))?e:!1,{groupId:this.get("group_id"),postId:this.id,nested:!0})},o.prototype.getReplies=function(t){var e,o;return null==t&&(t={}),null!=this._replies?this._replies:this._replies=new App.Groups.Collections.Posts(null!=(e=this.get("replies"))?e:!1,{groupId:this.get("group_id"),postId:this.id,page:null!=(o=t.page)?o:1,include:t.highlightReply,nested:null!=this.get("parent_post_id")})},o.prototype.getUser=function(){return this.get("created_by")?null!=this._user?this._user:this._user=new App.Groups.Models.User(this.get("created_by")):void 0},o.prototype.getGroup=function(){return null!=this._group?this._group:this._group=new App.Groups.Models.Group({id:this.get("group_id"),slug:this.get("group_slug")})},o.prototype.upvoted=function(){return this.get("liked")===!0},o.prototype.downvoted=function(){return this.get("disliked")===!0},o.prototype.toggleUpVote=function(){return this.downvoted()?this._unvote():this._voteUp()},o.prototype.toggleDownVote=function(){return this.upvoted()?this._unvote():this._voteDown()},o.prototype._voteUp=function(){return this.set("positive_votes_count",this.get("positive_votes_count")+1),this.get("voted")||this.set("votes_count",this.get("votes_count")+1),this.set({voted:!0,liked:!0,disliked:!1}),$.post(PxApp.Constants.API_URL+"/groups/"+this.get("group_id")+"/posts/"+this.id+"/vote?"+$.param(this._urlParams()),{vote:1}).done(function(t){return function(e){var o,i,r,n,s,a,l;if(t.set(t.parse(e)),"photo"===t.get("discussion_type")&&!t.isPostOwner()){for(i=t.getActiveAttachments(),a=i.models,l=[],r=0,n=a.length;n>r;r++)o=a[r],s=o.getModel(),s.get("favorited")?l.push(void 0):l.push(s.favorite());return l}}}(this))},o.prototype._voteDown=function(){return this.upvoted()&&this.set("positive_votes_count",this.get("positive_votes_count")-1),this.get("voted")||this.set("votes_count",this.get("votes_count")+1),this.set({voted:!0,liked:!1,disliked:!0}),$.post(PxApp.Constants.API_URL+"/groups/"+this.get("group_id")+"/posts/"+this.id+"/vote?"+$.param(this._urlParams()),{vote:0}).done(function(t){return function(e){return t.set(t.parse(e))}}(this))},o.prototype._unvote=function(){return this.upvoted()&&this.set("positive_votes_count",this.get("positive_votes_count")-1),this.set("votes_count",this.get("votes_count")-1),this.set({voted:!1,liked:!1,disliked:!1}),$.post(PxApp.Constants.API_URL+"/groups/"+this.get("group_id")+"/posts/"+this.id+"/unvote?"+$.param(this._urlParams())).done(function(t){return function(e){var o,i,r,n,s,a,l;if(t.set(t.parse(e)),"photo"===t.get("discussion_type")&&!t.isPostOwner()){for(i=t.getActiveAttachments(),a=i.models,l=[],r=0,n=a.length;n>r;r++)o=a[r],s=o.getModel(),s.get("favorited")?l.push(s.unfavorite()):l.push(void 0);return l}}}(this))},o.prototype["delete"]=function(){return this.canDelete()?$.ajax({type:"DELETE",url:PxApp.Constants.API_URL+"/groups/"+this.get("group_id")+"/posts/"+this.id+"/"}).done(function(t){return function(){return t.set("deleted",!0)}}(this)).fail(function(t){return function(){return t.trigger("change:deleted")}}(this)):void 0},o.prototype.undelete=function(){!this.canDelete()},o.prototype.parse=function(t){var e,o;return e=null!=(o=t.post)?o:t,null==e.top_replies&&(e.top_replies=this.get("top_replies")),null==e.replies&&(e.replies=this.get("replies")),e.score=e.positive_votes_count-(e.votes_count-e.positive_votes_count),e},o.prototype.flag=function(){return console.log($.cookie("reported-groups-post-"+this.id,!0)),this.set({flagged:!0}),$.post(PxApp.Constants.API_URL+"/groups/"+this.get("group_id")+"/posts/"+this.id+"/flag")},o.prototype.isFlagged=function(){return null!=$.cookie("reported-groups-post-"+this.id)},o.prototype.translateText=function(){return null!=this._translatedCopy?this.set("translated",!0):App.Helpers.Translator.translate(this.get("body"),function(t){return function(e){return e?(t._translatedCopy=e,t.set("translated",!0)):t.trigger("change:translated")}}(this))},o.prototype.showOriginalText=function(){return this.set("translated",!1)},o.prototype.isClassInSession=function(){return null==this.get("class")?!1:moment().isAfter(moment(this.get("class").starts_at))&&moment().isBefore(moment(this.get("class").ends_at))},o.prototype.classOfficeHour=function(){return null==this.get("class")?null:moment.tz(this.get("class").starts_at,"Canada/Eastern").format("MMM D, YYYY [at] hA z")+moment.tz(this.get("class").ends_at,"Canada/Eastern").format(" - hA z")},o.prototype.displayedBody=function(){return this.get("deleted")?"The content has been deleted.":this.get("translated")?this._translatedCopy:this.get("body")},o}(Backbone.Model)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Groups.Collections"),t.Posts=function(t){function o(t,e){null==e&&(e={}),e.contextHash?(e.groupId=e.contextHash.groupId,e.sortCriterion=e.contextHash.groupSort,e.discussionType="photo"):e.navigationDisabled="photo"!==e.discussionType,o.__super__.constructor.call(this,t,e)}return e(o,t),o.prototype.model=App.Groups.Models.Post,o.prototype.rpp=10,o.prototype.initialize=function(t,e){var i;return null==e&&(e={}),o.__super__.initialize.call(this,t,e),i={includeTopReplies:!0,includeAttribution:!0,includeAttachments:!0,includeThumbnail:!1,includeGroup:!1,includeClass:!0},e=_.extend({},i,e),this.groupId=e.groupId,this.postId=e.postId,this.withAttachments=e.withAttachments,this.sortCriterion=e.sortCriterion,this.pinned=e.pinned,this.includeClass=e.includeClass,this.includePost=e.include,this.includeTopReplies=e.includeTopReplies,this.includeAttribution=e.includeAttribution,this.includeThumbnail=e.includeThumbnail,this.includeAttachments=e.includeAttachments,this.includeGroup=e.includeGroup,null!=e.rpp&&(this.rpp=e.rpp),this.discussionType=e.discussionType||"text",this.nested=e.nested,this.nested&&(this.rpp=1e3),"photo"===this.discussionType?this.includeThumbnail=!0:void 0},o.prototype.parse=function(t,e){var i,r;return"photo"===this.discussionType&&(i=function(){var e,o,i,n;for(i=t.posts,n=[],e=0,o=i.length;o>e;e++)r=i[e],r.attachments[0]&&!r.attachments[0].deleted&&n.push(r);return n}(),t.posts=i),o.__super__.parse.call(this,t,e)},o.prototype.url=function(){var t;return t=PxApp.Constants.API_URL+"/groups/",null!=this.source?t+="posts":(t+=this.groupId+"/posts",this.postId&&(t+="/"+this.postId+"/replies")),t+"?"+$.param(this.buildQueryParams())},o.prototype.buildQueryParams=function(){var t,e;return t={},this.includeThumbnail&&(t.include_thumbnail=1,t.thumbnail_sizes=[3,600]),this.includeTopReplies&&(t.include_top_replies=1),this.includeAttribution&&(t.include_attribution=1),this.includeGroup&&(t.include_group=1),this.includeClass&&(t.include_class=1),this.includeAttachments&&(t.include_attachments=1,t.attachment_sizes=PxApp.Constants.PHOTO_GRID_IMAGE_SIZES),this.includePost&&(t.include=this.includePost),this.withAttachments&&(t.with_attachments=1),t.discussion_type=this.discussionType,t.sort=this._sortParam(),null!=this.pinned&&(t.pinned=this.pinned),("my_discussions"===(e=this.source)||"my_comments"===e)&&(t.source=this.source,t.include_group=1),t},o.prototype._sortParam=function(){if(this.nested)return"created_at";switch(this.sortCriterion){case"trending":return"trending";case"date":return"reverse_created_at";default:return"photos"===this.discussionType?"reverse_created_at":"rating"}},o.parseBrowserUrlParams=function(t){var e,i;return e=o.__super__.constructor.parseBrowserUrlParams.apply(this,arguments),e.groupId=null!=(i=App.controller.tidyIntParam("group_id"))?i:-1,e.groupId>0?(e.groupSort=App.controller._loadPageVar("group_sort"),e):null},o.prototype._contextUrlParams=function(){var t;return t={from:"groups",group_id:this.groupId},this.sortCriterion&&(t.group_sort=this.sortCriterion),t},o.prototype.photoAt=function(t){return new App.Photos.Models.Photo(this.at(t).get("attachments")[0])},o.prototype._getPhotoIds=function(){var t,e,o,i,r;for(i=this.models,r=[],t=0,e=i.length;e>t;t++)o=i[t],r.push(o.get("attachments")[0].id);return r},o.prototype._buildDisplayedItemData=function(t){return{attachments:[t.toJSON()]}},o.prototype._extractPhotoIdFromItem=function(t){var e;return null!=(e=_.first(t.attachments))?e.id:void 0},o.prototype.shouldHideRelatedPhotos=function(){return!1},o.prototype.getParticipants=function(){var t;return t=this.map(function(t){return t.get("created_by")}),t=t.concat(this.map(function(t){return t.getTopReplies().map(function(t){return t.get("created_by")})})),t=t.concat(this.map(function(t){return t.getReplies().map(function(t){return t.get("created_by")})})),_.uniq(_.flatten(t),function(t){return t.id})},o}(App.Photos.Collections.NavigationalInfiniteCollection),t.UserFeedPosts=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.initialize=function(t,e){var i,r;return i={includeTopReplies:!0,includeAttribution:!0,includeAttachments:!1,includeThumbnail:!1,includeGroup:!0,includeClass:!1},e=_.extend({},i,e),this.userId=null!=(null!=e?e.userId:void 0)?e.userId:null!=(r=App.currentUser)?r.id:void 0,o.__super__.initialize.call(this,t,e)},o.prototype.url=function(){var t;return t=PxApp.Constants.API_URL+"/users/"+this.userId+"/discussions",t+"?"+$.param(this.buildQueryParams())},o}(t.Posts),t.TopPosts=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.rpp=3,o.prototype.initialize=function(t,e){var i;return i={includeTopReplies:!0,includeAttribution:!1,includeAttachments:!1,includeThumbnail:!1,includeGroup:!0,includeClass:!1},e=_.extend({},i,e),o.__super__.initialize.call(this,t,e)},o.prototype.url=function(){return PxApp.Constants.API_URL+"/groups/top_posts?"+$.param(this.buildQueryParams())},o}(t.Posts)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Groups.Models"),t.Group=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.urlRoot=PxApp.Constants.API_URL+"/groups",o.prototype.defaults={name:"",description:""},o.prototype.exportable=["isNew","firstFriend","secondFriend","remainingFriendsCount"],o.prototype.firstFriend=function(){var t,e;return null!=(t=this.get("recent_friends"))&&null!=(e=t[0])?e.user:void 0},o.prototype.secondFriend=function(){var t,e;return null!=(t=this.get("recent_friends"))&&null!=(e=t[1])?e.user:void 0},o.prototype.remainingFriendsCount=function(){return this.get("friends_count")-1},o.prototype.buildPost=function(t){var e;return null==t&&(t={}),e={group:this,group_id:this.id,created_by:App.currentUser.toJSON(),title:"",body:"",discussion_type:"text"},_.extend(e,t),new App.Groups.Models.Post(e)},o.prototype.getTopPosts=function(){return null!=this._topPosts?this._topPosts:this._topPosts=new App.Groups.Collections.Posts(this.get("top_posts"))},o.prototype.getPosts=function(t){var e;return e=new App.Groups.Collections.Posts(!1,_.extend({},{groupId:this.id},t)),null!=this._posts&&e.url()===this._posts.url()?this._posts:this._posts=e},o.prototype.getMembers=function(t){var e;return e=_.extend({},{groupId:this.id},t),null!=this._members?this._members:this._members=new App.Groups.Collections.Members(!1,e)},o.prototype.getUser=function(){return new App.Groups.Models.User(this.get("created_by"))},o.prototype.getTopPhotoPosts=function(t,e){return null==t&&(t=3),this.get("top_posts")},o.prototype.subscribed=function(){return this.get("is_member")},o.prototype.subscribe=function(){var t,e;return t=$.Deferred(),e=$.post(PxApp.Constants.API_URL+"/groups/"+this.id+"/join"),e.done(function(e){return function(o){return e.set(o.group),t.resolve()}}(this)),e.fail(function(e){return function(e,o,i){var r;return r=JSON.parse(e.responseText),App.Flash.error(r.error),t.reject()}}(this)),t.promise()},o.prototype.unsubscribe=function(){return $.post(PxApp.Constants.API_URL+"/groups/"+this.id+"/leave").done(function(t){return function(e){return t.set(e.group)}}(this))},o.prototype.sync=function(t,e,o){var i,r;return("create"===t||"update"===t)&&(r=new FormData,i=function(t,e,o){var n,s;return s=_.clone(t),s.push(o),n=""+_.first(s),s.length>1&&(n+="["+_.rest(s).join("][")+"]"),$.isPlainObject(e)||$.isArray(e)?_.each(e,_.partial(i,s)):r.append(n,e)},_.each(e.attributes,_.partial(i,[])),_.defaults(o||(o={}),{data:r,processData:!1,contentType:!1})),Backbone.sync.call(this,t,e,o)},o.prototype.wasInvited=function(t){return this.get("invited")||$.cookie("group_"+this.id+"_invited_"+t)},o.prototype.invite=function(t){var e,o;return e=$.Deferred(),o=$.post(PxApp.Constants.API_URL+"/groups/"+this.id+"/invite",{users:t}).done(function(o){return function(i){return $.cookie("group_"+o.id+"_invited_"+t,"true",{expires:30}),e.resolve({users:t})}}(this)),e.promise()},o.prototype.ban=function(t){return $.post(PxApp.Constants.API_URL+"/groups/"+this.id+"/ban",{user_id:t.id})},o.prototype.unban=function(t){return $.post(PxApp.Constants.API_URL+"/groups/"+this.id+"/unban",{user_id:t.id})},o.prototype.isBanned=function(t){return this.get("is_banned")||null!=$.cookie("banned-groups-"+this.id+"-"+t.id)},o.prototype.validate=function(t){var e,o,i,r;return e=[],!(null!=(o=t.name)?o.length:void 0)>0?e.push(["name","blank"]):t.name.length>60&&e.push(["name","too_long"]),!(null!=(i=t.slug)?i.length:void 0)>0?e.push(["slug","blank"]):t.slug.length>60?e.push(["slug","too_long"]):/^([a-z0-9\-]+)$/.test(t.slug)||e.push(["slug","invalid"]),!(null!=(r=t.description)?r.length:void 0)>0?e.push(["description","blank"]):t.description.length>350&&e.push(["description","too_long"]),e.length>0?_.object(e):void 0},o.prototype.parse=function(t){var e;return null!=(e=t.group)?e:t},o}(Backbone.Model)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty,i=function(t,e){return function(){return t.apply(e,arguments)}},r=[].slice;t=App.module("Views.Common"),t.ModalTitleHeader=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.template="modal_header",o.prototype.ui={title:".modal-header-title",closeButton:".modal-header-close"},o.prototype.events={"click @ui.closeButton":"onCloseClick"},o.prototype.initialize=function(t){return null==t&&(t={}),this.title=t.title,t},o.prototype.serializeData=function(){return{title:this.title}},o.prototype.onCloseClick=function(){return App.vent.trigger("modal:close")},o}(Marionette.ItemView),t.VotesWidget=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.template="votes_widget",o.prototype.className="votes_widget",o.prototype.ui={voteUp:"a.vote_up",voteDown:"a.vote_down"},o.prototype.behaviors={HasButtons:{"a.vote_up:not(.disabled)":"clickUp","a.vote_down:not(.disabled)":"clickDown"}},o.prototype.modelEvents={change:"updateVotes","change:score":"render"},o.prototype.onRender=function(){return this.updateVotes()},o.prototype.updateVotes=function(){return this.$el.toggleClass("up_voted",this.model.upvoted()),this.$el.toggleClass("down_voted",this.model.downvoted()),this.$(".vote_score").text(this.model.score())},o.prototype.clickUp=function(){var t;return null==App.currentUser?(t=new App.Views.SignupLoginModal({userAction:"groups_vote_up",startWithSignup:!0,benefits:"Join 500px discussion groups"}),this.listenTo(t,"signup:success",function(t){return function(){return t._voteUp(function(){return window.location.reload()})}}(this)),this.listenTo(t,"login:success",function(t){return function(){return t._voteUp(function(){return window.location.reload()})}}(this)),t.showModal()):this._voteUp(function(t){return function(){return t.$el.removeClass("loading")}}(this))},o.prototype._voteUp=function(t){return this.model.upvoted()?void 0:(this.$el.addClass("loading").find("a").addClass("disabled"),this.model.toggleUpVote().done(function(){return PxApp.GA.event({category:"Groups",action:"UpVote"}),t()}))},o.prototype.clickDown=function(){var t;return null==App.currentUser?(t=new App.Views.SignupLoginModal({userAction:"groups_vote_down",startWithSignup:!0,benefits:"Join 500px discussion groups"}),this.listenTo(t,"signup:success",function(t){return function(){return t._voteDown(function(){return window.location.reload()})}}(this)),this.listenTo(t,"login:success",function(t){return function(){return t._voteDown(function(){return window.location.reload()})}}(this)),t.showModal()):this._voteDown(function(t){return function(){return t.$el.removeClass("loading")}}(this))},o.prototype._voteDown=function(t){return this.model.downvoted()?void 0:(this.$el.addClass("loading").find("a").addClass("disabled"),this.model.toggleDownVote().done(function(){return PxApp.GA.event({category:"Groups",action:"DownVote"}),t()}))},o}(Marionette.ItemView),t.PostExtraActionsWidget=function(t){function o(){return this.toggleExtraActionsPane=i(this.toggleExtraActionsPane,this),o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.template="post_extra_actions_widget",o.prototype.className="post-extra-actions-widget",o.prototype.behaviors={HasButtons:{".translate:not(.pending)":"clickTranslate",".flag:not(.pending)":"clickFlag",".ban:not(.pending)":"clickBan",".delete:not(.pending)":{confirm:function(){return this.model.get("deleted")?!1:confirm(this.$(".delete").data("confirm"))},fn:"clickDelete"}}},o.prototype.ui={translateControl:".translate",flagControl:".flag",deleteControl:".delete",banControl:".ban"},o.prototype.modelEvents={"change:translated":"updateTranslateState","change:flagged":"updateFlaggedState","change:deleted":"updateDeleteState"},o.prototype.initialize=function(t){return null==t&&(t={}),o.__super__.initialize.call(this),null!=t.moreActionsButton?this.moreActionsButton=t.moreActionsButton:void 0},o.prototype.onRender=function(){return this.updateFlaggedState(),this.updateDeleteState(),this.updateTranslateState(),this.updateBanState(),this.bindResponsiveBehaviour()},o.prototype.bindResponsiveBehaviour=function(){return $("body").is(".smartphone,.tablet")?this.moreActionsButton.on("click",this.toggleExtraActionsPane):void 0},o.prototype.toggleExtraActionsPane=function(t){return t.preventDefault(),this.$el.parent().hasClass("open")?this.$el.parent().removeClass("open"):this.$el.parent().addClass("open")},o.prototype.onBeforeDestroy=function(){return this.moreActionsButton?this.moreActionsButton.off("click"):void 0},o.prototype.updateTranslateState=function(){return this.setControlState(this.ui.translateControl,this.model.get("translated"))},o.prototype.clickTranslate=function(){return this.model.get("translated")?this.model.showOriginalText():(this.setControlState(this.ui.translateControl,"pending"),this.model.translateText())},o.prototype.updateDeleteState=function(){return this.setControlState(this.ui.deleteControl,this.model.get("deleted"))},o.prototype.updateBanState=function(){return this.setControlState(this.ui.banControl,this.model.get("banned"))},o.prototype.clickDelete=function(){return this.setControlState(this.ui.deleteControl,"pending"),this.model["delete"]()},o.prototype.updateFlaggedState=function(){return this.setControlState(this.ui.flagControl,this.model.isFlagged())},o.prototype.clickBan=function(){var t,e;return e=this.model.getUser(),t=this.model.getGroup(),t.isBanned(e)?void 0:t.ban(e).done(function(t){return function(e){return t.model.set("deleted",!0),t.model.set("banned?",!0),t.render()}}(this))},o.prototype.clickFlag=function(){return this.model.isFlagged()?void 0:(this.setControlState(this.ui.flagControl,"pending"),this.model.flag())},o.prototype.setControlState=function(t,e){var o,i,r,n,s;if(t instanceof jQuery){for(e===!1||null==e?e="default":e===!0&&(e="alternate"),s=["default","pending","alternate"],i=0,r=s.length;r>i;i++)n=s[i],t.toggleClass(n,n===e);return o=t.find("a"),o.text(o.data("text-"+e)),t}},o}(Marionette.ItemView),t.BaseSubNav=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.className="subnav_wrapper",o}(Marionette.ItemView),t.GroupBaseSubNav=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.initialize=function(t){return this.group=t.group,this.listenTo(this.group,"change:is_member",this.onRender)},o}(t.BaseSubNav),t.SearchAndTabSelector=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.events={"submit form":"onFormSubmit","keyup @ui.searchInput":"onSearch","change @ui.searchInput":"onSearch"},o.prototype.behaviors={HasButtons:{"@ui.searchToggle":"toggleSearch","@ui.sourceButtons":"changeSelection"}},o.prototype.initialize=function(t){return null==t&&(t={}),this.registerListeners()},o.prototype.templateHelpers=function(){return{search:this.collection.search}},o.prototype.onRender=function(){return this.collection instanceof App.Collections.SearchResultGroups?this.select("search"):this.select(this.collection.source,this.collection.sortCriterion)},o.prototype.setCollection=function(t){return this.collection&&this.stopListening(this.collection),this.collection=t,this.registerListeners()},o.prototype.registerListeners=function(){return this.collection instanceof App.Collections.SearchResultGroups?this.listenTo(this.collection,"pagination:item_count_update",this.updateSearchResultsCount):void 0},o.prototype.changeSelection=function(t){var e,o,i,r,n;return e=$(t.currentTarget),i=e.data("loginRequired"),o=null!=(n=e.data("source"))?n:e.data("sort"),i&&null==App.currentUser?(r=new App.Views.SignupLoginModal({userAction:"groups_create",startWithSignup:!0,benefits:"Join 500px to participate in groups!"}),this.listenToOnce(r,"signup:success login:success",function(t){return function(){return e.click()}}(this)),r.showModal()):(this.ui.searchInput.length&&(this.ui.resultsCount.text(""),this.ui.searchInput.val("")),this.select(o),"function"==typeof this.selectionCallback?this.selectionCallback(o):void 0)},o.prototype.onFormSubmit=function(t){return t.preventDefault(),this.onSearch(t)},o.prototype.onSearch=function(t){var e;if(this.ui.searchInput.length&&(e=$.trim(this.ui.searchInput.val()),e!==this._lastQuery&&!_.isEmpty(e)))return this._lastQuery=e,this.deselectAll(),this._pendingSearch&&clearTimeout(this._pendingSearch),this._pendingSearch=_.delay(function(t){return function(){return"function"==typeof t.searchCallback?t.searchCallback(e):void 0}}(this),250)},o.prototype.toggleSearch=function(){return this.$el.toggleClass("show-textbox")},o.prototype.updateSearchResultsCount=function(){return this.ui.resultsCount.length?this.ui.resultsCount.text(this.collection.totalItems):void 0},o.prototype.select=function(){var t;return t=1<=arguments.length?r.call(arguments,0):[],this.ui.sourceButtons.each(function(){var e;return e=[$(this).data("source"),$(this).data("sort")],$(this).toggleClass("active",!_.chain(t).compact().intersection(e).isEmpty().value())}),!1},o.prototype.deselectAll=function(){return this.ui.sourceButtons.removeClass("active")},o}(Backbone.Marionette.ItemView),t.RadioSortSelector=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.ui={sortRadios:'input[type="radio"]'},o.prototype.events={"change @ui.sortRadios":"changeSort"},o.prototype.onRender=function(){return this.select(this.collection.sortCriterion)},o.prototype.changeSort=function(t){var e;return e=$(t.currentTarget).val(),"function"==typeof this.selectionCallback&&this.selectionCallback(e),!0},o.prototype.select=function(t){return this.ui.sortRadios.filter("[value='"+t+"']").prop("checked",!0)},o.prototype.deselectAll=function(){return this.ui.sortRadios.prop("checked",!1)},o}(Backbone.Marionette.ItemView),t.DropdownSortSelector=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.ui={sortSelect:"select"},o.prototype.events={"change @ui.sortSelect":"changeSort"},o.prototype.onRender=function(){return this.select(this.collection.sortCriterion)},o.prototype.changeSort=function(t){var e;return e=$(t.currentTarget).val(),"function"==typeof this.selectionCallback&&this.selectionCallback(e),!0},o.prototype.select=function(t){return this.ui.sortSelect.val(t)},o.prototype.deselectAll=function(){return this.ui.sortSelect.val("")},o}(Backbone.Marionette.ItemView)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Behaviors"),t.HasVotes=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.onRender=function(){return null==this.view.votes&&this.view.addRegion("votes",".votes"),this.view.votes.show(new App.Views.Common.VotesWidget({model:this.view.model}))},o}(Marionette.Behavior)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Behaviors"),t.HasPostExtraActions=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.onRender=function(){return this.view.$(".extra-actions").length>0?(null==this.view.extraActions&&this.view.addRegion("extraActions",".extra-actions"),this.view.extraActions.show(new App.Views.Common.PostExtraActionsWidget({model:this.view.model,moreActionsButton:this.view.$(".more-actions:first")}))):void 0},o}(Marionette.Behavior)}.call(this),function(){var t,e,o,i=function(t,e){function o(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},r={}.hasOwnProperty;o=App.module("Views"),e=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.tagName="li",e.prototype.template="post_top_reply",e}(Marionette.ItemView),t=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return i(o,t),o.prototype.tagName="ul",o.prototype.childView=e,o}(Marionette.CollectionView),o.PostsItem=function(e){function o(){return o.__super__.constructor.apply(this,arguments)}return i(o,e),o.prototype.template="post_list_item",o.prototype.tagName="li",o.prototype.className="post_item",o.prototype.behaviors={HasVotes:!0,HasPostExtraActions:!0,HasButtons:{"@ui.post":"clickPost","@ui.repliesInfo":"clickPost"},HasTooltips:{style:"post__tooltips"}},o.prototype.regions={topReplies:".top-replies"},o.prototype.ui={groupName:"h3.group_name",post:".post",replies:".replies",repliesInfo:".replies_info"},o.prototype.events={"click @ui.groupName":"clickGroup"
},o.prototype.initialize=function(t){var e;return this.group=null!=(e=t.group)?e:new App.Groups.Models.Group(this.model.get("group"))},o.prototype.clickPost=function(t){var e;return e=$(t.target),e.is("a.actor")||e.is("a.vote_up")||e.is("a.vote_down")||e.is("h3.group_name")?!0:(t.preventDefault(),App.vent.trigger("navigate:show-post",this.model),PxApp.GA.pageview(App.postPath(this.model)))},o.prototype.clickGroup=function(t){return t.preventDefault(),App.vent.trigger("navigate:show-group",this.model.get("group"))},o.prototype.templateHelpers=function(){var t;return{post_url:App.postPath(this.model),attachment_count:this.model.getActiveAttachmentsCount(),badge_admin:this.model.postOwnerId()===this.group.get("created_by").id,free:"free"===(null!=(t=this.model.get("class"))?t.class_type:void 0),inSession:this.model.isClassInSession(),officeHour:this.model.classOfficeHour()}},o.prototype.onShow=function(){var e;return null==this.$body&&(this.$body=this.$(".body")),this.$body.text(this.model.get("body")).dotdotdot(),$(window).on("resize",this.updateBodyDotdotdot),this.model.getActiveAttachmentsCount()&&this.$el.addClass("post_with_attachments"),e=this.model.getTopReplies(2),this.topReplies.show(new t({collection:e}))},o.prototype.onDestroy=function(){return $(window).off("resize",this.updateBodyDotdotdot)},o.prototype.updateBodyDotdotdot=_.debounce(function(){return null==this.$body&&(this.$body=this.$(".body")),this.$(".body").trigger("update")}),o}(Backbone.Marionette.LayoutView),o.MyDiscussionsPostsItem=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.template="my_discussions_post_list_item",e}(o.PostsItem),o.UpdatesPostsItem=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.className="post_item",e}(o.PostsItem)}.call(this),function(){var t,e,o,i=function(t,e){return function(){return t.apply(e,arguments)}},r=function(t,e){function o(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},n={}.hasOwnProperty;o=App.module("Behaviors"),e=$(window),t=$(document),o.InfiniteScroll=function(t){function o(){return this.scrollWatch=i(this.scrollWatch,this),this._attachHtml=i(this._attachHtml,this),o.__super__.constructor.apply(this,arguments)}return r(o,t),o.prototype.initialize=function(t){var o,i,r,n;return null==t&&(t={}),this._inProgressClass=null!=(o=t.inProgressClass)?o:"in_progress",this._finishedClass="pagination_finished",this._queryString=null!=(i=t.queryString)?i:!0,this.reverse=null!=(r=t.reverse)?r:!1,this._loadingContainerClass=t.loadingContainerClass,this.$scrollContainer=null!=(n=t.container)?n:e,this.reverse&&(this.view.attachHtml=this._attachHtml),this.listenTo(this.view,"infinite_scroll:pause",function(t){return function(){return t.pauseInfiniteScroll=!0}}(this)),this.listenTo(this.view,"infinite_scroll:continue",function(t){return function(){return t.pauseInfiniteScroll=!1}}(this)),this.listenTo(this.view,"infinite_scroll:fetch_next",function(t){return function(){return t._fetchNextPage()}}(this))},o.prototype._attachHtml=function(t,e,o){var i,r,n;return r=this._getScrollContainer().prop("scrollHeight"),0>=o?t.$el.find(t.childViewContainer).append(e.el):t.children.findByIndex(o-1).$el.before(e.el),i=this._getScrollContainer().prop("scrollHeight"),n=$(e.el).height(),this._getScrollContainer().scrollTop(this._getScrollContainer().scrollTop()+n)},o.prototype._getScrollContainer=function(){return $.isFunction(this.$scrollContainer)?this.$scrollContainer.apply(this.view):this.$scrollContainer},o.prototype.onDestroy=function(){return this._unbindScroll()},o.prototype.onRender=function(){return this.$el.addClass("infinite_scroll_container")},o.prototype._onRequest=function(){return this._isViewRendered()?(this._unbindScroll(),this._addInProgressClass(),this._appendLoadingBar()):void 0},o.prototype._onSync=function(){return this._isViewRendered()?(this._bindScroll(),this._removeInProgressClass(),this._appendLoadingBar(),this._prependWarningBar()):void 0},o.prototype._isViewRendered=function(){return this.view.isRendered||this.view._isRendered},o.prototype.onShow=function(){return this.view.collection.fetching()?this._onRequest():this._onSync(),this._bindScroll(),this.view.collection.finished()&&this.$el.addClass(this._finishedClass),this.view.collection.singlePage()&&this.$el.addClass("single_page"),this.currentPage=this.view.collection.page},o.prototype.scrollWatch=function(){var t,o,i,r,n;if(t=this._getScrollContainer(),i=!this.view.collection.finished(),this.reverse){if(t[0]===e[0]){if(!this.$loadingEl)return;r=e.innerHeight(),n=e.scrollTop(),i&&(i=n<this.$loadingEl.offset().top+this.$loadingEl.height()+2*r)}else null==this._pageOneHeight&&(this._pageOneHeight=t.prop("scrollHeight")),o=t.scrollTop(),i&&(i=o<this._pageOneHeight/2);return i&&this._fetchNextPage(o),this._updateQueryString(o)}if(t[0]===e[0]){if(!this.$loadingEl)return;r=e.innerHeight(),n=e.scrollTop()+r,i&&(i=n>this.$el.height()-2*r)}else null==this._pageOneHeight&&(this._pageOneHeight=t.prop("scrollHeight")),o=t.scrollTop()+t.height(),i&&(i=o>t.prop("scrollHeight")-this._pageOneHeight/2);return i&&this._fetchNextPage(o),this._updateQueryString(o)},o.prototype._fetchNextPage=function(t){var e;if(!this.pauseInfiniteScroll)return e=this.$loadingEl.offset().top-this.$container.offset().top,this.view.collection.nextPage().done(function(o){return function(i,r){return o._addBreakPoint(i,e),o._updateQueryString(t)}}(this))},o.prototype._addBreakPoint=function(t,e){return this._pageBreakPoints||(this._pageBreakPoints={},this._pageBreakPoints[this.view.collection.getFirstPage()]=0),this._pageBreakPoints[t]=e},o.prototype._updateQueryString=function(t){var e,o,i,r;if(this._pageBreakPoints){o=0,r=this._pageBreakPoints;for(i in r){if(e=r[i],!(t>e&&parseInt(i,10)>parseInt(o,10)))break;o=i}return o!==this.currentPage&&o>0&&(this.currentPage=o,this._queryString)?App.vent.trigger("paginate",this.currentPage,this.view.collection):void 0}},o.prototype._appendLoadingBar=function(){var t,o,i,r,n;return t=null!=(o=this.view.$childViewContainer)?o:this.view.$el,this.$container!==t&&(null!=(i=this.$loadingEl)&&i.remove(),null!=(r=this.$warningEl)&&r.remove(),this.$loadingEl=this.$warningEl=null),this.$container=t,this.$container?(this.$loadingEl||(this.$loadingEl=$("UL"===this.$container.prop("tagName")?"<li>":"<div>"),this.$loadingEl.addClass("infinite_scroll_loader"),this._loadingContainerClass&&this.$loadingEl.addClass(this._loadingContainerClass),this.$loadingEl.html(Marionette.Renderer.render("infinite_loading")),this.$loadingEl.on("click","a",function(t){return function(o){return o.preventDefault(),t._getScrollContainer().scrollTop(0),$("body").trigger("scroll"),e.trigger("scroll"),e.trigger("mousewheel")}}(this))),this.reverse?this.$loadingEl.prependTo(this.$container):this.$loadingEl.appendTo(this.$container),n=this._isCursorPagination()?this.view.collection.finished():null!=this.view.collection.totalPages&&this.view.collection.totalPages<=1,this.$el.toggleClass("single_page",n)):void 0},o.prototype._prependWarningBar=function(){var t,e,o;if(!this._isCursorPagination&&this.$container){if(this._isCursorPagination()){if(null===(null!=(t=this.view.collection.getFirstPage())?t:null))return}else if(1===(null!=(e=this.view.collection.getFirstPage())?e:1))return;return this.$warningEl||(this.$warningEl=$("UL"===this.$container.prop("tagName")?"<li>":"<div>"),this.$warningEl.addClass("infinite_scroll_warning"),o=window.location.href.replace(/\bpage=\d\b/,"page=1"),this.$warningEl.html(Marionette.Renderer.render("infinite_warning",{url:o,page:this.view.collection.getFirstPage(),total:this.view.collection.totalPages}))),this.$container.before(this.$warningEl)}},o.prototype._bindScroll=function(){return this._getScrollContainer().on("scroll",this.scrollWatch)},o.prototype._unbindScroll=function(){return this._getScrollContainer().off("scroll",this.scrollWatch)},o.prototype._addInProgressClass=function(){var t,e;if(!this.$el.hasClass(this._inProgressClass))return e=this._getScrollContainer().prop("scrollHeight"),this.$el.addClass(this._inProgressClass),t=this._getScrollContainer().prop("scrollHeight"),this.loadingElOffset=t-e,this.reverse?this._getScrollContainer().scrollTop(this._getScrollContainer().scrollTop()+this.loadingElOffset):void 0},o.prototype._removeInProgressClass=function(){return this.$el.hasClass(this._inProgressClass)?(this.$el.removeClass(this._inProgressClass),this.reverse&&this._getScrollContainer().scrollTop()+this._getScrollContainer().height()!==this._getScrollContainer().prop("scrollHeight")?this._getScrollContainer().scrollTop(this._getScrollContainer().scrollTop()-this.loadingElOffset):void 0):void 0},o.prototype._isCursorPagination=function(){return this.view.collection.cursorPagination},o.prototype.collectionEvents={request:"_onRequest",sync:"_onSync",add:function(){return this._isViewRendered()?_.delay(function(t){return function(){return t._appendLoadingBar()}}(this)):void 0},"pagination:end":function(){return this._isViewRendered()?this.$el.addClass(this._finishedClass):void 0},"before:reset":function(){return this._unbindScroll(),this._appendLoadingBar(),this._removeInProgressClass(),this.$el.removeClass(this._finishedClass,"single_page")}},o}(Marionette.Behavior)}.call(this),function(){var e,o,i,r,n,s,a,l,u,p,c,h,d,g,f=function(t,e){function o(){this.constructor=t}for(var i in e)m.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},m={}.hasOwnProperty,y=function(t,e){return function(){return t.apply(e,arguments)}};e=$(window),g=App.module("Views"),g.GroupSubNav=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return f(e,t),e.prototype.template="group_subnav",e.prototype.initialize=function(t){var e;return null==t&&(t={}),this.mode=null!=(e=t.mode)?e:"discussions",this.listenTo(this.model,"change:is_member",this.setMembershipClass)},e.prototype.behaviors={HasButtons:{"a.discussions":{trigger:"groups:show:discussions"},"a.photos":{trigger:"groups:show:photos"},"a.members":{trigger:"groups:show:members"}},HasSubscriptionButtons:!0},e.prototype.ui={newPost:"a.new_post",discussions:"a.discussions",photos:"a.photos",members:"a.members"},e.prototype.serializeData=function(){return _.extend(e.__super__.serializeData.apply(this,arguments),{group_url:App.groupPath(this.model),group_photos_url:App.groupPath(this.model,{mode:"photos"}),group_members_url:App.groupPath(this.model,{mode:"members"})})},e.prototype.onRender=function(){var t,e;return this.ui.discussions.toggleClass("active","discussions"===this.mode),this.ui.photos.toggleClass("active","photos"===this.mode),this.ui.members.toggleClass("active","members"===this.mode),"photos"===this.mode?(t=this.ui.newPost.data("text-new-photo"),e=App.newPhotoPath(this.model)):(t=this.ui.newPost.data("text-default"),e=App.newPostPath(this.model)),this.ui.newPost.text(t).attr("href",e),this.setMembershipClass()},e.prototype.setMembershipClass=function(){return this.$el.toggleClass("subscribed",this.model.subscribed())},e.prototype.onShow=function(){return App.setTitle(this.model.get("name")+" - "+this.mode)},e}(g.Common.GroupBaseSubNav),g.GroupShowView=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return f(i,e),i.prototype.className="group_show_view",i.prototype.template="group_show_view",i.prototype.regions={sidenavRegion:".groups_sidenav",main:".group_main",moderatorsRegion:".moderators_region"},i.prototype.ui={inviteFollowersButton:"a.invite_followers"},i.prototype.events={"click @ui.inviteFollowersButton":"inviteFollowers"},i.prototype.behaviors={HasShareButtons:{category:"Group share",url:function(){return App.groupUrl(this.model)}}},i.prototype.initialize=function(t){var e;return null==t&&(t={}),this.mode=t.mode,"discussions"!==(e=this.mode)&&"photos"!==e&&"members"!==e?this.mode="discussions":void 0},i.prototype.onShow=function(){var t;switch(this.mode){case"members":t=new s({model:this.model,collection:this.collection}),this.$(this.sidenavRegion.el).hide();break;case"photos":t=new l({model:this.model,collection:this.collection}),this.sidenavRegion.show(new a({collection:this.collection,mode:this.mode}));break;case"discussions":t=new App.Views.GroupPostList({model:this.model,collection:this.collection}),this.sidenavRegion.show(new o({collection:this.collection,mode:this.mode}))}return this.main.show(t),this.moderatorList=new d({collection:new Backbone.Collection([this.model.getUser()])}),this.moderatorsRegion.show(this.moderatorList),null==this._equalColumns&&(this._equalColumns=this.$(".group_sidebar, .group_main")),this.listenTo(t,"add:child",function(t){return function(){return t._equalColumns.equalHeights()}}(this)),App.currentUser&&0!==App.currentUser.attributes.followers_count?void 0:this.ui.inviteFollowersButton.addClass("disabled")},i.prototype.inviteFollowers=function(){var t;return this.ui.inviteFollowersButton.hasClass("disabled")?!1:(t=new n({collection:new App.Groups.Collections.Followers,group:this.model}),t.showModal())},i.prototype.pinterestShareData=function(){var e,o;return{media:null!=(e=this.model.get("avatars"))&&null!=(o=e["100x100"])?o.url:void 0,description:t("ui.sharelizers.group.pinterest.message",{group_name:this.model.get("name"),group_url:App.groupUrl(this.model)})}},i.prototype.twitterShareData=function(){return{text:t("ui.sharelizers.group.twitter.message",{group_name:this.model.get("name")})}},i.prototype.emailShareData=function(){return{subject:t("ui.sharelizers.group.email.subject",{group_name:this.model.get("name")}),body:t("ui.sharelizers.group.email.body",{group_name:this.model.get("name"),group_url:App.groupUrl(this.model)})}},i}(Backbone.Marionette.LayoutView),p=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return f(e,t),e.prototype.ui={searchInput:".search_input input",resultsCount:".search_input .results-count",sourceButtons:"li a"},e.prototype.selectionCallback=function(t){return this.collection.sortCriterion=t,this.collection.reset(),App.vent.trigger("navigate:show-group")},e}(g.Common.SearchAndTabSelector),a=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return f(e,t),e.prototype.template="group_photo_sidebar_sort_selector",e}(p),o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return f(e,t),e.prototype.template="group_discussion_sidebar_sort_selector",e}(p),h=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return f(e,t),e.prototype.template="moderator_item_view",e}(Backbone.Marionette.ItemView),d=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return f(e,t),e.prototype.tagName="ul",e.prototype.className="moderators",e.prototype.childView=h,e}(Backbone.Marionette.CollectionView),c=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return f(e,t),e.prototype.template="group_member_grid_item",e.prototype.className="group_grid_item group_member_grid_item",e.prototype.onShow=function(){var t,e;return e=null!=(t=this.model.get("top_photo_urls"))?t[3]:void 0,this.$el.css("background-image","url("+e+")"),this.$(".profile").css("background-image","url("+this.model.get("userpic_url")+")")},e}(Backbone.Marionette.LayoutView),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return f(e,t),e.prototype.template="empty_post_list",e.prototype.className="empty_collection_view",e.prototype.tagName="li",e.prototype.events={"click .empty_wrapper .button":"clickNewPost"},e.prototype.serializeData=function(){return _.extend(e.__super__.serializeData.apply(this,arguments),{new_post_url:App.newPostPath(this.options.group)})},e.prototype.onRender=function(){return this.$(".empty_wrapper").hide(),this.$(".empty_wrapper."+this.options.mode).show()},e.prototype.clickNewPost=function(t){return t.preventDefault(),App.vent.trigger("navigate:new-post",this.group)},e}(Marionette.ItemView),g.GroupPostList=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return f(e,t),e.prototype.template="group_post_list",e.prototype.childView=g.PostsItem,e.prototype.childViewContainer="ul.posts",e.prototype.childViewOptions=function(){return{group:this.model,mode:"posts"}},e.prototype.emptyView=i,e.prototype.behaviors={InfiniteScroll:!0},e.prototype.modelEvents={"change:is_member":"onRender"},e.prototype.className=function(){return this.collection.withAttachments?"group_photo_list":"group_post_list"},e.prototype.ui={sortSelect:"select.group_sort"},e.prototype.events={"change @ui.sortSelect":"changeSort"},e.prototype.changeSort=function(){return this.collection.sortCriterion=this.ui.sortSelect.val(),this.collection.reset(),App.vent.trigger("navigate:show-group")},e.prototype.onRender=function(){return this.$el.toggleClass("subscribed",this.model.subscribed()),this.ui.sortSelect.val(this.collection.sortCriterion)},e.prototype.pauseInfiniteScroll=function(){return this.trigger("infinite_scroll:pause")},e.prototype.continueInfiniteScroll=function(){return this.trigger("infinite_scroll:continue")},e}(Backbone.Marionette.CompositeView),s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return f(e,t),e.prototype.template="group_member_grid",e.prototype.className="group_member_grid",e.prototype.childView=c,e.prototype.childViewContainer=".members",e.prototype.behaviors={InfiniteScroll:!0},e}(Backbone.Marionette.CompositeView),u=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return f(e,t),e.prototype.template="group_photos_grid_item",e.prototype.className="group_grid_item group_photos_grid_item",e.prototype.ui={favorite:".action-button.favorite",voteCount:".action-button.favorite .count",photo:".photo .thumbnail_link"},e.prototype.events={"click @ui.favorite":"clickFavorite","click @ui.photo":"clickPhoto"},e.prototype.modelEvents={"change:voted":"onRender"},e.prototype.onRender=function(){return this.ui.favorite.toggleClass("active",this.model.get("voted")),this.ui.voteCount.text(this.model.score())},e.prototype.clickFavorite=function(t){return t.preventDefault(),App.vent.trigger("action:favorite-photo",this.model)},e.prototype.clickPhoto=function(t){return t.preventDefault(),this.photoModal=new App.Groups.Views.PhotoFocusModal({fetchMore:!1,displayControls:!0,collection:this.model.collection,curPostIndex:this.model.collection.indexOf(this.model),curAttachmentIndex:0}),this.photoModal.showModal()},e}(Backbone.Marionette.LayoutView),l=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return f(o,t),o.prototype.template="group_photos_grid",o.prototype.className="group_photos_grid",o.prototype.childView=u,o.prototype.childViewContainer=".photos",o.prototype.childViewOptions=function(){return{group:this.model,mode:"photos"}},o.prototype.emptyView=i,o.prototype.behaviors={InfiniteScroll:!0},o.prototype.ui={sortSelect:"select.group_sort"},o.prototype.events={"change @ui.sortSelect":"changeSort"},o.prototype.collectionEvents={scroll:"scrollToShow"},o.prototype.scrollToShow=function(t){return e.scrollTop(this.$(".group_photos_grid_item").eq(t).offset().top)},o.prototype.changeSort=function(){return this.collection.sortCriterion=this.ui.sortSelect.val(),this.collection.reset(),App.vent.trigger("navigate:show-group",this.group)},o.prototype.onRender=function(){return this.$el.toggleClass("subscribed",this.model.subscribed()),this.ui.sortSelect.val(this.collection.sortCriterion)},o}(Backbone.Marionette.CompositeView),r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return f(e,t),e.prototype.template="group_invite_modal_follower",e.prototype.tagName="li",e.prototype.className="group_invite_follower",e.prototype.ui={selectCheck:".invite_checkbox"},e.prototype.events={click:"toggleSelect"},e.prototype.onShow=function(){return this.options.selectAll?this.ui.selectCheck.addClass("checked"):void 0},e.prototype.toggleSelect=function(t){return $(t.target).is("a,img")||this.ui.selectCheck.toggleClass("checked"),!0},e}(Marionette.ItemView),n=function(t){function o(){return this.resize=y(this.resize,this),o.__super__.constructor.apply(this,arguments)}return f(o,t),o.prototype.template="group_invite_modal",o.prototype.className="group_invite_modal",o.prototype.childView=r,o.prototype.childViewContainer="ul.followers",o.prototype.childViewOptions=function(){return{selectAll:this.selectAll}},o.prototype.ui={inviteButton:"a.invite-button",cancelButton:"a.cancel-button",selectAllCheck:"#select_all"},o.prototype.behaviors={ModalDialog:{dialogClass:"group_invite_modal",closeButton:!1},HasButtons:{"@ui.cancelButton":"clickCancel","@ui.inviteButton":"clickInvite"},InfiniteScroll:{container:function(){return this.$(this.childViewContainer)}}},o.prototype.initialize=function(t){return this.group=t.group,this.selectAll=!1},o.prototype.events={"click @ui.selectAllCheck":"selectAllToggle","click .modal_header_close":"clickCancel"},o.prototype.selectAllToggle=function(){return this.ui.selectAllCheck.toggleClass("checked"),this.selectAll=this.ui.selectAllCheck.hasClass("checked"),this.$(".invite_checkbox").toggleClass("checked",this.selectAll),!0},o.prototype.clickCancel=function(){return this.destroyModal()},o.prototype.clickInvite=function(){var t,e;return e=this.selectAll?"followers":function(){var e,o,i,r;for(i=this.$(".invite_checkbox.checked"),r=[],e=0,o=i.length;o>e;e++)t=i[e],r.push($(t).attr("value"));return r}.call(this).join(","),this.group.invite(e),this.destroyModal()},o.prototype.resize=function(){var t,o;return t=450,o=e.width()-23,t>o&&(t=o),this.$el.width(t),this.trigger("resize")},o.prototype.onShow=function(){return this.collection.fetch()},o}(Marionette.CompositeView)}.call(this),function(){var t,e=[].indexOf||function(t){for(var e=0,o=this.length;o>e;e++)if(e in this&&this[e]===t)return e;return-1};t="undefined"!=typeof App&&null!==App?App:window,t.currentPath=function(){return window.location.href.replace(/^https?:\/\/.*?(\/.*)$/,"$1")},t.updatePaginationParam=function(o,i){return o=0|o,null==i&&(i=t.currentPath()),i.match(/\bpage=\d+\b/)?1>=o?(i=i.replace(/\?page=\d+$/,""),i=i.replace(/\?page=\d+&/,"?"),i.replace(/&page=\d+\b/,"")):i.replace(/([?&])page=\d+/,"$1page="+o):1===o?i:""+i+(e.call(i,"?")>=0?"&":"?")+"page="+o}}.call(this),function(){var t,e;t="undefined"!=typeof App&&null!==App?App:window,t.groupsPath=function(t){var o,i,r,n;return null==t&&(t={}),n={updates:"/groups",discovery:"/groups/discovery",my_groups:"/groups/my",my_discussions:"/groups/my/discussions",my_comments:"/groups/my/comments"},i=e(t),r=i.source,o=r&&n[r]?(delete i.source,n[r]):"/groups",_.isEmpty(i)?o:o+"?"+$.param(i)},t.newGroupPath=function(){return"/groups/new"},t.groupPath=function(t,e){var o,i,r,n,s,a,l;return null==e&&(e={}),o=e.mode,i=e.page,l=e.sort,(""===l||"popular"===l)&&(l=null),(""===i||1===i)&&(i=null),o=o&&"discussions"!==o?"/"+o:"",r={},i&&i>1&&(r.page=i),l&&(r.sort=l),a=null!=(n=null!=(s=t.slug)?s:"function"==typeof t.get?t.get("slug"):void 0)?n:t,i||l?"/groups/"+a+o+"?"+$.param(r):"/groups/"+a+o},t.groupUrl=function(){return"https://500px.com"+t.groupPath.apply(t,arguments)},t.groupEditPath=function(t){var e;return e=null!=t.get?t.get("slug"):t,"/groups/"+e+"/edit"},t.groupEditUrl=function(){return"https://500px.com"+t.groupEditPath.apply(t,arguments)},t.postPath=function(t,e){var o,i,r;return null==e&&(e={}),o="",(null!=(r=e.page)?r:1)>1&&(o="?page="+e.page),null!=e.returnTo&&(o+=o?"&":"?",o+="return_to="+e.returnTo),i="/groups/"+t.get("group_slug")+"/"+t.id+"/"+t.slug()+o,e.reply?i+"#"+e.reply:i},t.editPostPath=function(t){return"/groups/"+t.get("group_slug")+"/"+t.id+"/"+t.slug()+"/edit"},t.postUrl=function(){return"https://500px.com"+t.postPath.apply(t,arguments)},t.newPostPath=function(t){return"/groups/"+t.get("slug")+"/posts/new"},t.newPostUrl=function(){return"http://500px.com"+t.newPostPath.apply(t,arguments)},t.newPhotoPath=function(t){return"/groups/"+t.get("slug")+"/photos#new"},e=function(t){var e,o,i,r,n,s;return s=t.source,r=t.search,e=t.page,n=null!=(i=t.sortCriterion)?i:t.sort,o={},null!=s&&"groups"!==s&&(o.source=s),r&&(o.search=r),n&&(o.sort=n),e&&e>1&&(o.page=e),o}}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Views"),t.MessageModal=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}var i;return e(o,t),o.prototype.template="message_modal",o.prototype.className="message_modal",i=2e3,o.prototype.ui={cancelBtn:".message_modal__close_btn",charCounter:".message_modal__contact_form_char_count",msgSubject:".message_modal__contact_form_subject",msgBody:".message_modal__contact_form_message_body",sendBtn:".message_modal__send_btn"},o.prototype.behaviors={ModalDialog:{closeButton:".close",closeOnEsc:!0},HasButtons:{"@ui.sendBtn":"_onClickSend"}},o.prototype.GA={category:"Directory",label:"Message Modal"},o.prototype.events={"keyup @ui.msgBody":"_onCharCountChange"},o.prototype.templateHelpers=function(){var t;return{avatarUrl:null!=(t=this.model.get("avatars").large)?t.https:void 0,coverUrl:this.model.get("cover_url"),fullname:this.model.get("fullname"),languages:_.pluck(this.photographer.get("languages"),"name"),location:this.photographer.get("location").formatted_address,maxCharCount:i,needsContactVerification:this.currentUser.get("needs_contact_verification"),verificationUrl:PxApp.Constants.MAIN_500PX_URL+"/settings/contact_verification"}},o.prototype.initialize=function(t){if(this.photographer=t.photographer,null==this.photographer)throw"Photographer model is missing";return this.currentUser=new App.Models.User(JSON.parse(PxCurrentUser.user))},o.prototype.onShow=function(){return this.currentUser.get("needs_contact_verification")?void 0:$(this.ui.msgSubject).focus()},o.prototype.onCloseModal=function(){return this._sendGAEvent({action:"Message Cancelled",value:this.model.get("id")}),this._sendAmplitudeEvent("cancel")},o.prototype._onCharCountChange=function(){var t;return t=$(this.ui.msgBody).val().length,$(this.ui.charCounter).text(i-t)},o.prototype._onClickSend=function(){var t,e;return this.ui.sendBtn.toggleClass("disabled").i18n("sending"),e=PxApp.Constants.API_URL+"/directory/message",t={recipient_id:this.model.id,subject:this.ui.msgSubject.val(),body:this.ui.msgBody.val()},$.post(e,t).done(function(t){return function(e){return t._sendGAEvent({action:"Message Sent",value:t.model.get("id")}),t._sendAmplitudeEvent("send",{recipient:t.model.get("id"),sender:t.currentUser.get("id")}),t.destroyModal(),App.Flash.success(t.ui.sendBtn.i18n("success",{email:t.currentUser.get("email"),"return":!0}))}}(this)).fail(function(t){return function(e){return t.ui.sendBtn.toggleClass("disabled").i18n("failure"),App.Helpers.API.AjaxErrorHandler(e)}}(this))},o.prototype._sendGAEvent=function(t){var e;return null==t&&(t={}),e=_.extend({},this.GA,t),PxApp.GA.event(e)},o.prototype._sendAmplitudeEvent=function(t,e){var o,i;return null==e&&(e={}),"cancel"===t&&null!=(o=window.AmplitudeLogger)&&o.directoryEvent.modalCancel(),"send"===t&&null!=(i=window.AmplitudeLogger)?i.directoryEvent.modalSend(e.recipient,e.sender):void 0},o}(Marionette.LayoutView)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Models"),t.Photographer=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.baseUrl=function(){return PxApp.Constants.API_URL+"/photographers/"+this.get("id")},o.prototype.url=function(){return this.bootstrapMode?this.baseUrl()+"/bootstrap":this.baseUrl()},o.prototype.initialize=function(t){var e;return null==t&&(t={}),null!=t.id&&(this.id=t.id),this.bootstrapMode=null!=(e=t.bootstrapMode)?e:!1},o.prototype.parse=function(t){var e;return null!=(e=t.photographer)?e:t},o.prototype.getAvatarUrl=function(){return this.get("avatar_urls").large},o.prototype.setAvatarUrl=function(t){return this.get("avatar_urls").large=t,this.trigger("change:avatar_url")},o.prototype.getAvatarVersion=function(){return this.get("avatar_version")},o.prototype.getUser=function(){return new App.Models.User(this.get("user"))},o}(Backbone.Model)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Views"),t.HireButton=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.template="hire_button",o.prototype.events={"click .hire-button":"_onClick"},o.prototype.GA={category:"Directory"},o.prototype.initialize=function(t){var e;return this.GA=_.extend({},this.GA,{label:t.gaLabel,action:t.gaAction||"Hire Button Pressed",value:this.model.get("id")}),this.photographer=t.photographer,this.buttonStyle=null!=(e=t.buttonStyle)?e:"tertiary"},o.prototype.templateHelpers=function(){return{buttonStyle:this.buttonStyle}},o.prototype._getPhotographer=function(){var t;return t=$.Deferred(),null!=this.photographer?t.resolve(this.photographer):(this.photographer=new App.Models.Photographer({id:this.model.id}),this.photographer.fetch().done(function(){return t.resolve(this.photographer)})),t.promise()},o.prototype._onClick=function(){var t;return this._sendGAEvent(),this._sendAmplitudeEvent(),null!=App.currentUser?this._getPhotographer().done(function(t){return function(e){return t.messageModal=new App.Views.MessageModal({model:t.model,photographer:e}),t.messageModal.showModal()}}(this)):(t=new App.Views.SignupLoginModal({userAction:"message_photographer",startWithSignup:!0}),this.listenToOnce(t,"signup:success login:success",function(){return window.location.reload()}),t.showModal())},o.prototype._sendGAEvent=function(t){var e;return null==t&&(t={}),e=_.extend({},this.GA,t),PxApp.GA.event(e)},o.prototype._sendAmplitudeEvent=function(){var t;return null!=(t=window.AmplitudeLogger)?t.directoryEvent.hireClicked(this.GA.action,this.GA.label):void 0},o}(Marionette.ItemView)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Views"),t.UserCard=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.tagName="div",o.prototype.template="user_card",o.prototype.className="user_card px_card small",o.prototype.behaviors={HasFollowButton:{model:function(){return this.model.getUser()},buttonStyle:function(){return this._followButtonStyle()}}},o.prototype.regions={hireButtonRegion:".user_card__hire_button_region"},o.prototype.initialize=function(t){var e;if(null==t&&(t={}),!$.isFunction(this.model.getUser))throw"The model passed-in must conform to the interface with getUser() helper";return this.page=t.page,this.backgroundImageUrl=t.backgroundImageUrl,this.morePhotosFromUser=t.morePhotosFromUser,this.source=t.source,this.statsTrackingMetadata=t.statsTrackingMetadata,this.backgroundImageUrl||(this.backgroundImageUrl=null!=(e=this.model.getUser().get("thumbnail_photo"))?e.image_url:void 0),this.backgroundImageUrl||(this.backgroundImageUrl=this.model.getUser().get("cover_url")),this.behaviors.HasFollowButton.statsTracking={source:this.source,metadata:this.statsTrackingMetadata}},o.prototype.templateHelpers=function(){var t;return t=$.trim(this.model.getUser().get("firstname")||""),""===t&&(t=this.model.getUser().get("username")),_.extend(this.model.getUser().toJSON(),{userProfilePath:this._userProfilePath(),backgroundImageUrl:this.backgroundImageUrl,morePhotosFromUser:this.morePhotosFromUser,nickname:t})},o.prototype.onRender=function(){var t,e,o;return this.morePhotosFromUser&&this.$el.addClass("more_photos_from_user"),this.model.getUser().isContactable()?(this.model instanceof App.Models.Photographer&&(o=this.model),t=this.page?this.page+" Search":"People Search",e=new App.Views.HireButton({model:this.model.getUser(),photographer:o,buttonStyle:this._hireButtonStyle(),gaLabel:t}),this.hireButtonRegion.show(e)):void 0},o.prototype._userProfilePath=function(){var t,e,o;return o=function(){switch(this.page){case"directory":return"services"}}.call(this),e={source:this.source,medium:null!=(t=this.statsTrackingMetadata)?t.medium:void 0
},userPath(this.model.getUser(),o,e)},o.prototype._followButtonStyle=function(){switch(this.page){case"directory":return"tertiary";default:return"regular"}},o.prototype._hireButtonStyle=function(){switch(this.page){case"directory":return"regular";default:return"tertiary"}},o}(Marionette.LayoutView)}.call(this),function(){var t,e,o=function(t,e){function o(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},i={}.hasOwnProperty;e=App.module("Views"),t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.template="carousel_info_card",e.prototype.className="carousel_info_card",e.prototype.ui={heading:"h2",cta:".cta"},e.prototype.initialize=function(t){return this.options=t},e.prototype.templateHelpers=function(){return{url:this.options.url}},e.prototype.onRender=function(){return this.ui.heading.i18n(this.options.translationKey.replace(/_/g,"-")+"-heading"),this.ui.cta.i18n(this.options.translationKey.replace(/_/g,"-")+"-cta")},e}(Marionette.ItemView),e.Carousel=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return o(i,e),i.prototype.template="carousel",i.prototype.className="carousel",i.prototype.childViewContainer=".carousel__content",i.prototype.getChildView=function(t){switch(t.modelName){case"App.Photos.Models.PhotoMembership":return App.Photos.Views.PhotoItem;case"App.Photos.Models.UserMembership":return App.Views.UserCard;case"App.Models.Gallery":return App.Views.GalleryCardView;case"App.Classes.Models.Course":return App.Classes.Views.ClassCardView}},i.prototype.childViewOptions=function(){return{maxRowHeight:!0,eventName:"showPhoto",hasHoverState:!0,waitThumbnailsLoad:!0,showTitle:!1,hasVisibleCredits:!1,showPulse:!1,source:this.options.source,statsTrackingMetadata:this.options.statsTrackingMetadata,fixedHeight:null!=this.options.fixedHeight?this.options.fixedHeight:void 0,includeAvatar:!0,allowLinkClickEvents:!0}},i.prototype.initialize=function(e){var o,i,r,n;return this.options=e,null==(o=this.options).dots&&(o.dots=!0),null==(i=this.options).infoCardView&&(i.infoCardView=t),null==(r=this.options).slickOptions&&(r.slickOptions={}),n=this.options.showInfoCard?this.collection.length+1:this.collection.length,n>2&&n%2!==0?this.collection.pop():void 0},i.prototype.onRender=function(){var t,e;return this.collection.length>0&&this.options.showInfoCard&&(e=new this.options.infoCardView(this.options),e.render(),t=_.max([this.children.length-2,0]),this.children.findByIndex(t).$el.after(e.el)),this.children.each(function(t){return t.trigger("imageSrc::update")})},i.prototype.onAttach=function(){var t,e;return t={variableWidth:!0,slidesToShow:_.max([this.children.length-1,1]),slidesToScroll:2,infinite:!0,accessibility:!1,nextArrow:'<span class="carousel__arrow carousel__arrow--next"></span>',prevArrow:'<span class="carousel__arrow carousel__arrow--prev"></span>',dots:this.options.dots},e=_.extend(t,this.options.slickOptions),this.collection.length>0?this.$(".carousel__content").slick(e):void 0},i}(Marionette.CompositeView)}.call(this),function(){var t,e,o,i=function(t,e){function o(){this.constructor=t}for(var i in e)r.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},r={}.hasOwnProperty;o=App.module("Classes.Views"),o.ClassesShowLayout=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.template="classes_show_layout",e.prototype.className="classes_show_layout",e.prototype.regions={overviewRegion:".classes_show__overview_region",photoRegion:".classes_show__photo_region",discussionRegion:".classes_show__discussion_region"},e.prototype.initialize=function(t){return this.courseId=t.courseId,this.dataStore=t.dataStore},e.prototype.onRender=function(){return this.dataStore.getCourse(this.courseId).done(function(t){return function(e){return t.overview=new App.Classes.Views.CourseOverview({model:e,dataStore:t.dataStore}),t.overviewRegion.show(t.overview),t.listenTo(e,"change:enrollment",t.render),e.get("quest_id")&&e.fetchQuestAndPhotos().done(function(){return t.photoRegion.show(t.photoView=new App.Classes.Views.CoursePhotoSubmissions({model:e}))}),e.get("group_id")?e.fetchGroupAndPosts().done(function(){return t.discussionRegion.show(t.discussionView=new App.Classes.Views.CourseDiscussion({model:e}))}):void 0}}(this))},e}(Marionette.LayoutView),o.CourseOverview=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.template="course_overview",e.prototype.className="course_overview",e.prototype.ui={enrollButton:".course_overview__enroll_button",dropButton:".course_overview__drop_button",content:".course_overview__content",watchButton:".course_overview__button--watch",upgradeButton:".course_overview__button--upgrade",signupButton:".course_overview__button--signup",resourcesDownloadButton:".course_overview__resources_button",emailConfirmButton:".course_overview__button--email_confirm"},e.prototype.behaviors={HasButtons:{"@ui.enrollButton":"_onClickEnroll","@ui.dropButton":"_onClickDrop","@ui.watchButton":"_onClickWatch","@ui.signupButton":"_onClickSignup","@ui.upgradeButton":"_onClickUpgrade","@ui.emailConfirmButton":"_onClickEmailConfirm","@ui.resourcesDownloadButton":"_onClickResourcesDownload"}},e.prototype.templateHelpers=function(){var t;return{loggedIn:null!=App.currentUser,coverPhotoUrl:this.model.coverPhotoUrl(PxApp.Constants.PHOTO_SIZES.S3_IMG_WEB_1500),hasClasses:PxCurrentUser.isAuthorized("classes"),enrolled:this.model.isEnrolled(),upcoming:this.model.isUpcoming(),webinarNotYetAvailable:moment(this.model.get("webinar_end")).isBefore(moment())&&!this.model.get("webinar_download_available"),duration:moment.duration(moment(this.model.get("webinar_end")).diff(moment(this.model.get("webinar_start")))).asMinutes(),startDate:moment(this.model.get("webinar_start")).format("LLLL"),instructorAvatar:this.model.get("instructor").avatars.small.https,videoVisible:this.videoVisible,userActive:null!=(t=App.currentUser)?t.isActive():void 0,videoContentPresent:!!this.model.get("gotowebinar_id")&&!!this.model.get("webinar_end")&&moment(this.model.get("webinar_end")).isAfter(moment())||this.model.get("webinar_download_available")}},e.prototype.initialize=function(t){return null==t&&(t={}),this.videoVisible=!1,this.classVideoStateName=this.model.videoStateName(),this.dataStore=t.dataStore},e.prototype.onShow=function(){return this.dataStore.getAutoEnroll()?(this.dataStore.setAutoEnroll(!1),this._onClickEnroll()):void 0},e.prototype._onClickEnroll=function(){var t;return null!=(t=window.AmplitudeLogger)&&t.classesEvent("Enroll Clicked - Enrolled","Class Overview",this.model.get("id"),this.classVideoStateName),this.model.enroll().done(function(t){return function(){var e;return t.model.get("webinar_start")&&moment(t.model.get("webinar_start")).isAfter(moment())&&(e=new App.Classes.Views.ClassesEnrolledModal({model:t.model}),e.showModal()),t.dataStore.setEnrollmentCount(t.dataStore.getEnrollmentCount()+1)}}(this))},e.prototype._onClickDrop=function(){var t,e;return null!=(e=window.AmplitudeLogger)&&e.classesEvent("Drop Clicked","Class Overview",this.model.get("id"),this.classVideoStateName),t=this.ui.content.i18n("course-dropped-message",{"return":!0}),this.model.drop().done(function(e){return function(){return App.Flash.success(t),e.dataStore.setEnrollmentCount(e.dataStore.getEnrollmentCount()-1)}}(this))},e.prototype._onClickSignup=function(){var t,e;return null!=(e=window.AmplitudeLogger)&&e.classesEvent("Signup Clicked","Class Overview",this.model.get("id"),this.classVideoStateName),t=new App.Views.SignupLoginModal({userAction:"Classes Register"}),this.listenToOnce(t,"signup:success",function(){return window.location.reload()}),this.listenToOnce(t,"login:success",function(){return window.location.reload()}),t.showModal()},e.prototype._onClickUpgrade=function(){var t;return null!=(t=window.AmplitudeLogger)&&t.classesEvent("Upgrade Clicked","Class Overview",this.model.get("id"),this.classVideoStateName),window.location.href="/upgrade?r="+this.model.getPath()+"&classes_access=false"},e.prototype._onClickWatch=function(){var t;return null!=(t=window.AmplitudeLogger)&&t.classesEvent("Watch Clicked","Class Overview",this.model.get("id"),this.classVideoStateName),this.model.get("gotowebinar_id")&&moment(this.model.get("webinar_end")).isAfter(moment())&&window.open("/classes/"+this.model.get("id")+"/watch","_blank","width=800,height=600"),this.model.get("webinar_download")?(this.videoVisible=!0,this.render()):void 0},e.prototype._onClickEmailConfirm=function(){var t;return t=new App.Classes.Views.EmailConfirmModal({model:this.model}),t.showModal()},e.prototype._onClickResourcesDownload=function(){var t;return null!=(t=window.AmplitudeLogger)&&t.classesEvent("Download Clicked","Class Overview",this.model.get("id"),this.classVideoStateName),window.open(this.model.get("resources_location","_blank"))},e}(Marionette.LayoutView),o.CoursePhotoSubmissions=function(o){function r(){return r.__super__.constructor.apply(this,arguments)}return i(r,o),r.prototype.template="course_photo_submissions",r.prototype.className="course_photo_submissions",r.prototype.regions={photosRegion:".course_photo_submissions__photos_region"},r.prototype.ui={viewPhotoSubmissionsButton:".course_photo_submissions__view_button"},r.prototype.behaviors={HasButtons:{"@ui.viewPhotoSubmissionsButton":"_onClickViewPhotoSubmissions"}},r.prototype.templateHelpers=function(){return{submissionStartDate:moment(this.model.getQuest().get("starts_at")).format("LLLL"),enrolled:this.model.isEnrolled(),hasClasses:PxCurrentUser.isAuthorized("classes")}},r.prototype.onShow=function(){var o;return o=this.model.getQuest().isStarted()?0===this.model.getPhotos().length?new t({model:this.model}):new App.Views.Carousel({collection:this.model.getPhotos(),showInfoCard:this.model.isEnrolled(),translationKey:"class_submissions",url:this.model.getQuest().getCanonicalPath(),dots:!1,fixedHeight:280}):new e({model:this.model}),this.photosRegion.show(o),this.listenTo(App.vent,"showPhoto",function(t){return function(t,e){var o,i;return o=e.navigationContext,i=_.extend({},e,{source:App.Helpers.StatsTracking.TRACKING_SOURCES["class"]}),App.Photos.show(t.id,i)}}(this))},r.prototype._onClickViewPhotoSubmissions=function(){var t;return null!=(t=window.AmplitudeLogger)&&t.classesEvent("View Photo Submissions Clicked","Course Photo Submissions",this.model.get("id"),this.model.videoStateName()),window.location.href=this.model.getQuest().getCanonicalPath()},r}(Marionette.LayoutView),t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.template="course_photo_submissions_empty",e.prototype.className="course_photo_submissions_empty",e.prototype.ui={submitPhotoButton:".course_photo_submissions__submit_button"},e.prototype.behaviors={HasButtons:{"@ui.submitPhotoButton":"_onClickSubmitPhoto"}},e.prototype.templateHelpers=function(){return{enrolled:this.model.isEnrolled(),hasClasses:PxCurrentUser.isAuthorized("classes")}},e.prototype._onClickSubmitPhoto=function(){var t;return null!=(t=window.AmplitudeLogger)&&t.classesEvent("Submit Photo Clicked (No Previous Uploads)","Course Photo Submissions",this.model.get("id"),this.model.videoStateName()),window.location.href=this.model.getQuest().getCanonicalPath()},e}(Marionette.ItemView),e=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.template="course_photo_submissions_not_started",e.prototype.className="course_photo_submissions_not_started",e.prototype.templateHelpers=function(){return{submissionStartDate:moment(this.model.getQuest().get("starts_at")).format("LLLL")}},e}(Marionette.ItemView),o.CourseDiscussion=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.template="course_discussion",e.prototype.className="course_discussion",e.prototype.regions={groupPostsRegion:".course_discussion__group_posts_view_region"},e.prototype.ui={newPost:".course_discussion__new_post"},e.prototype.behaviors={HasButtons:{"@ui.newPost":"_onClickNewPost"}},e.prototype.templateHelpers=function(){return{enrolled:this.model.isEnrolled(),hasClasses:PxCurrentUser.isAuthorized("classes")}},e.prototype.onShow=function(){return this.listenTo(App.vent,"navigate:show-post",function(t){return function(t){return window.location.href=App.postPath(t)}}(this)),this.listenTo(App.vent,"navigate:new-post",this._onClickNewPost),this.groupPostList=new App.Views.GroupPostList({model:this.model.getGroup(),collection:this.model.getPosts()}),this.groupPostsRegion.show(this.groupPostList),this.model.isEnrolled()?void 0:this.groupPostList.pauseInfiniteScroll()},e.prototype._onClickNewPost=function(){var t;return null!=(t=window.AmplitudeLogger)&&t.classesEvent("Create Discussion Clicked","Course Discussion",this.model.get("id"),this.model.videoStateName()),window.location.href=App.newPostPath(this.model.getGroup())},e}(Marionette.LayoutView),o.ClassesEnrolledModal=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.template="class_enrolled_modal",e.prototype.className="featured_class_card featured_class_card--modal",e.prototype.behaviors={ModalDialog:{closeButton:".close",closeOnEsc:!0}},e.prototype.templateHelpers=function(){return{startTime:moment(this.model.get("webinar_start")).format("LLLL"),coverPhotoUrl:this.model.coverPhotoUrl(PxApp.Constants.PHOTO_SIZES.S3_IMG_GRID_450)}},e.prototype.resize=function(){return this.trigger("resize")},e}(Marionette.LayoutView)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Classes.Views"),t.EmailConfirmModal=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.template="classes_email_confirm_modal",o.prototype.className="classes_email_confirm_modal",o.prototype.behaviors={ModalDialog:{closeButton:".close",closeOnEsc:!0}},o.prototype.onShow=function(){return null!=this.model?$.cookie("join_class_unactivated",this.model.id,{expires:1,path:"/"}):void 0},o.prototype.resize=function(){return this.trigger("resize")},o}(Marionette.ItemView)}.call(this),function(){var t,e=function(t,e){function i(){this.constructor=t}for(var r in e)o.call(e,r)&&(t[r]=e[r]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},o={}.hasOwnProperty;t=App.module("Classes.Views"),t.MyClassesLayout=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.template="my_classes_layout",o.prototype.className="my_classes_layout",o.prototype.regions={headerRegion:".classes_index__header_region",classesListRegion:".my_classes__list_region"},o.prototype.initialize=function(t){return null==t&&(t={}),this.dataStore=t.dataStore},o.prototype.onShow=function(){var t;return null!=(t=window.AmplitudeLogger)&&t.classesEvent("Page View","Classes My Classes Page"),this.headerRegion.show(new App.Classes.Views.ClassesHeader({selectedTab:"my_classes",dataStore:this.dataStore})),this.dataStore.getMyCourses().done(function(t){return function(e){return t.classesListRegion.show(new App.Classes.Views.ClassesList({collection:e})),$(window).trigger("scroll")}}(this))},o}(Marionette.LayoutView),t.ClassesList=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.className="my_classes__classes_list",o.prototype.childView=App.Classes.Views.ClassCardView,o.prototype.behaviors={InfiniteScroll:!0},o}(Marionette.CollectionView)}.call(this),function(){App.start()}.call(this);